var te=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var I=(a,t,o)=>t in a?te(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,z=(a,t)=>{for(var o in t||(t={}))le.call(t,o)&&I(a,o,t[o]);if(B)for(var o of B(t))ne.call(t,o)&&I(a,o,t[o]);return a},T=(a,t)=>oe(a,ae(t));var D=(a,t,o)=>new Promise((r,l)=>{var S=i=>{try{u(o.next(i))}catch(p){l(p)}},n=i=>{try{u(o.throw(i))}catch(p){l(p)}},u=i=>i.done?r(i.value):Promise.resolve(i.value).then(S,n);u((o=o.apply(a,t)).next())});import{r as f,l as se,m as M,t as re,n as ie,p as ce,q as ue,j as d,v as pe,f as x,e as de,o as me,x as fe,g as Y,i as O,y as V,u as e,k as E,w as v,z as ge,A as he,B as ve,C as be,D as P,P as Ce,_ as Se}from"./index-2C-ofHV5.js";import{b as ye,d as _e,i as we,F as xe,u as Pe,s as Re,a as ke,c as ze}from"./admin-5Hajs9G6.js";import{c as Te,p as De}from"./utils-C-gUDCcE.js";import{P as Ve}from"./plus-search-B1FvdIYy.js";import{g as Fe}from"./datePicker-ZEs-rmon.js";import{u as Ae}from"./drawer-BlMYOobw.js";import{C as Be}from"./close-bold-Dru7IMTV.js";import{P as Ie}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";function Me(a){const t=f({}),o=f([]),r=f(!0),l=se({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function S(s){l.pageSize=s,g()}function n(s){l.currentPage=s,g()}const u=f(!1),i=f(0),p=s=>{u.value=!0,s?i.value=s:i.value=0},y=s=>{_e(s).then(()=>{M("删除成功",{type:"success"}),g()})},_=s=>{ye(s).then(()=>{M("删除成功",{type:"success"}),g()})};function g(){r.value=!0;const s=T(z({},re(t.value)),{pageSize:l.pageSize,currentPage:l.currentPage});s.created_at&&(s.created_at=Te(s.created_at)),we(s).then(({data:b})=>{o.value=b.items,l.total=b.total,l.pageSize=b.pageSize,l.currentPage=b.currentPage,ie(()=>{a.value&&a.value.getTableRef().clearSelection()})}).finally(()=>{r.value=!1})}return{loading:r,search:t,dataList:o,pagination:l,handleSizeChange:S,handleCurrentChange:n,onSearch:g,onReset:()=>{g()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:u,updateId:i,handleStore:p,handleDestroy:y,handleBatchDestroy:_}}const Ye=a=>{const t=ce(()=>{a()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/邮箱/手机号"},onChange:()=>{t()}},{label:"状态",prop:"status",valueType:"select",options:[{label:"正常",value:"1"},{label:"禁用",value:"0"}],fieldProps:{placeholder:"请选择状态"},onChange:()=>{t()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Fe()}}]}},Oe=a=>{const t=f(!1),o=f(),r=f(0),l=f({username:"",status:1}),S=[{label:"用户名",prop:"username",valueType:"copy",fieldProps:{placeholder:"请输入用户名"}},{label:"密码",prop:"password",valueType:"input",fieldProps:{placeholder:"不修改密码请留空",type:"password"},get rules(){return ue(()=>[{required:r.value==0,message:"请输入密码"},{min:6,max:32,message:"密码长度在 6 到 32 个字符",trigger:"blur"}]).value}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"状态",prop:"status",valueType:"switch",fieldProps:{activeValue:1,inactiveValue:0}}],n={username:[{required:!0,message:"请输入用户名"},{min:2,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]};function u(h=0){var m;t.value=!0,h>0?r.value!==h&&y(h):((m=o.value.formInstance)==null||m.resetFields(),l.value=Object.fromEntries(Object.entries(xe).filter(([s,b])=>b!==0&&b!==""))),r.value=h}function i(){r.value>0?g():_()}function p(){t.value=!1}const y=h=>{ke(h).then(m=>{l.value=De(m.data,ze)})},_=()=>D(null,null,function*(){Re(l.value).then(()=>{a(),t.value=!1})}),g=()=>D(null,null,function*(){Pe(r.value,l.value).then(()=>{a(),t.value=!1})});return{storeRef:o,showStore:t,storeId:r,storeValues:l,storeColumns:S,rules:n,openStoreForm:u,confirmStoreForm:i,closeStoreForm:p}},Ee=()=>{const a=f(),t=f([]);return{tableRef:a,selectedIds:t,handleSelectionChange:n=>{t.value=n.map(u=>u.id),a.value.setAdaptive()},handleSelectionCancel:()=>{var n;(n=a.value)==null||n.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:60},{label:"用户名",prop:"username",minWidth:100},{label:"邮箱",prop:"email",minWidth:140},{label:"手机号",prop:"mobile",width:120},{label:"状态",prop:"status",width:70,cellRenderer:({row:n,props:u})=>d(x("el-tag"),{size:u.size,type:n.status===1?"success":"danger",effect:"plain"},{default:()=>[n.status===1?"正常":"禁用"]})},{label:"创建时间",prop:"created_at",width:160,formatter:({created_at:n})=>n?pe(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleRowClick:(n,u,i)=>{var y;const p=i.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(y=a.value)==null||y.getTableRef().toggleRowSelection(n)}}},Ne={class:"main"},$e={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ue={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},je={class:"flex-auto"},qe={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Le=de({name:"Admin",__name:"index",setup(a){const{drawerSize:t}=Ae(),{tableRef:o,selectedIds:r,handleSelectionChange:l,handleSelectionCancel:S,tableColumns:n,handleRowClick:u}=Ee(),{loading:i,search:p,dataList:y,pagination:_,handleSizeChange:g,handleCurrentChange:h,onSearch:m,onReset:s,onCollapse:b,handleDestroy:N,handleBatchDestroy:$}=Me(o),{searchColumns:U}=Ye(()=>m()),{storeRef:j,showStore:q,storeId:L,storeColumns:H,rules:K,storeValues:R,openStoreForm:F,confirmStoreForm:W,closeStoreForm:G}=Oe(()=>m());return me(()=>{m()}),(He,c)=>{const w=x("el-button"),J=x("el-tooltip"),A=x("el-popconfirm"),Q=x("pure-table"),X=fe("motion-fade");return O(),Y("div",Ne,[V("div",$e,[d(e(Ve),{modelValue:e(p),"onUpdate:modelValue":c[0]||(c[0]=C=>E(p)?p.value=C:null),columns:e(U),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:e(m),onReset:e(s),onCollapse:e(b)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),d(e(Ce),{title:"管理员管理",columns:e(n),onRefresh:e(m)},{buttons:v(()=>[d(w,{type:"primary",onClick:c[1]||(c[1]=C=>e(F)())},{default:v(()=>[...c[4]||(c[4]=[P("新增管理员",-1)])]),_:1})]),default:v(({size:C,dynamicColumns:Z})=>[e(r).length>0?ge((O(),Y("div",Ue,[V("div",je,[d(J,{placement:"top",content:"取消选择"},{default:v(()=>[d(w,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:e(ve)(e(Be)),onClick:e(S)},null,8,["icon","onClick"])]),_:1}),V("span",qe," 已选 "+be(e(r).length)+" 项 ",1)]),d(A,{title:"确定要删除吗？",width:"160px",onConfirm:c[2]||(c[2]=k=>e($)(e(r)))},{reference:v(()=>[d(w,{type:"danger",size:"small"},{default:v(()=>[...c[5]||(c[5]=[P(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[X]]):he("",!0),d(Q,{ref_key:"tableRef",ref:o,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(i),size:C,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(y),columns:Z,pagination:T(z({},e(_)),{size:C}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:e(u),onSelectionChange:e(l),onPageSizeChange:e(g),onPageCurrentChange:e(h)},{operation:v(({row:k})=>[d(w,{class:"reset-margin !outline-none",type:"primary",link:"",size:C,onClick:ee=>e(F)(k.id)},{default:v(()=>[...c[6]||(c[6]=[P(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),d(A,{title:"确定要删除吗？",width:"160px",onConfirm:ee=>e(N)(k.id)},{reference:v(()=>[d(w,{class:"reset-margin !outline-none",link:"",type:"danger",size:C},{default:v(()=>[...c[7]||(c[7]=[P(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),d(e(Ie),{ref_key:"storeRef",ref:j,modelValue:e(R),"onUpdate:modelValue":c[3]||(c[3]=C=>E(R)?R.value=C:null),visible:e(q),form:{columns:e(H),rules:e(K),labelPosition:"right",labelSuffix:""},size:e(t),closeOnClickModal:!0,title:e(L)>0?"编辑管理员":"新增管理员",confirmText:"提交",cancelText:"取消",onConfirm:e(W),onCancel:e(G)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),at=Se(Le,[["__scopeId","data-v-2a34501c"]]);export{at as default};
