var te=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var L=(e,l,a)=>l in e?te(e,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[l]=a,T=(e,l)=>{for(var a in l||(l={}))ae.call(l,a)&&L(e,a,l[a]);if(I)for(var a of I(l))ne.call(l,a)&&L(e,a,l[a]);return e},F=(e,l)=>le(e,oe(l));import{P as re,a as se}from"./plus-search-DONTT3F1.js";import{k as S,r as d,l as ie,m as $,t as ue,n as ce,p as pe,f as c,I as de,s as me,d as fe,o as he,c as M,e as O,v as D,i as t,j as A,w as m,x as ge,y as be,h as w,z as ve,A as x,B as Ce,_ as Se}from"./index-D9lkRtkU.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-CvymPDJM.js";import{p as ke}from"./utils-BTJ8R6fS.js";import{i as ye}from"./dictionary-Ce8SPu8B.js";import{u as Re}from"./hooks-C30YmLIe.js";import{u as we}from"./drawer-DA-UdFhf.js";import{C as xe}from"./close-bold-DR0Tnm_R.js";import{P as Pe}from"./index-ChpzrfiJ.js";import"./index-B6vBV-uA.js";import"./epTheme-Db9MQrTx.js";function ze(e){return S.get("/callback",{params:e})}const N={user_id:0,url:"",token:"",status:1},Te=Object.keys(N);function Fe(e){return S.post("/callback",{data:e})}function De(e,l){return S.put(`/callback/${e}`,{data:l})}function Ue(e){return S.get(`/callback/${e}`)}function Ve(e){return S.delete(`/callback/${e}`)}function Be(e){return S.delete("/callback/batch",{data:{ids:e}})}function Ie(e){const l=d({}),a=d([]),s=d(!0),n=ie({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function C(o){n.pageSize=o,g()}function r(o){n.currentPage=o,g()}const f=d(!1),h=d(0),p=o=>{f.value=!0,o?h.value=o:h.value=0},v=o=>{Ve(o).then(()=>{$("删除成功",{type:"success"}),g()})},_=o=>{Be(o).then(()=>{$("删除成功",{type:"success"}),g()})};function g(){s.value=!0;const o=F(T({},ue(l.value)),{pageSize:n.pageSize,currentPage:n.currentPage});ze(o).then(({data:i})=>{a.value=i.items,n.total=i.total,n.pageSize=i.pageSize,n.currentPage=i.currentPage,ce(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{s.value=!1})}return{loading:s,search:l,dataList:a,pagination:n,handleSizeChange:C,handleCurrentChange:r,onSearch:g,showStore:f,updateId:h,handleStore:p,handleDestroy:v,handleBatchDestroy:_}}const Le=e=>{const l=pe(()=>{e()},500);return{searchColumns:[{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"状态",prop:"status",valueType:"select",options:[{label:"启用",value:1},{label:"禁用",value:0}],fieldProps:{placeholder:"请选择状态"}},{label:"URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入URL"}}],debouncedSearch:l}},$e=e=>{const l=d(!1),a=d(),s=d(0),n=d({}),C=[{label:"用户",prop:"user_id",valueType:"select",renderField:(o,i)=>c(_e,{modelValue:o,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:i,refreshKey:s.value},null)},{label:"URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入回调URL"}},{label:"认证令牌",prop:"token",valueType:"input",fieldProps:{placeholder:"请输入认证令牌"}},{label:"状态",prop:"status",valueType:"switch",fieldProps:ye}],r={user_id:[{required:!0,message:"请选择用户"},{type:"number",min:1,message:"用户ID必须大于0"}],url:[{required:!0,message:"请输入回调URL"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL地址（以http://或https://开头）",trigger:"blur"}],token:[{required:!0,message:"请输入认证令牌",trigger:"blur"}],status:[{required:!0,message:"请选择状态"}]};function f(o=0){var i,y;l.value=!0,o>0?s.value!==o&&v(o):((y=(i=a.value)==null?void 0:i.formInstance)==null||y.resetFields(),n.value=Object.fromEntries(Object.entries(N).filter(([U,R])=>R!==0&&R!==""))),s.value=o}function h(){s.value>0?g():_()}function p(){l.value=!1}const v=o=>{Ue(o).then(i=>{n.value=ke(i.data,Te)})},_=()=>{Fe(n.value).then(()=>{e(),l.value=!1})},g=()=>{De(s.value,n.value).then(()=>{e(),l.value=!1})};return{storeRef:a,showStore:l,storeId:s,storeValues:n,storeColumns:C,rules:r,openStoreForm:f,confirmStoreForm:h,closeStoreForm:p}},Me=()=>{const e=d(),l=d([]),a=r=>{l.value=r.map(f=>f.id),e.value.setAdaptive()},s=()=>{var r;(r=e.value)==null||r.getTableRef().clearSelection()},n=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:80},{label:"用户名",prop:"user.username",minWidth:120,cellRenderer:de("user.username")},{label:"URL",prop:"url",minWidth:250},{label:"状态",prop:"status",minWidth:120,formatter:({status:r})=>r===1?"启用":"禁用"},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:r})=>r?me(r).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}];return{tableRef:e,selectedIds:l,handleSelectionChange:a,handleSelectionCancel:s,tableColumns:n,handleRowClick:(r,f,h)=>{var v;const p=h.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(v=e.value)==null||v.getTableRef().toggleRowSelection(r)}}},Oe={class:"main"},Ae={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ne={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},We={class:"flex-auto"},je={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},qe=fe({name:"Callback",__name:"index",setup(e){const{drawerSize:l}=we(),{tableRef:a,selectedIds:s,tableColumns:n,handleSelectionChange:C,handleSelectionCancel:r,handleRowClick:f}=Me(),{loading:h,search:p,dataList:v,pagination:_,handleSizeChange:g,handleCurrentChange:o,onSearch:i,handleDestroy:y,handleBatchDestroy:U}=Ie(a),{searchColumns:R,debouncedSearch:W}=Le(()=>i()),{storeRef:j,showStore:q,storeId:E,storeColumns:Y,rules:K,storeValues:P,openStoreForm:V,confirmStoreForm:H,closeStoreForm:G}=$e(()=>i());return he(()=>{i()}),(Ee,u)=>{const k=w("el-button"),J=w("el-tooltip"),B=w("el-popconfirm"),Q=w("pure-table"),X=Ce("motion-fade");return O(),M("div",Oe,[D("div",Ae,[c(t(re),{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=b=>A(p)?p.value=b:null),columns:t(R),"show-number":3,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:t(W)},null,8,["modelValue","columns","onChange"])]),c(t(se),{title:"回调管理",columns:t(n),onRefresh:t(i)},{buttons:m(()=>[c(k,{type:"primary",onClick:u[1]||(u[1]=b=>t(V)())},{default:m(()=>u[4]||(u[4]=[x(" 新增回调 ")])),_:1})]),default:m(({size:b,dynamicColumns:Z})=>[t(s).length>0?ge((O(),M("div",Ne,[D("div",We,[c(J,{placement:"top",content:"取消选择"},{default:m(()=>[c(k,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Re)(t(xe)),onClick:t(r)},null,8,["icon","onClick"])]),_:1}),D("span",je," 已选 "+ve(t(s).length)+" 项 ",1)]),c(B,{title:"确定要删除吗？",width:"160px",onConfirm:u[2]||(u[2]=z=>t(U)(t(s)))},{reference:m(()=>[c(k,{type:"danger",size:"small"},{default:m(()=>u[5]||(u[5]=[x(" 批量删除 ")])),_:1})]),_:1})])),[[X]]):be("",!0),c(Q,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(h),size:b,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(v),columns:Z,pagination:F(T({},t(_)),{size:b}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(f),onSelectionChange:t(C),onPageSizeChange:t(g),onPageCurrentChange:t(o)},{operation:m(({row:z})=>[c(k,{class:"reset-margin !outline-none",type:"primary",link:"",size:b,onClick:ee=>t(V)(z.id)},{default:m(()=>u[6]||(u[6]=[x(" 编辑 ")])),_:2},1032,["size","onClick"]),c(B,{title:"确定要删除吗？",width:"160px",onConfirm:ee=>t(y)(z.id)},{reference:m(()=>[c(k,{class:"reset-margin !outline-none",link:"",type:"danger",size:b},{default:m(()=>u[7]||(u[7]=[x(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(t(Pe),{ref_key:"storeRef",ref:j,modelValue:t(P),"onUpdate:modelValue":u[3]||(u[3]=b=>A(P)?P.value=b:null),visible:t(q),form:{columns:t(Y),rules:t(K),labelPosition:"right",labelSuffix:"",labelWidth:100},size:t(l),closeOnClickModal:!0,title:t(E)>0?"编辑回调":"新增回调",confirmText:"提交",cancelText:"取消",onConfirm:t(H),onCancel:t(G)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),at=Se(qe,[["__scopeId","data-v-7bbb6368"]]);export{at as default};
