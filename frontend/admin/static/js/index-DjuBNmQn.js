var Ne=Object.defineProperty,$e=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var be=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var ye=(d,n,t)=>n in d?Ne(d,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[n]=t,q=(d,n)=>{for(var t in n||(n={}))je.call(n,t)&&ye(d,t,n[t]);if(be)for(var t of be(n))He.call(n,t)&&ye(d,t,n[t]);return d},se=(d,n)=>$e(d,Ye(n));var N=(d,n,t)=>new Promise((f,r)=>{var e=u=>{try{m(t.next(u))}catch(C){r(C)}},i=u=>{try{m(t.throw(u))}catch(C){r(C)}},m=u=>u.done?f(u.value):Promise.resolve(u.value).then(e,i);m((t=t.apply(d,n)).next())});import{r as b,l as Ve,q as D,m as Z,t as We,n as Ge,p as Ke,j as o,f as h,aR as Qe,b4 as Ze,v as he,e as ee,G as E,i as F,w as s,g as Y,H as J,I as X,u as c,D as T,F as G,o as Ie,y as Q,C as ce,Q as Ce,x as Fe,z as ze,A as ie,_ as De,k as we,B as Je,P as Xe}from"./index-2C-ofHV5.js";import{u as el}from"./drawer-BlMYOobw.js";import{b as ll,d as tl,i as al,F as ol,u as rl,a as nl,s as sl,c as il,g as ul,e as dl,f as pl,h as cl,j as ml}from"./product-BetgexOv.js";import{P as vl}from"./plus-search-B1FvdIYy.js";import{b as K,c as ue,e as de,d as pe,n as H,s as Se,f as xe,g as Pe,h as ke,p as Te,i as fl,w as _l,j as $}from"./dictionary-DGN_erWP.js";import{p as gl}from"./utils-C-gUDCcE.js";import{u as bl}from"./dialog-DFvFShc1.js";import{i as yl}from"./userLevel-CcvbNlzu.js";import{L as hl}from"./levels-CDsVv79f.js";import{C as Cl}from"./close-bold-Dru7IMTV.js";import{P as wl}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";import"./index.vue_vue_type_script_setup_true_lang-BHKqx4-E.js";function Sl(d){const n=b({}),t=b([]),f=b(!0),r=Ve({total:0,pageSize:100,currentPage:1,background:!0,pageSizes:[10,20,50,100],hideOnSinglePage:!0}),e=D(()=>r.total<=r.pageSize);function i(p){r.pageSize=p,l()}function m(p){r.currentPage=p,l()}const u=b(!1),C=b(0),x=p=>{u.value=!0,p?C.value=p:C.value=0},P=p=>{tl(p).then(()=>{Z("删除成功",{type:"success"}),l()})},y=p=>{ll(p).then(()=>{Z("删除成功",{type:"success"}),l()})};function l(){f.value=!0;const p=se(q({},We(n.value)),{pageSize:r.pageSize,currentPage:r.currentPage});al(p).then(({data:w})=>{t.value=w.items,r.total=w.total,r.pageSize=w.pageSize,r.currentPage=w.currentPage,Ge(()=>{d.value&&d.value.getTableRef().clearSelection()})}).finally(()=>{f.value=!1})}return{loading:f,search:n,dataList:t,pagination:r,isSinglePage:e,handleSizeChange:i,handleCurrentChange:m,onSearch:l,showStore:u,updateId:C,handleStore:x,handleDestroy:P,handleBatchDestroy:y}}const j=(d,n)=>(t,f)=>{const r=b(t),e=i=>{r.value===i?(r.value=void 0,f(void 0)):(r.value=i,f(i))};return o("div",{class:"flex flex-wrap gap-1 items-center"},[o("div",{class:"flex flex-wrap gap-1"},[d.map(i=>o(h("el-button"),{key:i.value,type:r.value===i.value?"primary":"default",onClick:()=>e(i.value),class:"ml-3 w-28"},{default:()=>[i.label]}))]),(n==null?void 0:n.showToggleButton)&&o(h("el-button"),{type:"primary",link:!0,onClick:n.onToggle,class:"ml-3 flex items-center whitespace-nowrap text-base"},{default:()=>[o(h("el-icon"),{class:"mr-1"},{default:()=>[n.collapsed?o(Qe,null,null):o(Ze,null,null)]}),n.collapsed?"展开":"收起"]})])},xl=d=>{const n=Ke(()=>{d()},500),t=b(!0),f=()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},r=()=>{t.value=!t.value,f()};return{searchColumns:D(()=>[{label:"证书品牌",prop:"brand",valueType:"radio",options:K,renderField:j(K,{showToggleButton:!0,onToggle:r,collapsed:t.value})},{label:"产品类型",prop:"product_type",valueType:"radio",options:ue,renderField:j(ue),hideInSearch:t.value},{label:"加密标准",prop:"encryption_standard",valueType:"radio",options:de,renderField:j(de),hideInSearch:t.value},{label:"验证类型",prop:"validation_type",valueType:"radio",options:pe,renderField:j(pe),hideInSearch:t.value},{label:"域名类型",prop:"name_type",valueType:"radio",options:H,renderField:j(H),hideInSearch:t.value},{label:"产品状态",prop:"status",valueType:"radio",options:Se,renderField:j(Se),hideInSearch:t.value},{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"编码/名称/备注",clearable:!0,style:{width:"240px"}},hideInSearch:t.value}]),debouncedSearch:n}};function Pl(d,n){if(!d||!Array.isArray(d))return d;const t=n.map(f=>f.value);return d.filter(f=>t.includes(f)).sort((f,r)=>{const e=t.indexOf(f),i=t.indexOf(r);return e-i})}function kl(d,n){const t=q({},d);return n.forEach(f=>{const r=t[f.field];r&&(t[f.field]=Pl(r,f.options))}),t}const Tl=(d,n)=>{const t=b(!1),f=b(),r=b(0),e=b({}),i=D(()=>!e.value.product_type||e.value.product_type==="ssl"),m=D(()=>e.value.product_type==="codesign"),u=D(()=>e.value.product_type==="docsign"),C=D(()=>e.value.product_type==="smime"),x=["mailbox","individual","sponsor","organization"],P=(a,g,z)=>{if(!C.value){z();return}if(!g){z(new Error("请输入编码"));return}const le=g.toLowerCase();if(!x.some(W=>le.includes(W))){z(new Error("S/MIME 产品编码必须包含以下标记之一: mailbox, individual, sponsor, organization"));return}z()},y=D(()=>[{field:"encryption_alg",options:xe},{field:"signature_digest_alg",options:Pe},{field:"common_name_types",options:H},{field:"alternative_name_types",options:H},{field:"validation_methods",options:ke},{field:"periods",options:Te}]),l=D(()=>[{label:"名称",prop:"name",valueType:"input",fieldProps:{placeholder:"请输入名称"}},{label:"编码",prop:"code",valueType:"input",fieldProps:{placeholder:"请输入编码"}},{label:"API ID",prop:"api_id",valueType:"input",fieldProps:{placeholder:"请输入API ID"}},{label:"来源",prop:"source",valueType:"select",fieldProps:{placeholder:"请选择来源"},options:n},{label:"品牌",prop:"brand",valueType:"select",fieldProps:{placeholder:"请选择品牌"},options:K},{label:"签发机构",prop:"ca",valueType:"select",fieldProps:{placeholder:"请选择签发机构"},options:fl},{label:"产品类型",prop:"product_type",valueType:"select",fieldProps:{placeholder:"请选择产品类型"},options:ue},{label:"保险币种",prop:"warranty_currency",valueType:"select",fieldProps:{placeholder:"请选择保险币种"},options:_l,hideInForm:!i.value},{label:"保险金额",prop:"warranty",valueType:"input-number",fieldProps:{placeholder:"请输入保险金额",min:0,precision:2,controlsPosition:"right"},hideInForm:!i.value},{label:"服务器数量",prop:"server",valueType:"input-number",fieldProps:{placeholder:"请输入限制服务器数量",min:0,precision:0,controlsPosition:"right"},tooltip:"0为不限制",hideInForm:!i.value},{label:"加密标准",prop:"encryption_standard",valueType:"radio",fieldProps:{placeholder:"请选择加密标准"},options:de},{label:"加密算法",prop:"encryption_alg",valueType:"checkbox",fieldProps:{placeholder:"请选择加密算法",multiple:!0},options:xe},{label:"签名摘要算法",prop:"signature_digest_alg",valueType:"checkbox",fieldProps:{placeholder:"请选择签名摘要算法",multiple:!0},options:Pe},{label:"验证类型",prop:"validation_type",valueType:"radio",fieldProps:{placeholder:"请选择验证类型"},options:pe},{label:"通用名称类型",prop:"common_name_types",valueType:"checkbox",fieldProps:{placeholder:"请选择通用名称类型",multiple:!0},options:H,hideInForm:!i.value},{label:"备用名称类型",prop:"alternative_name_types",valueType:"checkbox",fieldProps:{placeholder:"请选择备用名称类型",multiple:!0},options:H,hideInForm:!i.value},{label:"验证方法",prop:"validation_methods",valueType:"checkbox",fieldProps:{placeholder:"请选择验证方法",multiple:!0},options:ke,hideInForm:!i.value},{label:"周期",prop:"periods",valueType:"checkbox",fieldProps:{placeholder:"请选择周期",multiple:!0},options:Te},{label:"标准域名起始个数",prop:"standard_min",valueType:"input-number",fieldProps:{placeholder:"请输入标准域名起始个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"标准域名最大个数",prop:"standard_max",valueType:"input-number",fieldProps:{placeholder:"请输入标准域名最大个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"通配符起始个数",prop:"wildcard_min",valueType:"input-number",fieldProps:{placeholder:"请输入通配符起始个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"通配符最大个数",prop:"wildcard_max",valueType:"input-number",fieldProps:{placeholder:"请输入通配符最大个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"总域名起始个数",prop:"total_min",valueType:"input-number",fieldProps:{placeholder:"请输入总域名起始个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"总域名最大个数",prop:"total_max",valueType:"input-number",fieldProps:{placeholder:"请输入总域名最大个数",min:0,precision:0,controlsPosition:"right"},hideInForm:!i.value},{label:"添加SAN",prop:"add_san",valueType:"switch",fieldProps:$,hideInForm:!i.value},{label:"替换SAN",prop:"replace_san",valueType:"switch",fieldProps:$,hideInForm:!i.value},{label:"重新签发",prop:"reissue",valueType:"switch",fieldProps:$,hideInForm:m.value||u.value},{label:"续期",prop:"renew",valueType:"switch",fieldProps:$},{label:"重用CSR",prop:"reuse_csr",valueType:"switch",fieldProps:$},{label:"赠送根域名",prop:"gift_root_domain",valueType:"switch",fieldProps:$,hideInForm:!i.value},{label:"退款期限",prop:"refund_period",valueType:"input-number",fieldProps:{placeholder:"请输入退款期限",min:0,precision:0,controlsPosition:"right"}},{label:"备注",prop:"remark",valueType:"textarea",fieldProps:{placeholder:"请输入备注",rows:3}},{label:"排序权重",prop:"weight",valueType:"input-number",fieldProps:{placeholder:"请输入排序权重",min:0,precision:0,controlsPosition:"right"},tooltip:"排序权重越小，越靠前"},{label:"状态",prop:"status",valueType:"switch",fieldProps:$},{label:"创建时间",prop:"created_at",hideInForm:r.value===0,renderField:a=>a&&typeof a=="string"?he(a).format("YYYY-MM-DD HH:mm:ss"):""},{label:"更新时间",prop:"updated_at",hideInForm:r.value===0,renderField:a=>a&&typeof a=="string"?he(a).format("YYYY-MM-DD HH:mm:ss"):""}]),p=D(()=>{const a={code:[{required:!0,message:"请输入编码"},{max:50,message:"编码长度不能超过50个字符",trigger:"blur"},{validator:P,trigger:"blur"}],name:[{required:!0,message:"请输入名称"},{max:100,message:"名称长度不能超过100个字符",trigger:"blur"}],api_id:[{required:!0,message:"请输入API ID"},{max:128,message:"API ID长度不能超过128个字符",trigger:"blur"}],source:[{required:!0,message:"请选择来源"}],brand:[{required:!0,message:"请选择品牌"}],ca:[{required:!0,message:"请选择签发机构"}],product_type:[{required:!0,message:"请选择产品类型"}],validation_type:[{required:!0,message:"请选择验证类型"}],periods:[{required:!0,message:"请选择周期"}],refund_period:[{required:!0,message:"请输入退款期限"}],weight:[{required:!0,message:"请输入排序权重"}],remark:[{max:500,message:"备注长度不能超过500个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态"}]};return a.encryption_standard=[{required:!0,message:"请选择加密标准"}],a.encryption_alg=[{required:!0,message:"请选择加密算法"}],a.signature_digest_alg=[{required:!0,message:"请选择签名摘要算法"}],i.value&&(a.common_name_types=[{required:!0,message:"请选择通用名称类型"}],a.warranty_currency=[{required:!0,message:"请选择保险币种"}],a.warranty=[{required:!0,message:"请输入保险金额"},{type:"number",min:0,message:"保险金额不能小于0"}],a.validation_methods=[{required:!0,message:"请选择验证方法"}],a.standard_min=[{required:!0,message:"请输入标准域名起始个数"}],a.standard_max=[{required:!0,message:"请输入标准域名最大个数"}],a.wildcard_min=[{required:!0,message:"请输入通配符域名起始个数"}],a.wildcard_max=[{required:!0,message:"请输入通配符域名最大个数"}],a.total_min=[{required:!0,message:"请输入总域名起始个数"}],a.total_max=[{required:!0,message:"请输入总域名最大个数"}]),a});function w(a=0){var g,z;t.value=!0,a>0?r.value!==a&&O(a):((z=(g=f.value)==null?void 0:g.formInstance)==null||z.resetFields(),e.value=Object.fromEntries(Object.entries(ol))),r.value=a}function V(){r.value>0?_():U()}function I(){t.value=!1}function R(a){const g=kl(a,y.value);return g.product_type&&g.product_type!=="ssl"&&(g.common_name_types=[],g.alternative_name_types=[],g.validation_methods=[],g.standard_min=0,g.standard_max=0,g.wildcard_min=0,g.wildcard_max=0,g.total_min=1,g.total_max=1,g.add_san=0,g.replace_san=0,g.gift_root_domain=0,g.server=0,g.warranty_currency="$",g.warranty=0),g.product_type==="codesign"&&(g.reissue=0),g}const O=a=>{sl(a).then(({data:g})=>{var z;e.value=gl(g,il),e.value.warranty=Number((z=e.value.warranty)!=null?z:0)})},U=()=>{delete e.value.created_at,delete e.value.updated_at;const a=R(e.value);nl(a).then(()=>{d(),t.value=!1})},_=()=>{delete e.value.created_at,delete e.value.updated_at;const a=R(e.value);rl(r.value,a).then(()=>{d(),t.value=!1})};return{storeRef:f,showStore:t,storeId:r,storeValues:e,storeColumns:l,rules:p,openStoreForm:w,confirmStoreForm:V,closeStoreForm:I}},Vl=d=>{const n=b(),t=b([]);return{tableRef:n,selectedIds:t,handleSelectionChange:m=>{t.value=m.map(u=>u.id),n.value.setAdaptive()},handleSelectionCancel:()=>{var m;(m=n.value)==null||m.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:50},{label:"来源",prop:"source",width:80,formatter:m=>{var C;const u=(C=d.value)==null?void 0:C.find(x=>x.value===m.source);return u?u.label:m.source.charAt(0).toUpperCase()+m.source.slice(1)}},{label:"名称",prop:"name",minWidth:150},{label:"说明",prop:"remark",minWidth:150},{label:"权重",prop:"weight",width:70},{label:"状态",prop:"status",width:70,cellRenderer:({row:m,props:u})=>o(h("el-tag"),{size:u.size,type:m.status===1?"success":"danger",effect:"plain"},{default:()=>[m.status===1?"启用":"禁用"]})},{label:"操作",fixed:"right",slot:"operation",width:200}],handleRowClick:(m,u,C)=>{var P;const x=C.target;x.tagName==="BUTTON"||x.closest("button")||x.closest(".el-button")||(P=n.value)==null||P.getTableRef().toggleRowSelection(m)}}};function Il(){const d=b([]),n=b(!1);function t(){n.value=!0,ul().then(({data:f})=>{d.value=f||[]}).catch(()=>{d.value=[]}).finally(()=>{n.value=!1})}return{sourcesList:d,getSourcesList:t}}const Fl=ee({name:"ProductImport",__name:"import",props:{visible:{type:Boolean,default:!1},sourcesList:{type:Array,default:()=>[]}},emits:["update:visible","success"],setup(d,{emit:n}){const t=d,f=n,r=b(),e=b(!1),{dialogSize:i}=bl(),m=D({get:()=>t.visible,set:y=>f("update:visible",y)}),u=Ve({source:"default",brand:"",apiId:"",type:"update"}),C={source:[{required:!0,message:"请选择来源"}]},x=()=>{f("update:visible",!1)},P=()=>{e.value=!0,dl(u).then(y=>{y.code===1&&(Z("导入产品成功",{type:"success"}),x(),f("success"),u.source="default",u.brand="",u.apiId="",u.type="update")}).finally(()=>{e.value=!1})};return(y,l)=>{const p=h("el-option"),w=h("el-select"),V=h("el-form-item"),I=h("el-input"),R=h("el-form"),O=h("el-button"),U=h("el-dialog");return F(),E(U,{modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=_=>m.value=_),title:"导入产品",width:c(i),"destroy-on-close":"",onClosed:x},{footer:s(()=>[o(O,{onClick:x},{default:s(()=>[...l[5]||(l[5]=[T("取消",-1)])]),_:1}),o(O,{type:"primary",loading:e.value,onClick:P},{default:s(()=>[...l[6]||(l[6]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[o(R,{ref_key:"formRef",ref:r,model:u,rules:C,"label-width":"80px"},{default:s(()=>[o(V,{label:"来源",prop:"source"},{default:s(()=>[o(w,{modelValue:u.source,"onUpdate:modelValue":l[0]||(l[0]=_=>u.source=_),placeholder:"请选择来源",style:{width:"100%"}},{default:s(()=>[(F(!0),Y(J,null,X(t.sourcesList,_=>(F(),E(p,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"品牌",prop:"brand"},{default:s(()=>[o(w,{modelValue:u.brand,"onUpdate:modelValue":l[1]||(l[1]=_=>u.brand=_),placeholder:"请选择品牌",clearable:"",style:{width:"100%"}},{default:s(()=>[(F(!0),Y(J,null,X(c(K),_=>(F(),E(p,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"接口ID",prop:"apiId"},{default:s(()=>[o(I,{modelValue:u.apiId,"onUpdate:modelValue":l[2]||(l[2]=_=>u.apiId=_),placeholder:"请输入接口ID"},null,8,["modelValue"])]),_:1}),o(V,{label:"类型",prop:"type"},{default:s(()=>[o(w,{modelValue:u.type,"onUpdate:modelValue":l[3]||(l[3]=_=>u.type=_),placeholder:"请选择类型",clearable:"",style:{width:"100%"}},{default:s(()=>[o(p,{key:"new",label:"导入新产品",value:"new"}),o(p,{key:"update",label:"更新产品",value:"update"}),o(p,{key:"all",label:"导入所有产品",value:"all"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])}}}),zl={class:"dialog-footer"},Dl=ee({__name:"export",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(d,{emit:n}){const t=d,f=n,r=D({get:()=>t.visible,set:y=>f("update:visible",y)}),e=b({brands:[],levelCustom:0,levelCodes:[]}),i=()=>{e.value={brands:[],levelCustom:0,levelCodes:[]}},m=b([]),u=()=>N(null,null,function*(){var y;try{const l=yield yl({custom:e.value.levelCustom});l.code===1&&((y=l.data)!=null&&y.items)&&(m.value=l.data.items.map(p=>({label:p.name,value:p.code})))}catch(l){console.error("获取会员级别失败:",l)}}),C=b(!1),x=()=>N(null,null,function*(){if(!C.value){C.value=!0;try{const y={};e.value.brands.length>0&&(y.brands=e.value.brands),y.levelCustom=e.value.levelCustom,e.value.levelCodes.length>0&&(y.levelCodes=e.value.levelCodes),yield pl(y),Ce.success("导出成功"),r.value=!1}catch(y){console.error("导出失败:",y),Ce.error(y.message||"导出失败")}finally{C.value=!1}}}),P=()=>{r.value=!1,i()};return G(()=>t.visible,y=>{y&&(i(),u())}),G(()=>e.value.levelCustom,()=>{e.value.levelCodes=[],u()}),Ie(()=>{u()}),(y,l)=>{const p=h("el-option"),w=h("el-select"),V=h("el-form-item"),I=h("el-radio"),R=h("el-radio-group"),O=h("el-form"),U=h("el-button"),_=h("el-dialog");return F(),E(_,{modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=a=>r.value=a),title:"导出产品价格",width:"500px","destroy-on-close":"",onClose:P},{footer:s(()=>[Q("div",zl,[o(U,{onClick:P},{default:s(()=>[...l[6]||(l[6]=[T("取消",-1)])]),_:1}),o(U,{type:"primary",loading:C.value,onClick:x},{default:s(()=>[T(ce(C.value?"导出中...":"导出"),1)]),_:1},8,["loading"])])]),default:s(()=>[o(O,{model:e.value,"label-width":"120px","label-position":"right"},{default:s(()=>[o(V,{label:"品牌筛选"},{default:s(()=>[o(w,{modelValue:e.value.brands,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.brands=a),multiple:"",placeholder:"选择品牌（不选择则导出所有品牌）",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":""},{default:s(()=>[(F(!0),Y(J,null,X(c(K),a=>(F(),E(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"会员级别类型"},{default:s(()=>[o(R,{modelValue:e.value.levelCustom,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.levelCustom=a)},{default:s(()=>[o(I,{value:0},{default:s(()=>[...l[4]||(l[4]=[T("基础级别",-1)])]),_:1}),o(I,{value:1},{default:s(()=>[...l[5]||(l[5]=[T("定制级别",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"会员级别"},{default:s(()=>[o(w,{modelValue:e.value.levelCodes,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.levelCodes=a),multiple:"",placeholder:"选择级别（不选择则导出所有级别）",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":""},{default:s(()=>[(F(!0),Y(J,null,X(m.value,a=>(F(),E(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Rl=ee({__name:"cost",props:{visible:{type:Boolean},id:{}},emits:["update:visible","success"],setup(d,{emit:n}){const t=d,f=n,r=b(!1),e=b({price:{},alternative_standard_price:{},alternative_wildcard_price:{}}),i=b([]),m=b([]),u=D({get:()=>t.visible,set:l=>f("update:visible",l)}),C=()=>{const l={price:q({},e.value.price||{})};m.value.includes("standard")&&(l.alternative_standard_price=q({},e.value.alternative_standard_price||{})),m.value.includes("wildcard")&&(l.alternative_wildcard_price=q({},e.value.alternative_wildcard_price||{})),i.value.forEach(p=>{const w=p.toString();l.price[w]||(l.price[w]=0),m.value.includes("standard")&&l.alternative_standard_price&&(l.alternative_standard_price[w]||(l.alternative_standard_price[w]=0)),m.value.includes("wildcard")&&l.alternative_wildcard_price&&(l.alternative_wildcard_price[w]||(l.alternative_wildcard_price[w]=0))}),e.value=l};G(()=>t.visible,l=>N(null,null,function*(){l&&t.id>0&&(yield x())})),G(()=>t.id,l=>N(null,null,function*(){l&&t.visible&&(yield x())})),G([()=>i.value,()=>m.value],()=>{C()});const x=()=>N(null,null,function*(){r.value=!0;try{cl(t.id).then(({data:l})=>{i.value=l.periods||[],m.value=l.alternative_name_types||[];const p=q({price:{}},l.cost||{});p.price||(p.price={}),e.value=p,C()})}finally{r.value=!1}}),P=()=>{f("update:visible",!1)},y=()=>N(null,null,function*(){r.value=!0;const l={price:q({},e.value.price)};m.value.includes("standard")&&e.value.alternative_standard_price&&(l.alternative_standard_price=q({},e.value.alternative_standard_price)),m.value.includes("wildcard")&&e.value.alternative_wildcard_price&&(l.alternative_wildcard_price=q({},e.value.alternative_wildcard_price)),ml(t.id,l).then(()=>{Z("更新成本成功",{type:"success"}),P(),f("success")}).finally(()=>{r.value=!1})});return(l,p)=>{const w=h("el-table-column"),V=h("el-input-number"),I=h("el-table"),R=h("el-button"),O=h("el-dialog"),U=Fe("loading");return F(),E(O,{modelValue:u.value,"onUpdate:modelValue":p[0]||(p[0]=_=>u.value=_),title:"编辑成本",width:"800px","destroy-on-close":"",onClosed:P},{footer:s(()=>[o(R,{onClick:P},{default:s(()=>[...p[1]||(p[1]=[T("取消",-1)])]),_:1}),o(R,{type:"primary",loading:r.value,onClick:y},{default:s(()=>[...p[2]||(p[2]=[T(" 确定 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[ze((F(),Y("div",null,[o(I,{data:i.value,border:"",style:{width:"100%"}},{default:s(()=>[o(w,{label:"周期",width:"100",align:"center"},{default:s(({row:_})=>[T(ce(_)+"个月 ",1)]),_:1}),o(w,{label:"基础价格",align:"center"},{default:s(({row:_})=>[o(V,{modelValue:e.value.price[_],"onUpdate:modelValue":a=>e.value.price[_]=a,min:0,precision:2,"controls-position":"right",style:{width:"160px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),m.value.includes("standard")?(F(),E(w,{key:0,label:"附加标准域名价格",align:"center"},{default:s(({row:_})=>{var a;return[o(V,{"model-value":((a=e.value.alternative_standard_price)==null?void 0:a[_])||0,min:0,precision:2,"controls-position":"right",style:{width:"160px"},"onUpdate:modelValue":g=>{e.value.alternative_standard_price||(e.value.alternative_standard_price={}),e.value.alternative_standard_price[_]=g}},null,8,["model-value","onUpdate:modelValue"])]}),_:1})):ie("",!0),m.value.includes("wildcard")?(F(),E(w,{key:1,label:"附加通配符价格",align:"center"},{default:s(({row:_})=>{var a;return[o(V,{"model-value":((a=e.value.alternative_wildcard_price)==null?void 0:a[_])||0,min:0,precision:2,"controls-position":"right",style:{width:"160px"},"onUpdate:modelValue":g=>{e.value.alternative_wildcard_price||(e.value.alternative_wildcard_price={}),e.value.alternative_wildcard_price[_]=g}},null,8,["model-value","onUpdate:modelValue"])]}),_:1})):ie("",!0)]),_:1},8,["data"])])),[[U,r.value]])]),_:1},8,["modelValue"])}}}),ql=De(Rl,[["__scopeId","data-v-073c48e4"]]),Ol={class:"main"},Ul={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Al={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},El={class:"flex-auto"},Bl={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Ll=ee({name:"Product",__name:"index",setup(d){const{drawerSize:n}=el(),{sourcesList:t,getSourcesList:f}=Il(),{tableRef:r,selectedIds:e,handleSelectionChange:i,handleSelectionCancel:m,tableColumns:u,handleRowClick:C}=Vl(t),{loading:x,search:P,dataList:y,pagination:l,isSinglePage:p,handleSizeChange:w,handleCurrentChange:V,onSearch:I,handleDestroy:R,handleBatchDestroy:O}=Sl(r),{searchColumns:U,debouncedSearch:_}=xl(()=>I()),{storeRef:a,showStore:g,storeId:z,storeColumns:le,rules:me,storeValues:W,openStoreForm:ve,confirmStoreForm:Re,closeStoreForm:qe}=Tl(()=>I(),t),te=b(!1),Oe=()=>{te.value=!0},ae=b(!1),fe=b(0),Ue=B=>{fe.value=B.id,ae.value=!0},oe=b(!1),_e=b(null),Ae=B=>{var v;_e.value=(v=B==null?void 0:B.id)!=null?v:null,oe.value=!0},re=b(!1),Ee=()=>{re.value=!0},ge=B=>{const v=S=>{if(S==null)return!0;if(typeof S=="number")return S===0;if(typeof S=="string"){const A=S.trim();if(A==="")return!0;const L=Number(A);return!Number.isNaN(L)&&L===0}if(Array.isArray(S))return S.length===0?!0:S.every(A=>v(A));if(typeof S=="object"){const A=Object.values(S!=null?S:{});return A.length===0?!0:A.every(L=>v(L))}return!1};return v(B)};return Ie(()=>{f(),I()}),(B,v)=>{const S=h("el-button"),A=h("el-tooltip"),L=h("el-popconfirm"),Be=h("pure-table"),Le=Fe("motion-fade");return F(),Y("div",Ol,[Q("div",Ul,[o(c(vl),{modelValue:c(P),"onUpdate:modelValue":v[0]||(v[0]=k=>we(P)?P.value=k:null),columns:c(U),"show-number":7,"col-props":{xs:24,sm:24,md:24,lg:24,xl:24},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:c(_)},null,8,["modelValue","columns","onChange"])]),o(c(Xe),{title:"产品管理",columns:c(u),onRefresh:c(I)},{buttons:s(()=>[o(S,{type:"primary",onClick:Oe},{default:s(()=>[...v[8]||(v[8]=[T("导入产品",-1)])]),_:1}),o(S,{type:"primary",onClick:v[1]||(v[1]=k=>c(ve)())},{default:s(()=>[...v[9]||(v[9]=[T("新增产品",-1)])]),_:1}),o(S,{type:"success",onClick:Ee},{default:s(()=>[...v[10]||(v[10]=[T("导出价格",-1)])]),_:1})]),default:s(({size:k,dynamicColumns:Me})=>[c(e).length>0?ze((F(),Y("div",Al,[Q("div",El,[o(A,{placement:"top",content:"取消选择"},{default:s(()=>[o(S,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:c(Je)(c(Cl)),onClick:c(m)},null,8,["icon","onClick"])]),_:1}),Q("span",Bl," 已选 "+ce(c(e).length)+" 项 ",1)]),o(L,{title:"确定要删除吗？",width:"160px",onConfirm:v[2]||(v[2]=M=>c(O)(c(e)))},{reference:s(()=>[o(S,{type:"danger",size:"small"},{default:s(()=>[...v[11]||(v[11]=[T(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[Le]]):ie("",!0),o(Be,{ref_key:"tableRef",ref:r,"row-key":"id","align-whole":"left","table-layout":"auto",loading:c(x),size:k,adaptive:"",adaptiveConfig:{offsetBottom:c(p)?44:108},data:c(y),columns:Me,pagination:se(q({},c(l)),{size:k}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:c(C),onSelectionChange:c(i),onPageSizeChange:c(w),onPageCurrentChange:c(V)},{operation:s(({row:M})=>[o(S,{class:"reset-margin !outline-none",type:"primary",link:"",size:k,onClick:ne=>c(ve)(M.id)},{default:s(()=>[...v[12]||(v[12]=[T(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),o(S,{class:"reset-margin !outline-none",type:ge(M.cost)?"danger":"primary",link:"",size:k,onClick:ne=>Ue(M)},{default:s(()=>[...v[13]||(v[13]=[T(" 成本 ",-1)])]),_:1},8,["type","size","onClick"]),o(S,{class:"reset-margin !outline-none",type:ge(M.prices)?"danger":"primary",link:"",size:k,onClick:ne=>Ae(M)},{default:s(()=>[...v[14]||(v[14]=[T(" 价格 ",-1)])]),_:1},8,["type","size","onClick"]),o(L,{title:"确定要删除吗？",width:"160px",onConfirm:ne=>c(R)(M.id)},{reference:s(()=>[o(S,{class:"reset-margin !outline-none",link:"",type:"danger",size:k},{default:s(()=>[...v[15]||(v[15]=[T(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","adaptiveConfig","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),o(c(wl),{ref_key:"storeRef",ref:a,modelValue:c(W),"onUpdate:modelValue":v[3]||(v[3]=k=>we(W)?W.value=k:null),visible:c(g),form:{columns:c(le),rules:c(me),labelPosition:"right",labelSuffix:"",labelWidth:"150px"},size:c(n),closeOnClickModal:!0,title:c(z)>0?"编辑产品":"新增产品",confirmText:"提交",cancelText:"取消",onConfirm:c(Re),onCancel:c(qe)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"]),o(Fl,{visible:te.value,"onUpdate:visible":v[4]||(v[4]=k=>te.value=k),"sources-list":c(t),onSuccess:c(I)},null,8,["visible","sources-list","onSuccess"]),o(ql,{id:fe.value,visible:ae.value,"onUpdate:visible":v[5]||(v[5]=k=>ae.value=k),onSuccess:c(I)},null,8,["id","visible","onSuccess"]),o(hl,{modelValue:oe.value,"onUpdate:modelValue":v[6]||(v[6]=k=>oe.value=k),"product-id":_e.value,onSaved:c(I)},null,8,["modelValue","product-id","onSaved"]),o(Dl,{visible:re.value,"onUpdate:visible":v[7]||(v[7]=k=>re.value=k)},null,8,["visible"])])}}}),lt=De(Ll,[["__scopeId","data-v-dd5f71cc"]]);export{lt as default};
