var ne=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var $=(e,o,r)=>o in e?ne(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,B=(e,o)=>{for(var r in o||(o={}))ie.call(o,r)&&$(e,r,o[r]);if(Y)for(var r of Y(o))ue.call(o,r)&&$(e,r,o[r]);return e},V=(e,o)=>re(e,se(o));import{P as ce,a as pe}from"./plus-search-B_b347ed.js";import{k as x,r as h,l as de,m as A,t as me,n as fe,p as ge,f as u,h as b,A as P,q as he,I as be,s as ve,d as Ce,o as ye,M as Se,c as O,e as D,v as E,i as t,j,w as C,x as _e,y as M,z as xe,E as K,B as ke,_ as we}from"./index-Czs_s45H.js";import{c as Pe,p as Re}from"./utils-BFFS1riR.js";import{g as ze}from"./datePicker-WHgduTab.js";import{_ as Fe}from"./index.vue_vue_type_script_setup_true_lang-pol5f9Kl.js";import{u as Te}from"./hooks-BC8gGHVq.js";import{u as De}from"./drawer-Buoy5E4X.js";import{C as Ie}from"./close-bold-CJxBGuFX.js";import{P as Be}from"./index-DJVwwjTC.js";import"./index-CMrlkQOr.js";import"./epTheme-NuZyHsuP.js";function Ve(e){return x.get("/invoice",{params:e})}const L={user_id:0,amount:0,organization:"",taxation:"",remark:"",email:"",status:0},Ee=Object.keys(L);function Me(e){return x.post("/invoice",{data:e})}function qe(e,o){return x.put(`/invoice/${e}`,{data:o})}function Ne(e){return x.get(`/invoice/${e}`)}function Ue(e){return x.delete(`/invoice/${e}`)}function Ye(e){return x.delete("/invoice/batch",{data:{ids:e}})}function $e(e){const o=h({}),r=h([]),a=h(!0),n=de({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function f(l){n.pageSize=l,v()}function g(l){n.currentPage=l,v()}const s=h(!1),i=h(0),c=l=>{s.value=!0,l?i.value=l:i.value=0},d=l=>{Ue(l).then(()=>{A("删除成功",{type:"success"}),v()})},_=l=>{Ye(l).then(()=>{A("删除成功",{type:"success"}),v()})};function v(){a.value=!0;const l=V(B({},me(o.value)),{pageSize:n.pageSize,currentPage:n.currentPage});l.created_at&&(l.created_at=Pe(l.created_at)),Ve(l).then(({data:m})=>{r.value=m.items,n.total=m.total,n.pageSize=m.pageSize,n.currentPage=m.currentPage,fe(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{a.value=!1})}return{loading:a,search:o,dataList:r,pagination:n,handleSizeChange:f,handleCurrentChange:g,onSearch:v,onReset:()=>{v()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:s,updateId:i,handleStore:c,handleDestroy:d,handleBatchDestroy:_}}function Ae(e){const o=ge(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/组织/邮箱"},onChange:()=>{o()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},options:[{label:"处理中",value:0},{label:"已开票",value:1},{label:"已作废",value:2}],onChange:()=>{o()}},{label:"用户名",prop:"user.username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"组织",prop:"organization",valueType:"input",fieldProps:{placeholder:"请输入组织名称"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"金额",prop:"amount",renderField:(a,n)=>{var g,s;const f=(i,c)=>{i!==void 0&&c!==void 0&&i>c||n([i,c])};return u("div",{class:"flex items-center gap-2 w-full"},[u(b("el-input"),{class:"flex-1",modelValue:(g=a==null?void 0:a[0])==null?void 0:g.toString(),"onUpdate:modelValue":i=>{const c=i===""?void 0:Number(i);f(c,a==null?void 0:a[1])},placeholder:"最小金额",clearable:!0},null),u("span",{class:"flex-none"},[P("至")]),u(b("el-input"),{class:"flex-1",modelValue:(s=a==null?void 0:a[1])==null?void 0:s.toString(),"onUpdate:modelValue":i=>{const c=i===""?void 0:Number(i);f(a==null?void 0:a[0],c)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ze()}}]}}function Oe(e){const o=h(!1),r=h(),a=h(0),n=h({}),f=he(()=>a.value>0),g=h(0),s=[{label:"用户名",prop:"user_id",valueType:"select",renderField:(l,m)=>u(Fe,{modelValue:l,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:m,refreshKey:a.value,disabled:f.value},null)},{label:"金额",prop:"amount",valueType:"input-number",fieldProps:{placeholder:"请输入金额",min:0,precision:2,controlsPosition:"right",get disabled(){return f.value}}},{label:"组织",prop:"organization",valueType:"input",fieldProps:{placeholder:"请输入组织名称",get disabled(){return f.value}}},{label:"税号",prop:"taxation",valueType:"input",fieldProps:{placeholder:"请输入税号",get disabled(){return f.value}}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱",get disabled(){return f.value}}},{label:"备注",prop:"remark",valueType:"textarea",fieldProps:{placeholder:"请输入备注",rows:3}},{label:"状态",prop:"status",valueType:"select",renderField:(l,m)=>u(b("el-select"),{modelValue:l,"onUpdate:modelValue":y=>l=y,placeholder:"请选择状态",onChange:m,disabled:g.value===2},{default:()=>[g.value===0&&u(b("el-option"),{label:"处理中",value:0},null),g.value!==2&&u(b("el-option"),{label:"已开票",value:1},null),g.value>0&&u(b("el-option"),{label:"已作废",value:2},null)]})}],i={user_id:[{required:!0,message:"请选择用户",trigger:"blur"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur"}],organization:[{required:!0,message:"请输入组织名称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]};function c(l=0){var m,y,F;o.value=!0,l>0?a.value!==l&&v(l):((y=(m=r.value)==null?void 0:m.formInstance)==null||y.resetFields(),n.value=Object.fromEntries(Object.entries(L).filter(([q,T])=>T!==0&&T!==""))),n.value.status=(F=n.value.status)!=null?F:0,g.value=n.value.status,a.value=l}function d(){a.value>0?z():R()}function _(){o.value=!1}const v=l=>{Ne(l).then(m=>{var y;n.value=Re(m.data,Ee),n.value.amount=Number((y=n.value.amount)!=null?y:0)})},R=()=>{Me(n.value).then(()=>{e(),o.value=!1})},z=()=>{qe(a.value,n.value).then(()=>{e(),o.value=!1})};return{showStore:o,storeRef:r,storeId:a,storeValues:n,storeColumns:s,rules:i,openStoreForm:c,confirmStoreForm:d,closeStoreForm:_}}function je(){const e=h(),o=h([]),r=s=>{o.value=s.map(i=>i.id),e.value.setAdaptive()},a=()=>{var s;(s=e.value)==null||s.getTableRef().clearSelection()},n={0:{label:"处理中",type:"primary"},1:{label:"已开票",type:"success"},2:{label:"已作废",type:"danger"}},f=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:130},{label:"用户名",prop:"user.username",width:100,cellRenderer:be("user.username")},{label:"金额",prop:"amount",width:100},{label:"组织",prop:"organization",minWidth:150},{label:"备注",prop:"remark",minWidth:150},{label:"状态",prop:"status",width:100,cellRenderer:({row:s,props:i})=>{var c;return u(b("el-tag"),{size:i.size,type:(c=n[s.status])==null?void 0:c.type,effect:"plain"},{default:()=>{var d;return[(d=n[s.status])==null?void 0:d.label]}})}},{label:"创建时间",prop:"created_at",width:160,formatter:({created_at:s})=>s?ve(s).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",width:110,slot:"operation"}];return{tableRef:e,selectedIds:o,tableColumns:f,handleSelectionChange:r,handleSelectionCancel:a,handleRowClick:(s,i,c)=>{var _;const d=c.target;d.tagName==="BUTTON"||d.closest("button")||d.closest(".el-button")||(_=e.value)==null||_.getTableRef().toggleRowSelection(s)}}}const Ke={class:"main"},Le={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},He={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},We={class:"flex-auto"},Ge={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Je=Ce({name:"Invoice",__name:"index",setup(e){const{drawerSize:o}=De(),r=Se(),{tableRef:a,selectedIds:n,handleSelectionChange:f,handleSelectionCancel:g,tableColumns:s,handleRowClick:i}=je(),{loading:c,search:d,dataList:_,pagination:v,handleSizeChange:R,handleCurrentChange:z,onSearch:l,onReset:m,onCollapse:y,handleDestroy:F,handleBatchDestroy:q}=$e(a),{searchColumns:T}=Ae(()=>l()),{storeRef:H,showStore:W,storeId:G,storeColumns:J,rules:Q,storeValues:I,openStoreForm:N,confirmStoreForm:X,closeStoreForm:Z}=Oe(()=>l());return ye(()=>{r.query.id&&(d.value.id=Number(r.query.id)),l()}),(Qe,p)=>{const k=b("el-button"),ee=b("el-tooltip"),U=b("el-popconfirm"),te=b("pure-table"),le=ke("motion-fade");return D(),O("div",Ke,[E("div",Le,[u(t(ce),{modelValue:t(d),"onUpdate:modelValue":p[0]||(p[0]=S=>j(d)?d.value=S:null),columns:t(T),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(l),onReset:t(m),onCollapse:t(y)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),u(t(pe),{title:"发票管理",columns:t(s),onRefresh:t(l)},{buttons:C(()=>[u(k,{type:"primary",onClick:p[1]||(p[1]=S=>t(N)())},{default:C(()=>p[4]||(p[4]=[P("新增发票")])),_:1})]),default:C(({size:S,dynamicColumns:oe})=>[t(n).length>0?_e((D(),O("div",He,[E("div",We,[u(ee,{placement:"top",content:"取消选择"},{default:C(()=>[u(k,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Te)(t(Ie)),onClick:t(g)},null,8,["icon","onClick"])]),_:1}),E("span",Ge," 已选 "+xe(t(n).length)+" 项 ",1)]),u(U,{title:"确定要删除吗？",width:"160px",onConfirm:p[2]||(p[2]=w=>t(q)(t(n)))},{reference:C(()=>[u(k,{type:"danger",size:"small"},{default:C(()=>p[5]||(p[5]=[P(" 批量删除 ")])),_:1})]),_:1})])),[[le]]):M("",!0),u(te,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(c),size:S,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(_),columns:oe,pagination:V(B({},t(v)),{size:S}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(i),onSelectionChange:t(f),onPageSizeChange:t(R),onPageCurrentChange:t(z)},{operation:C(({row:w})=>[w.status!==2?(D(),K(k,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:S,onClick:ae=>t(N)(w.id)},{default:C(()=>p[6]||(p[6]=[P(" 编辑 ")])),_:2},1032,["size","onClick"])):M("",!0),w.status===0?(D(),K(U,{key:1,title:"确定要删除吗？",width:"160px",onConfirm:ae=>t(F)(w.id)},{reference:C(()=>[u(k,{class:"reset-margin !outline-none",link:"",type:"danger",size:S},{default:C(()=>p[7]||(p[7]=[P(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])):M("",!0)]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),u(t(Be),{ref_key:"storeRef",ref:H,modelValue:t(I),"onUpdate:modelValue":p[3]||(p[3]=S=>j(I)?I.value=S:null),visible:t(W),form:{columns:t(J),rules:t(Q),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:t(G)>0?"编辑发票":"新增发票",confirmText:"提交",cancelText:"取消",onConfirm:t(X),onCancel:t(Z)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),ct=we(Je,[["__scopeId","data-v-fbd78328"]]);export{ct as default};
