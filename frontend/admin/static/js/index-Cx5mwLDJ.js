var te=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var w=(o,u,a)=>u in o?te(o,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[u]=a,P=(o,u)=>{for(var a in u||(u={}))se.call(u,a)&&w(o,a,u[a]);if(M)for(var a of M(u))re.call(u,a)&&w(o,a,u[a]);return o},T=(o,u)=>ne(o,oe(u));import{r as h,l as O,aS as ue,Q as $,t as ie,j as l,D as v,f as c,b9 as de,q as pe,e as ce,o as me,g as N,i as R,y as fe,u as e,k as W,w as i,P as be,H as q,I as j,G as A,_ as ge}from"./index-2C-ofHV5.js";import{d as ve,i as he,u as _e,s as Ce}from"./notificationTemplate-BVb_ANBk.js";import{P as ye}from"./plus-search-B1FvdIYy.js";import"./index-CaJyLCRQ.js";function Ve(){const o=h({name:"",code:"",status:"",channel:""}),u=h([]),a=h(!0),n=O({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function s(m){n.pageSize=m,f()}function V(m){n.currentPage=m,f()}function f(){a.value=!0;const m=T(P({},ie(o.value)),{pageSize:n.pageSize,currentPage:n.currentPage});he(m).then(({data:b})=>{u.value=b.items,n.total=b.total,n.pageSize=b.pageSize,n.currentPage=b.currentPage}).finally(()=>{a.value=!1})}return{loading:a,search:o,dataList:u,pagination:n,handleSizeChange:s,handleCurrentChange:V,onSearch:f,onReset:()=>{o.value.name="",o.value.code="",o.value.status="",o.value.channel="",n.currentPage=1,f()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},handleDelete:m=>{ue.confirm(`确定删除模板「${m.name}」吗？`,"提示",{type:"warning"}).then(()=>{ve(m.id).then(()=>{$.success("删除成功"),f()})})}}}const xe=[{label:"启用",value:1},{label:"停用",value:0}],U=[{label:"邮件通知",value:"mail"},{label:"短信通知",value:"sms"}];function ke(){return{searchColumns:[{label:"名称",prop:"name",valueType:"input",fieldProps:{clearable:!0,placeholder:"请输入模板名称"}},{label:"标识",prop:"code",valueType:"input",fieldProps:{clearable:!0,placeholder:"如 cert_issued"}},{label:"状态",prop:"status",valueType:"select",options:[{label:"全部",value:""},...xe],fieldProps:{placeholder:"请选择状态"}},{label:"通道",prop:"channel",valueType:"select",options:[{label:"全部",value:""},...U],fieldProps:{placeholder:"请选择通道"}}]}}function Re(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!de(o)}const Se=U.reduce((o,u)=>(o[u.value]=u.label,o),{});function ze(){return{tableRef:h(),tableColumns:[{label:"ID",prop:"id",minWidth:90},{label:"名称",prop:"name",minWidth:180},{label:"标识",prop:"code",minWidth:180},{label:"通道",prop:"channels",minWidth:200,cellRenderer:({row:a})=>!a.channels||a.channels.length===0?l("span",{class:"text-muted"},[v("-")]):l("div",null,[a.channels.map(n=>l(c("el-tag"),{key:n,size:"small",type:"info",class:"mr-1 mb-1"},{default:()=>{var s;return[(s=Se[n])!=null?s:n]}}))])},{label:"变量",prop:"variables",minWidth:200,cellRenderer:({row:a})=>!a.variables||a.variables.length===0?l("span",{class:"text-muted"},[v("-")]):l("div",null,[a.variables.map(n=>l(c("el-tag"),{key:n,size:"small",effect:"light",class:"mr-1 mb-1"},Re(n)?n:{default:()=>[n]}))])},{label:"状态",prop:"status",width:100,cellRenderer:({row:a,props:n})=>l(c("el-tag"),{size:n.size,type:a.status===1?"success":"info",effect:"plain"},{default:()=>[a.status===1?"启用":"停用"]})},{label:"更新时间",prop:"updated_at",minWidth:180},{label:"操作",prop:"operation",width:110,fixed:"right",slot:"operation"}]}}function Pe(o){const u=h(!1),a=h(),n=h(null),s=O({name:"",code:"",content:"",variables:[],example:"",status:1,channels:["mail"]}),V={name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],code:[{required:!0,message:"请输入模板标识",trigger:"blur"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"}],channels:[{required:!0,type:"array",min:1,message:"请选择至少一个通道",trigger:"change"}]},f=pe(()=>{var d;return(d=s.variables)!=null?d:[]}),S=()=>{s.name="",s.code="",s.content="",s.variables=[],s.example="",s.status=1,s.channels=["mail"]};return{formDialogVisible:u,formRef:a,editingId:n,formModel:s,formRules:V,variableInput:f,openCreate:()=>{n.value=null,S(),u.value=!0},openEdit:d=>{var C;n.value=d.id,s.name=d.name,s.code=d.code,s.content=d.content,s.variables=Array.isArray(d.variables)?[...d.variables]:[],s.example=(C=d.example)!=null?C:"",s.status=d.status,s.channels=Array.isArray(d.channels)?[...d.channels]:["mail"],u.value=!0},submitForm:()=>{var d;(d=a.value)==null||d.validate(C=>{var x,p;if(!C)return;const y=T(P({},s),{variables:((x=s.variables)!=null?x:[]).filter(Boolean),channels:((p=s.channels)!=null?p:[]).filter(Boolean)});(n.value?_e(n.value,y):Ce(y)).then(()=>{$.success(n.value?"更新成功":"创建成功"),u.value=!1,o()})})},closeForm:()=>{u.value=!1}}}const Te={class:"main"},Be={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ne=ce({name:"NotificationTemplate",__name:"index",setup(o){const{tableRef:u,tableColumns:a}=ze(),{loading:n,search:s,dataList:V,pagination:f,handleSizeChange:S,handleCurrentChange:B,onSearch:_,onReset:m,onCollapse:b,handleDelete:d}=Ve(),{searchColumns:C}=ke(),{formDialogVisible:y,formRef:E,editingId:x,formModel:p,formRules:L,variableInput:G,openCreate:H,openEdit:Q,submitForm:J,closeForm:K}=Pe(()=>_());return me(()=>{_()}),(Ue,r)=>{const k=c("el-button"),X=c("pure-table"),z=c("el-input"),g=c("el-form-item"),Y=c("el-switch"),F=c("el-option"),D=c("el-select"),Z=c("el-form"),ee=c("el-dialog");return R(),N("div",Te,[fe("div",Be,[l(e(ye),{modelValue:e(s),"onUpdate:modelValue":r[0]||(r[0]=t=>W(s)?s.value=t:null),columns:e(C),"show-number":3,"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onSearch:e(_),onReset:e(m),onCollapse:e(b)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),l(e(be),{title:"通知模板",columns:e(a),onRefresh:e(_)},{buttons:i(()=>[l(k,{type:"primary",onClick:e(H)},{default:i(()=>[...r[9]||(r[9]=[v("新增模板",-1)])]),_:1},8,["onClick"])]),default:i(({size:t,dynamicColumns:le})=>[l(X,{ref_key:"tableRef",ref:u,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(n),size:t,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(V),columns:le,pagination:T(P({},e(f)),{size:t}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:e(S),onPageCurrentChange:e(B)},{operation:i(({row:I})=>[l(k,{class:"reset-margin !outline-none",type:"primary",link:"",size:t,onClick:ae=>e(Q)(I)},{default:i(()=>[...r[10]||(r[10]=[v(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),l(k,{class:"reset-margin !outline-none",type:"danger",link:"",size:t,onClick:ae=>e(d)(I)},{default:i(()=>[...r[11]||(r[11]=[v(" 删除 ",-1)])]),_:1},8,["size","onClick"])]),_:2},1032,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),l(ee,{modelValue:e(y),"onUpdate:modelValue":r[8]||(r[8]=t=>W(y)?y.value=t:null),title:e(x)?"编辑模板":"新增模板",width:"680px","destroy-on-close":""},{footer:i(()=>[l(k,{onClick:e(K)},{default:i(()=>[...r[12]||(r[12]=[v("取消",-1)])]),_:1},8,["onClick"]),l(k,{type:"primary",onClick:e(J)},{default:i(()=>[...r[13]||(r[13]=[v("保存",-1)])]),_:1},8,["onClick"])]),default:i(()=>[l(Z,{ref_key:"formRef",ref:E,model:e(p),rules:e(L),"label-width":"100px"},{default:i(()=>[l(g,{label:"名称",prop:"name"},{default:i(()=>[l(z,{modelValue:e(p).name,"onUpdate:modelValue":r[1]||(r[1]=t=>e(p).name=t),placeholder:"证书签发通知"},null,8,["modelValue"])]),_:1}),l(g,{label:"标识",prop:"code"},{default:i(()=>[l(z,{modelValue:e(p).code,"onUpdate:modelValue":r[2]||(r[2]=t=>e(p).code=t),placeholder:"cert_issued",disabled:!!e(x)},null,8,["modelValue","disabled"])]),_:1}),l(g,{label:"状态",prop:"status"},{default:i(()=>[l(Y,{modelValue:e(p).status,"onUpdate:modelValue":r[3]||(r[3]=t=>e(p).status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),l(g,{label:"通道",prop:"channels"},{default:i(()=>[l(D,{modelValue:e(p).channels,"onUpdate:modelValue":r[4]||(r[4]=t=>e(p).channels=t),multiple:"",placeholder:"请选择发送通道"},{default:i(()=>[(R(!0),N(q,null,j(e(U),t=>(R(),A(F,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"变量",prop:"variables"},{default:i(()=>[l(D,{modelValue:e(p).variables,"onUpdate:modelValue":r[5]||(r[5]=t=>e(p).variables=t),multiple:"","allow-create":"",filterable:"","default-first-option":"",placeholder:"请输入变量名称，例如 username"},{default:i(()=>[(R(!0),N(q,null,j(e(G),t=>(R(),A(F,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"内容",prop:"content"},{default:i(()=>[l(z,{modelValue:e(p).content,"onUpdate:modelValue":r[6]||(r[6]=t=>e(p).content=t),type:"textarea",rows:6,placeholder:"例如：您好 {username}"},null,8,["modelValue"])]),_:1}),l(g,{label:"示例"},{default:i(()=>[l(z,{modelValue:e(p).example,"onUpdate:modelValue":r[7]||(r[7]=t=>e(p).example=t),type:"textarea",rows:4,placeholder:"示例内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),we=ge(Ne,[["__scopeId","data-v-35b9dba3"]]);export{we as default};
