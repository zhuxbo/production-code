var T=Object.defineProperty,v=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var S=(n,a,t)=>a in n?T(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t,b=(n,a)=>{for(var t in a||(a={}))z.call(a,t)&&S(n,t,a[t]);if(y)for(var t of y(a))D.call(a,t)&&S(n,t,a[t]);return n},C=(n,a)=>v(n,k(a));import{K as Y,r as g,l as M,t as V,n as B,p as N,j as p,f as m,D as U,E,M as F,v as j,e as q,o as H,g as I,i as L,y as O,u as o,k as A,w as K,P as W,_ as $}from"./index-2C-ofHV5.js";import{c as G}from"./utils-C-gUDCcE.js";import{P as J}from"./plus-search-B1FvdIYy.js";import{g as Q}from"./datePicker-ZEs-rmon.js";import"./index-CaJyLCRQ.js";function X(n){return Y.get("/transaction",{params:n})}function Z(n){const a=g({}),t=g([]),e=g(!0),r=M({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function c(i){r.pageSize=i,u()}function d(i){r.currentPage=i,u()}function u(){e.value=!0;const i=C(b({},V(a.value)),{pageSize:r.pageSize,currentPage:r.currentPage});i.created_at&&(i.created_at=G(i.created_at)),X(i).then(({data:f})=>{t.value=f.items,r.total=f.total,r.pageSize=f.pageSize,r.currentPage=f.currentPage,B(()=>{n.value&&n.value.getTableRef().clearSelection()})}).finally(()=>{e.value=!1})}return{loading:e,search:a,dataList:t,pagination:r,handleSizeChange:c,handleCurrentChange:d,onSearch:u,onReset:()=>{u()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const x=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"},{label:"订单",value:"order"},{label:"取消",value:"cancel"}],ee={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger",order:"primary",cancel:"danger"};function ae(n){const a=N(()=>{n()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/交易单号/备注"},onChange:()=>{a()}},{label:"交易类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择交易类型"},options:x,onChange:()=>{a()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"交易单号",prop:"transaction_id",valueType:"input",fieldProps:{placeholder:"请输入交易单号"}},{label:"金额",prop:"amount",renderField:(e,r)=>{var d,u;const c=(s,l)=>{s!==void 0&&l!==void 0&&s>l||r([s,l])};return p("div",{class:"flex items-center gap-2 w-full"},[p(m("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[0])==null?void 0:d.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);c(l,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),p("span",{class:"flex-none"},[U("至")]),p(m("el-input"),{class:"flex-1",modelValue:(u=e==null?void 0:e[1])==null?void 0:u.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);c(e==null?void 0:e[0],l)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Q()}}]}}function ne(){const n=g(),a=E(),t=[{label:"用户名",prop:"user.username",width:100,cellRenderer:F("user.username")},{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:r})=>p(m("el-tag"),{size:r.size,type:ee[e.type],effect:"plain"},{default:()=>{var c;return[(c=x.find(d=>d.value===e.type))==null?void 0:c.label]}})},{label:"单号",prop:"transaction_id",width:145,cellRenderer:({row:e})=>p("span",{class:"cursor-pointer",onClick:()=>{const c=["order","cancel"].includes(e.type)?"/order":"/funds";a.push({path:c,query:{id:e.transaction_id}})}},[e.transaction_id])},{label:"交易金额",prop:"amount",width:100},{label:"交易前余额",prop:"balance_before",width:100},{label:"交易后余额",prop:"balance_after",width:100},{label:"备注",prop:"remark",minWidth:150},{label:"创建时间",prop:"created_at",width:160,formatter:({created_at:e})=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"}];return{tableRef:n,tableColumns:t}}const te={class:"main"},re={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=q({name:"Transaction",__name:"index",setup(n){const{tableRef:a,tableColumns:t}=ne(),{loading:e,search:r,dataList:c,pagination:d,handleSizeChange:u,handleCurrentChange:s,onSearch:l,onReset:i,onCollapse:f}=Z(a),{searchColumns:P}=ae(()=>l());return H(()=>{l()}),(le,_)=>{const w=m("pure-table");return L(),I("div",te,[O("div",re,[p(o(J),{modelValue:o(r),"onUpdate:modelValue":_[0]||(_[0]=h=>A(r)?r.value=h:null),columns:o(P),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:o(l),onReset:o(i),onCollapse:o(f)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),p(o(W),{title:"交易记录",columns:o(t),onRefresh:o(l)},{default:K(({size:h,dynamicColumns:R})=>[p(w,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:o(e),size:h,adaptive:"",adaptiveConfig:{offsetBottom:108},data:o(c),columns:R,pagination:C(b({},o(d)),{size:h}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:o(u),onPageCurrentChange:o(s)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),fe=$(oe,[["__scopeId","data-v-715dcf1f"]]);export{fe as default};
