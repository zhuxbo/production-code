var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var N=(e,a,r)=>a in e?Z(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,M=(e,a)=>{for(var r in a||(a={}))ae.call(a,r)&&N(e,r,a[r]);if($)for(var r of $(a))ne.call(a,r)&&N(e,r,a[r]);return e},I=(e,a)=>ee(e,te(a));import{e as j,r as C,f as _,g as R,i as w,j as c,w as u,u as n,H as le,I as oe,G as re,v as D,K as k,l as se,o as ce,t as ie,n as ue,m as b,aN as pe,p as de,E as fe,b9 as me,x as ge,y as H,k as he,z as be,A as _e,B as ve,C as ye,D as x,P as Ce,_ as ke}from"./index-2C-ofHV5.js";import{l as xe,P as Se}from"./vue-json-pretty-CC0b4iVL.js";import{c as we}from"./utils-C-gUDCcE.js";import{P as De}from"./plus-search-B1FvdIYy.js";import{g as Re}from"./datePicker-ZEs-rmon.js";import{C as Te}from"./close-bold-Dru7IMTV.js";import"./index-CaJyLCRQ.js";const Ye=j({__name:"detail",props:{data:{type:Object,default:()=>({})}},setup(e){const a=e,r=[{label:"ID",prop:"id"},{label:"订单ID",prop:"order_id"},{label:"动作",prop:"action"},{label:"状态",prop:"status"},{label:"执行次数",prop:"attempts"},{label:"来源",prop:"source"},{label:"开始时间",prop:"started_at",cellRenderer:()=>a.data.started_at?D(a.data.started_at).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"最后执行时间",prop:"last_execute_at",cellRenderer:()=>a.data.last_execute_at?D(a.data.last_execute_at).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"创建时间",prop:"created_at",cellRenderer:()=>a.data.created_at?D(a.data.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"}],i=C([{title:"响应",name:"result",data:a.data.result}]);return(p,S)=>{const v=_("el-scrollbar"),l=_("el-tab-pane"),o=_("el-tabs");return w(),R("div",null,[c(v,null,{default:u(()=>[c(n(xe),{border:"",data:[e.data],columns:r,column:5},null,8,["data"])]),_:1}),c(o,{modelValue:i.value[0].name,type:"border-card",class:"mt-4"},{default:u(()=>[(w(!0),R(le,null,oe(i.value,(f,g)=>(w(),re(l,{key:g,name:f.name,label:f.title},{default:u(()=>[c(v,{"max-height":"calc(100vh - 240px)"},{default:u(()=>[c(n(Se),{data:f.data,"onUpdate:data":m=>f.data=m},null,8,["data","onUpdate:data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])])}}});function Pe(e){return k.get("/task",{params:e})}function ze(e){return k.get(`/task/${e}`)}function Be(e){return k.post("/task/batch-start",{data:{ids:e}})}function Me(e){return k.post("/task/batch-stop",{data:{ids:e}})}function Ie(e){return k.post("/task/batch-execute",{data:{ids:e}})}function He(e){return k.delete(`/task/${e}`)}function Ve(e){return k.delete("/task/batch",{data:{ids:e}})}function $e(){const e=C({}),a=C(),r=C([]),i=C(!0),p=se({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function S(t){p.pageSize=t,o()}function v(t){p.currentPage=t,o()}function l(t){ze(t.id).then(d=>{pe({title:"任务详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>Ye,props:{data:d.data}})})}function o(){i.value=!0;const t=I(M({},ie(e.value)),{pageSize:p.pageSize,currentPage:p.currentPage});t.created_at&&(t.created_at=we(t.created_at)),t.order_id&&(t.order_id=Number(t.order_id)),Pe(t).then(({data:d})=>{r.value=d.items,p.total=d.total,p.pageSize=d.pageSize,p.currentPage=d.currentPage,ue(()=>{a.value&&a.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}const f=()=>{e.value={},o()},g=()=>{setTimeout(()=>{var t,d;window.dispatchEvent(new Event("resize")),(d=(t=a.value)==null?void 0:t.setAdaptive)==null||d.call(t)},500)},m=t=>{i.value=!0,He(t.id).then(()=>{b("删除成功",{type:"success"}),o()}).finally(()=>{i.value=!1})},T=t=>{if(!t||t.length===0){b("请选择要操作的任务",{type:"warning"});return}i.value=!0,Be(t).then(()=>{b("启动成功",{type:"success"}),o()}).finally(()=>{i.value=!1})},Y=t=>{if(!t||t.length===0){b("请选择要操作的任务",{type:"warning"});return}i.value=!0,Me(t).then(()=>{b("停止成功",{type:"success"}),o()}).finally(()=>{i.value=!1})},P=t=>{if(!t||t.length===0){b("请选择要操作的任务",{type:"warning"});return}i.value=!0,Ie(t).then(()=>{b("执行成功",{type:"success"}),o()}).finally(()=>{i.value=!1})},z=t=>{if(!t||t.length===0){b("请选择要删除的任务",{type:"warning"});return}i.value=!0,Ve(t).then(()=>{b("删除成功",{type:"success"}),o()}).finally(()=>{i.value=!1})};return ce(()=>{o()}),{tableRef:a,form:e,loading:i,dataList:r,pagination:p,onSearch:o,onResetSearch:f,onCollapse:g,onDelete:m,onDetail:l,onBatchStart:T,onBatchStop:Y,onBatchExecute:P,handleBatchDestroy:z,handleSizeChange:S,handleCurrentChange:v}}const L={commit:"提交",sync:"同步",revalidate:"验证",cancel:"取消",callback:"回调",delegation:"委托"},Ne=Object.entries(L).map(([e,a])=>({label:a,value:e})),Oe={commit:"primary",sync:"primary",revalidate:"primary",cancel:"danger",callback:"primary",delegation:"info"},E={executing:"执行中",successful:"成功",failed:"失败",stopped:"停止"},je=Object.entries(E).map(([e,a])=>({label:a,value:e})),Le={executing:"primary",successful:"success",failed:"danger",stopped:"warning"};function Ee(e){return L[e]||e}function Ae(e){return Oe[e]||"info"}function We(e){return E[e]||e}function Ue(e){return Le[e]||"info"}function Fe(e){const a=de(()=>{e()},500);return[{label:"动作",prop:"action",valueType:"select",options:Ne,fieldProps:{placeholder:"请选择动作"},onChange:()=>{a()}},{label:"状态",prop:"status",valueType:"select",options:je,fieldProps:{placeholder:"请选择状态"},onChange:()=>{a()}},{label:"来源",prop:"source",valueType:"input",fieldProps:{placeholder:"请输入来源"}},{label:"订单ID",prop:"order_id",valueType:"input",fieldProps:{placeholder:"请输入订单ID"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Re()}}]}function O(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!me(e)}const qe=()=>{const e=C(),a=C([]),r=fe();return{tableRef:e,selectedIds:a,tableColumns:[{label:"勾选列",type:"selection",width:30,reserveSelection:!0},{label:"ID",prop:"id",width:60},{label:"订单ID",prop:"order_id",minWidth:100,cellRenderer:({row:l})=>c("span",{class:"cursor-pointer",onClick:()=>{r.push({path:"/order",query:{id:l.order_id}})}},[l.order_id])},{label:"动作",prop:"action",minWidth:100,cellRenderer:({row:l})=>{let o;return c(_("el-tag"),{type:Ae(l.action)},O(o=Ee(l.action))?o:{default:()=>[o]})}},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:l})=>{let o;return c(_("el-tag"),{type:Ue(l.status)},O(o=We(l.status))?o:{default:()=>[o]})}},{label:"执行次数",prop:"attempts",minWidth:120},{label:"权重",prop:"weight",minWidth:100},{label:"来源",prop:"source",width:100},{label:"开始时间",prop:"started_at",width:170,formatter:({started_at:l})=>l?D(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"最后执行时间",prop:"last_execute_at",width:170,formatter:({last_execute_at:l})=>l?D(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleSelectionChange:l=>{a.value=l.map(o=>o.id),e.value.setAdaptive()},handleSelectionCancel:()=>{var l;(l=e.value)==null||l.getTableRef().clearSelection()},handleRowClick:(l,o,f)=>{var m;const g=f.target;g.tagName==="BUTTON"||g.closest("button")||g.closest(".el-button")||(m=e.value)==null||m.getTableRef().toggleRowSelection(l)}}},Ge={class:"main"},Ke={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[24px] overflow-auto"},Je={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Qe={class:"flex-auto"},Xe={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Ze=j({name:"Task",__name:"index",setup(e){const{tableRef:a,selectedIds:r,tableColumns:i,handleSelectionChange:p,handleSelectionCancel:S,handleRowClick:v}=qe(),{form:l,loading:o,dataList:f,pagination:g,onSearch:m,onDetail:T,onDelete:Y,onResetSearch:P,onCollapse:z,onBatchStart:t,onBatchStop:d,onBatchExecute:A,handleBatchDestroy:W,handleSizeChange:U,handleCurrentChange:F}=$e(),q=Fe(m);return(et,s)=>{const y=_("el-button"),G=_("el-tooltip"),V=_("el-popconfirm"),K=_("pure-table"),J=ge("motion-fade");return w(),R("div",Ge,[H("div",Ke,[c(n(De),{modelValue:n(l),"onUpdate:modelValue":s[0]||(s[0]=h=>he(l)?l.value=h:null),columns:n(q),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:n(m),onReset:n(P),onCollapse:n(z)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),c(n(Ce),{title:"任务管理",columns:n(i),onRefresh:n(m)},{buttons:u(()=>[c(y,{type:"primary",onClick:s[1]||(s[1]=h=>n(t)(n(r)))},{default:u(()=>[...s[5]||(s[5]=[x(" 启动 ",-1)])]),_:1}),c(y,{type:"warning",onClick:s[2]||(s[2]=h=>n(d)(n(r)))},{default:u(()=>[...s[6]||(s[6]=[x(" 停止 ",-1)])]),_:1}),c(y,{type:"success",onClick:s[3]||(s[3]=h=>n(A)(n(r)))},{default:u(()=>[...s[7]||(s[7]=[x(" 执行 ",-1)])]),_:1})]),default:u(({size:h,dynamicColumns:Q})=>[n(r).length>0?be((w(),R("div",Je,[H("div",Qe,[c(G,{placement:"top",content:"取消选择"},{default:u(()=>[c(y,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:n(ve)(n(Te)),onClick:n(S)},null,8,["icon","onClick"])]),_:1}),H("span",Xe," 已选 "+ye(n(r).length)+" 项 ",1)]),c(V,{title:"确定要删除吗？",width:"160px",onConfirm:s[4]||(s[4]=B=>n(W)(n(r)))},{reference:u(()=>[c(y,{type:"danger",size:"small"},{default:u(()=>[...s[8]||(s[8]=[x(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[J]]):_e("",!0),c(K,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:n(o),size:h,adaptive:"",adaptiveConfig:{offsetBottom:108},data:n(f),columns:Q,pagination:I(M({},n(g)),{size:h}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:n(v),onSelectionChange:n(p),onPageSizeChange:n(U),onPageCurrentChange:n(F)},{operation:u(({row:B})=>[c(y,{class:"reset-margin !outline-none",link:"",type:"primary",size:h,onClick:X=>n(T)(B)},{default:u(()=>[...s[9]||(s[9]=[x(" 详情 ",-1)])]),_:1},8,["size","onClick"]),c(V,{title:"确定要删除吗？",width:"160px",onConfirm:X=>n(Y)(B)},{reference:u(()=>[c(y,{class:"reset-margin !outline-none",link:"",type:"danger",size:h},{default:u(()=>[...s[10]||(s[10]=[x(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),it=ke(Ze,[["__scopeId","data-v-708c8ec4"]]);export{it as default};
