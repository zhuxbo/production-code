var me=Object.defineProperty,he=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var le=(e,o,s)=>o in e?me(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,K=(e,o)=>{for(var s in o||(o={}))ve.call(o,s)&&le(e,s,o[s]);if(te)for(var s of te(o))ye.call(o,s)&&le(e,s,o[s]);return e},L=(e,o)=>he(e,ge(o));var H=(e,o,s)=>new Promise((i,r)=>{var u=l=>{try{c(s.next(l))}catch(n){r(n)}},a=l=>{try{c(s.throw(l))}catch(n){r(n)}},c=l=>l.done?i(l.value):Promise.resolve(l.value).then(u,a);c((s=s.apply(e,o)).next())});import{K as T,r as b,l as be,m as I,t as Ce,n as _e,p as Se,j as f,f as P,D as R,S as ke,M as xe,v as J,e as Re,T as Pe,o as Te,x as ze,g as ae,i as F,y as G,u as t,k as ne,w as g,z as we,A as B,B as Fe,C as De,G as U,P as $e,_ as Be}from"./index-2C-ofHV5.js";import{c as Me,p as Oe}from"./utils-C-gUDCcE.js";import{P as Ve}from"./plus-search-B1FvdIYy.js";import{g as qe}from"./datePicker-ZEs-rmon.js";import{_ as Ie}from"./index.vue_vue_type_script_setup_true_lang-BHKqx4-E.js";import{u as Ue}from"./drawer-BlMYOobw.js";import{C as Ne}from"./close-bold-Dru7IMTV.js";import{P as Ye}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";const oe={user_id:0,amount:0,type:"",pay_method:"",pay_sn:"",remark:"",status:0},Ae=Object.keys(oe);function je(e){return T.get("/fund",{params:e})}function Ee(e){return T.post("/fund",{data:e})}function We(e,o){return T.put(`/fund/${e}`,{data:o})}function Ke(e){return T.get(`/fund/${e}`)}function Le(e){return T.delete(`/fund/${e}`)}function He(e){return T.delete("/fund/batch",{data:{ids:e}})}function Ge(e){return T.post(`/fund/refunds/${e}`)}function Je(e){return T.post(`/fund/reverse/${e}`)}function Qe(e){return T.post(`/fund/check/${e}`)}function Xe(e){const o=b({}),s=b([]),i=b(!0),r=be({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function u(p){r.pageSize=p,h()}function a(p){r.currentPage=p,h()}const c=b(!1),l=b(0),n=p=>{c.value=!0,p?l.value=p:l.value=0},C=p=>{Le(p).then(()=>{I("删除成功",{type:"success"}),h()})},M=p=>{He(p).then(()=>{I("删除成功",{type:"success"}),h()})},O=p=>{Ge(p).then(()=>{I("退款成功",{type:"success"}),h()})},V=p=>{Je(p).then(()=>{I("退回成功",{type:"success"}),h()})},q=p=>{Qe(p).then(()=>{I("充值成功",{type:"success"}),h()})};function h(){i.value=!0;const p=L(K({},Ce(o.value)),{pageSize:r.pageSize,currentPage:r.currentPage});p.created_at&&(p.created_at=Me(p.created_at)),je(p).then(({data:z})=>{s.value=z.items,r.total=z.total,r.pageSize=z.pageSize,r.currentPage=z.currentPage,_e(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:o,dataList:s,pagination:r,handleSizeChange:u,handleCurrentChange:a,onSearch:h,onReset:()=>{h()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:c,updateId:l,handleStore:n,handleDestroy:C,handleBatchDestroy:M,handleRefunds:O,handleReverse:V,handleCheck:q}}const Q=[{label:"支付宝",value:"alipay"},{label:"微信",value:"wechat"},{label:"银行卡",value:"credit"},{label:"淘宝",value:"taobao"},{label:"拼多多",value:"pinduoduo"},{label:"京东",value:"jingdong"},{label:"抖音",value:"douyin"},{label:"赠送",value:"gift"},{label:"其他",value:"other"}],E=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"}],Ze=[{label:"处理中",value:0},{label:"成功",value:1}],se=[{label:"处理中",value:0},{label:"成功",value:1},{label:"已退",value:2}],et={alipay:"success",wechat:"success",credit:"success",taobao:"primary",pinduoduo:"primary",jingdong:"primary",douyin:"primary",gift:"info",other:"warning"},tt={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger"},lt={0:"primary",1:"success",2:"danger"};function at(e){const o=Se(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"ID/用户名/备注"},onChange:()=>{o()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},options:se,onChange:()=>{o()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"金额",prop:"amount",renderField:(i,r)=>{var a,c;const u=(l,n)=>{l!==void 0&&n!==void 0&&l>n||r([l,n])};return f("div",{class:"flex items-center gap-2 w-full"},[f(P("el-input"),{class:"flex-1",modelValue:(a=i==null?void 0:i[0])==null?void 0:a.toString(),"onUpdate:modelValue":l=>{const n=l===""?void 0:Number(l);u(n,i==null?void 0:i[1])},placeholder:"最小金额",clearable:!0},null),f("span",{class:"flex-none"},[R("至")]),f(P("el-input"),{class:"flex-1",modelValue:(c=i==null?void 0:i[1])==null?void 0:c.toString(),"onUpdate:modelValue":l=>{const n=l===""?void 0:Number(l);u(i==null?void 0:i[0],n)},placeholder:"最大金额",clearable:!0},null)])}},{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型"},options:E},{label:"支付方式",prop:"pay_method",valueType:"select",fieldProps:{placeholder:"请选择支付方式"},options:Q},{label:"支付编号",prop:"pay_sn",valueType:"input",fieldProps:{placeholder:"请输入支付编号"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:qe()}}]}}function nt(e,o){const s=b(!1),i=b(),r=b(0),u=b({}),a=b(!1),c=b(!1),l=b(0),n=b(),C=()=>{c.value=r.value>0&&(u.value.status!==0||["alipay","wechat"].includes(u.value.pay_method))||a.value},M=[{label:"用户名",prop:"user_id",valueType:"select",renderField:(v,_)=>f(Ie,{key:`user-select-${l.value}`,ref:n,modelValue:v,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:_,disabled:r.value>0||a.value},null)},{label:"金额",prop:"amount",valueType:"input-number",fieldProps:{placeholder:"请输入金额",min:0,precision:2,controlsPosition:"right",get disabled(){return r.value>0||a.value}}},{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型",get disabled(){return r.value>0||u.value.type!==void 0||a.value}},options:E},{label:"支付方式",prop:"pay_method",valueType:"select",fieldProps:{placeholder:"请选择支付方式",get disabled(){return r.value>0||u.value.type==="deduct"||a.value}},options:Q},{label:"支付编号",prop:"pay_sn",valueType:"input",fieldProps:{placeholder:"请输入支付编号",get disabled(){return c.value||u.value.type==="deduct"}}},{label:"备注",prop:"remark",valueType:"textarea",fieldProps:{placeholder:"请输入备注",rows:3}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态",get disabled(){return c.value}},options:Ze}],O={user_id:[{required:!0,message:"请选择用户",trigger:"blur"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],pay_method:[{required:!0,message:"请选择支付方式",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},V=v=>{h().then(()=>{u.value.type=v,v==="deduct"&&(u.value.pay_method="other",u.value.pay_sn=""),C()})},q=v=>H(null,null,function*(){var S,w;const _=yield ke({username:v,currentPage:1,pageSize:1});return((w=(S=_==null?void 0:_.data)==null?void 0:S.items)==null?void 0:w.length)>0?_.data.items[0]:null});function h(v=0){return H(this,null,function*(){var _,S,w;if(s.value=!0,l.value=Date.now(),v>0)r.value!==v&&p(v);else if((S=(_=i.value)==null?void 0:_.formInstance)==null||S.resetFields(),u.value=Object.fromEntries(Object.entries(oe).filter(([k,D])=>D!==0&&D!=="")),u.value.status=0,(w=o==null?void 0:o.value)!=null&&w.username){const k=yield q(o.value.username);k&&setTimeout(()=>{if(n.value){const D={label:k.username,value:k.id};n.value.options||(n.value.options=[]),n.value.options.some($=>$.value===k.id)||n.value.options.push(D),setTimeout(()=>{u.value.user_id=k.id},100)}else u.value.user_id=k.id},250)}r.value=v,a.value=!1,C()})}function N(){r.value>0?W():z()}function Y(){s.value=!1}const p=v=>{Ke(v).then(_=>{var S;u.value=Oe(_.data,Ae),u.value.amount=Number((S=u.value.amount)!=null?S:0)})},z=()=>{Ee(u.value).then(()=>{e(),s.value=!1})},W=()=>{We(r.value,u.value).then(()=>{e(),s.value=!1,r.value=0})};return{showStore:s,storeRef:i,storeId:r,storeValues:u,storeColumns:M,rules:O,openStoreByType:V,openStoreForm:h,confirmStoreForm:N,closeStoreForm:Y,userSelectRef:n}}function ot(){const e=b(),o=b([]),s=a=>{o.value=a.map(c=>c.id),e.value.setAdaptive()},i=()=>{var a;(a=e.value)==null||a.getTableRef().clearSelection()},r=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:130},{label:"用户名",prop:"user.username",width:100,cellRenderer:xe("user.username")},{label:"金额",prop:"amount",width:100},{label:"类型",prop:"type",minWidth:150,cellRenderer:({row:a,props:c})=>f(P("el-tag"),{size:c.size,type:tt[a.type],effect:"plain"},{default:()=>{var l;return[(l=E.find(n=>n.value===a.type))==null?void 0:l.label]}})},{label:"支付方式",prop:"pay_method",minWidth:150,cellRenderer:({row:a,props:c})=>f(P("el-tag"),{size:c.size,type:et[a.pay_method],effect:"plain"},{default:()=>{var l;return[(l=Q.find(n=>n.value===a.pay_method))==null?void 0:l.label]}})},{label:"支付编号",prop:"pay_sn",minWidth:150},{label:"备注",prop:"remark",minWidth:150},{label:"状态",prop:"status",width:100,cellRenderer:({row:a,props:c})=>f(P("el-tag"),{size:c.size,type:lt[a.status],effect:"plain"},{default:()=>{var l;return[(l=se.find(n=>n.value===a.status))==null?void 0:l.label]}})},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:a})=>a?J(a).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}];return{tableRef:e,selectedIds:o,handleSelectionChange:s,handleSelectionCancel:i,tableColumns:r,handleRowClick:(a,c,l)=>{var C;const n=l.target;n.tagName==="BUTTON"||n.closest("button")||n.closest(".el-button")||(C=e.value)==null||C.getTableRef().toggleRowSelection(a)}}}const st={class:"main"},rt={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},ut={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},it={class:"flex-auto"},dt={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},pt=Re({name:"Funds",__name:"index",setup(e){const{drawerSize:o}=Ue(),s=Pe(),{tableRef:i,selectedIds:r,handleSelectionChange:u,handleSelectionCancel:a,tableColumns:c,handleRowClick:l}=ot(),{loading:n,search:C,dataList:M,pagination:O,handleSizeChange:V,handleCurrentChange:q,onSearch:h,onReset:N,onCollapse:Y,handleDestroy:p,handleBatchDestroy:z,handleRefunds:W,handleReverse:v,handleCheck:_}=Xe(i),{searchColumns:S}=at(()=>h()),{storeRef:w,showStore:k,storeColumns:D,rules:X,storeValues:$,openStoreByType:Z,openStoreForm:re,confirmStoreForm:ue,closeStoreForm:ie}=nt(()=>h(),C);return Te(()=>{s.query.username&&(C.value.username=s.query.username),s.query.id&&(C.value.id=Number(s.query.id)),h()}),(ct,d)=>{var ee;const x=P("el-button"),de=P("el-tooltip"),A=P("el-popconfirm"),pe=P("pure-table"),ce=ze("motion-fade");return F(),ae("div",st,[G("div",rt,[f(t(Ve),{modelValue:t(C),"onUpdate:modelValue":d[0]||(d[0]=y=>ne(C)?C.value=y:null),columns:t(S),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(h),onReset:t(N),onCollapse:t(Y)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),f(t($e),{title:"资金管理",columns:t(c),onRefresh:t(h)},{buttons:g(()=>[f(x,{type:"success",onClick:d[1]||(d[1]=y=>t(Z)("addfunds"))},{default:g(()=>[...d[5]||(d[5]=[R(" 充值 ",-1)])]),_:1}),f(x,{type:"primary",onClick:d[2]||(d[2]=y=>t(Z)("deduct"))},{default:g(()=>[...d[6]||(d[6]=[R(" 扣款 ",-1)])]),_:1})]),default:g(({size:y,dynamicColumns:fe})=>[t(r).length>0?we((F(),ae("div",ut,[G("div",it,[f(de,{placement:"top",content:"取消选择"},{default:g(()=>[f(x,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Fe)(t(Ne)),onClick:t(a)},null,8,["icon","onClick"])]),_:1}),G("span",dt," 已选 "+De(t(r).length)+" 项 ",1)]),f(A,{title:"确定要删除吗？",width:"160px",onConfirm:d[3]||(d[3]=m=>t(z)(t(r)))},{reference:g(()=>[f(x,{type:"danger",size:"small"},{default:g(()=>[...d[7]||(d[7]=[R(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[ce]]):B("",!0),f(pe,{ref_key:"tableRef",ref:i,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(n),size:y,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(M),columns:fe,pagination:L(K({},t(O)),{size:y}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(l),onSelectionChange:t(u),onPageSizeChange:t(V),onPageCurrentChange:t(q)},{operation:g(({row:m})=>[m.status===0&&m.pay_method!=="alipay"&&m.pay_method!=="wechat"?(F(),U(x,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:j=>t(re)(m.id)},{default:g(()=>[...d[8]||(d[8]=[R(" 编辑 ",-1)])]),_:1},8,["size","onClick"])):B("",!0),m.status===0&&m.type==="addfunds"&&(m.pay_method==="alipay"||m.pay_method==="wechat")?(F(),U(x,{key:1,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:j=>t(_)(m.id)},{default:g(()=>[...d[9]||(d[9]=[R(" 检查 ",-1)])]),_:1},8,["size","onClick"])):B("",!0),m.status===1&&m.type==="addfunds"?(F(),U(A,{key:2,title:"确定要退款吗？",width:"160px",onConfirm:j=>t(W)(m.id)},{reference:g(()=>[f(x,{class:"reset-margin !outline-none",type:"danger",link:"",size:y},{default:g(()=>[...d[10]||(d[10]=[R(" 退款 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])):B("",!0),m.status===1&&m.type==="deduct"?(F(),U(A,{key:3,title:"确定要退回吗？",width:"160px",onConfirm:j=>t(v)(m.id)},{reference:g(()=>[f(x,{class:"reset-margin !outline-none",type:"danger",link:"",size:y},{default:g(()=>[...d[11]||(d[11]=[R(" 退回 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])):B("",!0),m.status===0&&t(J)(m.created_at).isBefore(t(J)().subtract(2,"hour"))?(F(),U(A,{key:4,title:"确定要删除吗？",width:"160px",onConfirm:j=>t(p)(m.id)},{reference:g(()=>[f(x,{class:"reset-margin !outline-none",link:"",type:"danger",size:y},{default:g(()=>[...d[12]||(d[12]=[R(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])):B("",!0)]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),f(t(Ye),{ref_key:"storeRef",ref:w,modelValue:t($),"onUpdate:modelValue":d[4]||(d[4]=y=>ne($)?$.value=y:null),visible:t(k),form:{columns:t(D),rules:t(X),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:(ee=t(E).find(y=>y.value===t($).type))==null?void 0:ee.label,confirmText:"提交",cancelText:"取消",onConfirm:t(ue),onCancel:t(ie)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),kt=Be(pt,[["__scopeId","data-v-e834786d"]]);export{kt as default};
