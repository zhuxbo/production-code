var oe=Object.defineProperty,re=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var Y=(a,l,o)=>l in a?oe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,B=(a,l)=>{for(var o in l||(l={}))se.call(l,o)&&Y(a,o,l[o]);if(M)for(var o of M(l))ie.call(l,o)&&Y(a,o,l[o]);return a},D=(a,l)=>re(a,ne(l));import{r as h,l as ue,bm as ce,m as w,bn as pe,bo as de,t as me,L as fe,n as he,p as ge,f as c,bp as be,q as ve,bq as ye,br as Ce,bs as _e,bt as Se,I as Pe,s as I,h as k,d as Fe,o as we,M as xe,c as U,e as W,v as V,i as e,j as $,w as f,B as ke,x as Re,y as Te,z as ze,A as x,_ as Be}from"./index-Czs_s45H.js";import{P as De,a as Ve}from"./plus-search-B_b347ed.js";import{c as qe,p as Ee}from"./utils-BFFS1riR.js";import{g as Ae}from"./datePicker-WHgduTab.js";import{_ as T}from"./index.vue_vue_type_script_setup_true_lang-pol5f9Kl.js";import{u as Me}from"./hooks-BC8gGHVq.js";import{u as Ye}from"./drawer-Buoy5E4X.js";import{C as Ie}from"./close-bold-CJxBGuFX.js";import{P as Ue}from"./index-DJVwwjTC.js";import"./index-CMrlkQOr.js";import"./epTheme-NuZyHsuP.js";function We(a){const l=h({}),o=h([]),i=h(!0),t=ue({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function _(r){t.pageSize=r,s()}function n(r){t.currentPage=r,s()}const p=h(!1),b=h(0),v=r=>{p.value=!0,r?b.value=r:b.value=0},d=r=>{de(r).then(()=>{w("删除成功",{type:"success"}),s()})},P=r=>{pe(r).then(()=>{w("删除成功",{type:"success"}),s()})},F=r=>{ce(r).then(({data:y})=>{y.direct_login_url?(window.open(y.direct_login_url,"_blank"),w("正在跳转到会员中心...",{type:"success"})):w("获取登录链接失败",{type:"error"})}).catch(()=>{w("直接登录失败",{type:"error"})})};function s(){i.value=!0;const r=D(B({},me(l.value)),{pageSize:t.pageSize,currentPage:t.currentPage});r.created_at&&(r.created_at=qe(r.created_at)),fe(r).then(({data:y})=>{o.value=y.items,t.total=y.total,t.pageSize=y.pageSize,t.currentPage=y.currentPage,he(()=>{a.value&&a.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:l,dataList:o,pagination:t,handleSizeChange:_,handleCurrentChange:n,onSearch:s,onReset:()=>{s()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:p,updateId:b,handleStore:v,handleDestroy:d,handleBatchDestroy:P,handleDirectLogin:F}}const $e=a=>{const l=ge(()=>{a()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/邮箱/手机号"},onChange:()=>{l()}},{label:"状态",prop:"status",valueType:"select",options:[{label:"正常",value:"1"},{label:"禁用",value:"0"}],fieldProps:{placeholder:"请选择状态"},onChange:()=>{l()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"级别",prop:"level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(i,t)=>c(T,{modelValue:i,uri:"/user-level",queryParams:{custom:0},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择级别",onChange:t},null)},{label:"定制级别",prop:"custom_level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(i,t)=>c(T,{modelValue:i,uri:"/user-level",queryParams:{custom:1},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择定制级别",onChange:t},null)},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Ae()}}]}},Le=a=>{const l=h(!1),o=h(),i=h(0),t=h({username:"",level_code:"",status:1}),_=[{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"密码",prop:"password",valueType:"input",fieldProps:{placeholder:"不修改密码请留空",type:"password"},get rules(){return ve(()=>[{required:i.value===0,message:"请输入密码",trigger:"blur"},{min:6,max:32,message:"密码长度在 6 到 32 个字符",trigger:"blur"}]).value}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"级别",prop:"level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(s,m)=>c(T,{modelValue:s,uri:"/user-level",queryParams:{custom:0},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择级别",onChange:m},null)},{label:"定制级别",prop:"custom_level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(s,m)=>c(T,{modelValue:s,uri:"/user-level",queryParams:{custom:1},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择定制级别",onChange:m},null)},{label:"信用额度",prop:"credit_limit",valueType:"input-number",fieldProps:{placeholder:"请输入信用额度",precision:2}},{label:"状态",prop:"status",valueType:"switch",fieldProps:{activeValue:1,inactiveValue:0}}],n={username:[{required:!0,message:"请输入用户名"},{min:2,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],level_code:[{required:!0,message:"请选择级别"}],status:[{required:!0,message:"请选择状态"}]};function p(s=0){var m;l.value=!0,s>0?i.value!==s&&d(s):((m=o.value.formInstance)==null||m.resetFields(),t.value=Object.fromEntries(Object.entries(be).filter(([C,r])=>r!==0&&r!==""))),i.value=s}function b(){i.value>0?F():P()}function v(){l.value=!1}const d=s=>{_e(s).then(({data:m})=>{t.value=Ee(m,Se)})},P=()=>{Ce(t.value).then(()=>{a(),l.value=!1})},F=()=>{ye(i.value,t.value).then(()=>{a(),l.value=!1})};return{storeRef:o,showStore:l,storeId:i,storeValues:t,storeColumns:_,rules:n,openStoreForm:p,confirmStoreForm:b,closeStoreForm:v}},Oe=()=>{const a=h(),l=h([]),o=n=>{l.value=n.map(p=>p.id),a.value.setAdaptive()},i=()=>{var n;(n=a.value)==null||n.getTableRef().clearSelection()},t=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:90},{label:"用户名",prop:"username",minWidth:100,cellRenderer:Pe("username")},{label:"邮箱",prop:"email",minWidth:140},{label:"手机号",prop:"mobile",minWidth:100},{label:"级别",prop:"level.name",minWidth:100},{label:"定制级别",prop:"custom_level.name",minWidth:100},{label:"余额",prop:"balance",minWidth:100},{label:"信用额度",prop:"credit_limit",minWidth:100},{label:"最后登录",prop:"last_login_at",minWidth:150,formatter:({last_login_at:n})=>n?I(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"创建时间",prop:"created_at",minWidth:150,formatter:({created_at:n})=>n?I(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:n,props:p})=>c(k("el-tag"),{size:p.size,type:n.status===1?"success":"danger",effect:"plain"},{default:()=>[n.status===1?"正常":"禁用"]})},{label:"操作",fixed:"right",slot:"operation",width:160}];return{tableRef:a,selectedIds:l,handleSelectionChange:o,handleSelectionCancel:i,tableColumns:t,handleRowClick:(n,p,b)=>{var d;const v=b.target;v.tagName==="BUTTON"||v.closest("button")||v.closest(".el-button")||(d=a.value)==null||d.getTableRef().toggleRowSelection(n)}}},Ne={class:"main"},je={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},He={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ke={class:"flex-auto"},Ge={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Je=Fe({name:"User",__name:"index",setup(a){const{drawerSize:l}=Ye(),o=xe(),{tableRef:i,selectedIds:t,handleSelectionChange:_,handleSelectionCancel:n,tableColumns:p,handleRowClick:b}=Oe(),{loading:v,search:d,dataList:P,pagination:F,handleSizeChange:s,handleCurrentChange:m,onSearch:C,onReset:r,onCollapse:y,handleDestroy:L,handleBatchDestroy:O,handleDirectLogin:N}=We(i),{searchColumns:j}=$e(()=>C()),{storeRef:H,showStore:K,storeId:G,storeColumns:J,rules:Q,storeValues:z,openStoreForm:q,confirmStoreForm:X,closeStoreForm:Z}=Le(()=>C());return we(()=>{o.query.username&&(d.value.username=o.query.username),C()}),(Qe,u)=>{const S=k("el-button"),ee=k("el-tooltip"),E=k("el-popconfirm"),le=k("pure-table"),te=ke("motion-fade");return W(),U("div",Ne,[V("div",je,[c(e(De),{modelValue:e(d),"onUpdate:modelValue":u[0]||(u[0]=g=>$(d)?d.value=g:null),columns:e(j),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:e(C),onReset:e(r),onCollapse:e(y)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),c(e(Ve),{title:"用户管理",columns:e(p),onRefresh:e(C)},{buttons:f(()=>[c(S,{type:"primary",onClick:u[1]||(u[1]=g=>e(q)())},{default:f(()=>u[4]||(u[4]=[x("新增用户")])),_:1})]),default:f(({size:g,dynamicColumns:ae})=>[e(t).length>0?Re((W(),U("div",He,[V("div",Ke,[c(ee,{placement:"top",content:"取消选择"},{default:f(()=>[c(S,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:e(Me)(e(Ie)),onClick:e(n)},null,8,["icon","onClick"])]),_:1}),V("span",Ge," 已选 "+ze(e(t).length)+" 项 ",1)]),c(E,{title:"确定要删除吗？",width:"160px",onConfirm:u[2]||(u[2]=R=>e(O)(e(t)))},{reference:f(()=>[c(S,{type:"danger",size:"small"},{default:f(()=>u[5]||(u[5]=[x(" 批量删除 ")])),_:1})]),_:1})])),[[te]]):Te("",!0),c(le,{ref_key:"tableRef",ref:i,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(v),size:g,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(P),columns:ae,pagination:D(B({},e(F)),{size:g}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:e(b),onSelectionChange:e(_),onPageSizeChange:e(s),onPageCurrentChange:e(m)},{operation:f(({row:R})=>[c(S,{class:"reset-margin !outline-none",type:"success",link:"",size:g,onClick:A=>e(N)(R.id)},{default:f(()=>u[6]||(u[6]=[x(" 登录 ")])),_:2},1032,["size","onClick"]),c(S,{class:"reset-margin !outline-none",type:"primary",link:"",size:g,onClick:A=>e(q)(R.id)},{default:f(()=>u[7]||(u[7]=[x(" 编辑 ")])),_:2},1032,["size","onClick"]),c(E,{title:"确定要删除吗？",width:"160px",onConfirm:A=>e(L)(R.id)},{reference:f(()=>[c(S,{class:"reset-margin !outline-none",link:"",type:"danger",size:g},{default:f(()=>u[8]||(u[8]=[x(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(e(Ue),{ref_key:"storeRef",ref:H,modelValue:e(z),"onUpdate:modelValue":u[3]||(u[3]=g=>$(z)?z.value=g:null),visible:e(K),form:{columns:e(J),rules:e(Q),labelPosition:"right",labelSuffix:""},size:e(l),closeOnClickModal:!0,title:e(G)>0?"编辑用户":"新增用户",confirmText:"提交",cancelText:"取消",onConfirm:e(X),onCancel:e(Z)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),cl=Be(Je,[["__scopeId","data-v-62ccec72"]]);export{cl as default};
