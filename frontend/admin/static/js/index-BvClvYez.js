var O=Object.defineProperty,V=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var D=(t,e,o)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,x=(t,e)=>{for(var o in e||(e={}))B.call(e,o)&&D(t,o,e[o]);if(R)for(var o of R(e))W.call(e,o)&&D(t,o,e[o]);return t},S=(t,e)=>V(t,U(e));import{P as M,a as H}from"./plus-search-DONTT3F1.js";import{u as F}from"./hooks-C30YmLIe.js";import{l as N,S as A}from"./vue-json-pretty-DhR6BGY_.js";import{d as k,r as b,h as u,c as y,e as P,f as s,w as d,i as l,F as j,G,E as $,s as E,aL as K,l as q,o as J,t as Q,m as w,aK as X,x as Z,A as L,B as ee,v as ae,j as te,_ as le}from"./index-D9lkRtkU.js";import{h as oe,a as ne,I as re,V as se}from"./view-llF0hLMi.js";import{c as pe}from"./utils-BTJ8R6fS.js";import{g as ie}from"./datePicker-WHgduTab.js";import"./index-B6vBV-uA.js";import"./epTheme-Db9MQrTx.js";const ce=k({__name:"detail",props:{data:{type:Object,default:()=>({})}},setup(t){const e=t,o=[{label:"请求地址",prop:"url"},{label:"请求方法",prop:"method"},{label:"请求IP",prop:"ip"},{label:"状态码",prop:"status_code"},{label:"请求时间",prop:"created_at",cellRenderer:()=>e.data.created_at?E(e.data.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"异常类型",prop:"exception"},{label:"错误信息",prop:"message"}],i=b([{title:"错误堆栈",name:"trace",data:e.data.trace}]);return(_,v)=>{const n=u("el-scrollbar"),m=u("el-tab-pane"),f=u("el-tabs");return P(),y("div",null,[s(n,null,{default:d(()=>[s(l(N),{border:"",data:[t.data],columns:o,column:5},null,8,["data"])]),_:1}),s(f,{modelValue:i.value[0].name,type:"border-card",class:"mt-4"},{default:d(()=>[(P(!0),y(j,null,G(i.value,(c,h)=>(P(),$(m,{key:h,name:c.name,label:c.title},{default:d(()=>[s(n,{"max-height":"calc(100vh - 240px)"},{default:d(()=>[s(l(A),{data:c.data,"onUpdate:data":p=>c.data=p},null,8,["data","onUpdate:data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])])}}});function de(){const t=b({}),e=b(),o=b([]),i=b(!0),{copied:_,update:v}=K(),n=q({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function m(a){n.pageSize=a,p()}function f(a){n.currentPage=a,p()}function c({url:a},{property:r}){r==="url"&&(v(a),_.value?w(`${a} 已拷贝`,{type:"success"}):w("拷贝失败",{type:"warning"}))}function h(a){ne("error",a.id).then(r=>{X({title:"错误日志详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>ce,props:{data:r.data}})})}function p(){i.value=!0;const a=S(x({},Q(t.value)),{pageSize:n.pageSize,currentPage:n.currentPage});a.created_at&&(a.created_at=pe(a.created_at)),oe(a).then(({data:r})=>{o.value=r.items,n.total=r.total,n.pageSize=r.pageSize,n.currentPage=r.currentPage}).finally(()=>{i.value=!1})}const C=()=>{p()},T=()=>{setTimeout(()=>{var a,r;window.dispatchEvent(new Event("resize")),(r=(a=e.value)==null?void 0:a.setAdaptive)==null||r.call(a)},500)};return J(()=>{p()}),{tableRef:e,form:t,loading:i,dataList:o,pagination:n,onSearch:p,onDetail:h,onResetSearch:C,onCollapse:T,handleSizeChange:m,handleCurrentChange:f,handleCellDblclick:c}}const ue=[{label:"异常类型",prop:"exception",valueType:"input",fieldProps:{placeholder:"请输入异常类型"}},{label:"错误信息",prop:"message",valueType:"input",fieldProps:{placeholder:"请输入错误信息"}},{label:"状态码",prop:"status_code",valueType:"input",fieldProps:{placeholder:"请输入状态码"}},{label:"请求URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入请求URL"}},{label:"请求方法",prop:"method",valueType:"select",fieldProps:{placeholder:"请选择请求方法"},options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"OPTIONS",value:"OPTIONS"}]},{label:"IP地址",prop:"ip",valueType:"input",fieldProps:{placeholder:"请输入IP地址"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ie()}}],me=[{label:"ID",prop:"id",minWidth:90},{headerRenderer:()=>s("div",{class:"flex flex-row items-center"},[s("span",null,[L("请求URL")]),Z(s(u("iconifyIconOffline"),{icon:re,class:"ml-1 cursor-help"},null),[[ee("tippy"),{content:"双击下面请求URL进行拷贝"}]])]),prop:"url",minWidth:140},{label:"请求方法",prop:"method",minWidth:100},{label:"异常类型",prop:"exception",minWidth:180},{label:"错误信息",prop:"message",minWidth:200,showOverflowTooltip:!0},{label:"IP 地址",prop:"ip",minWidth:120},{label:"状态码",prop:"status_code",minWidth:100,cellRenderer:({row:t,props:e})=>s(u("el-tag"),{size:e.size,type:t.status_code<400?"success":"danger",effect:"plain"},{default:()=>[t.status_code]})},{label:"请求时间",prop:"created_at",minWidth:180,formatter:({created_at:t})=>t?E(t).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:80}],fe={class:"main"},he={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[24px] overflow-auto"},ge=k({name:"ErrorLogs",__name:"index",setup(t){const{tableRef:e,form:o,loading:i,dataList:_,pagination:v,onSearch:n,onDetail:m,onResetSearch:f,onCollapse:c,handleSizeChange:h,handleCurrentChange:p,handleCellDblclick:C}=de();return(T,a)=>{const r=u("el-button"),z=u("pure-table");return P(),y("div",fe,[ae("div",he,[s(l(M),{modelValue:l(o),"onUpdate:modelValue":a[0]||(a[0]=g=>te(o)?o.value=g:null),columns:l(ue),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:l(n),onReset:l(f),onCollapse:l(c)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),s(l(H),{title:"错误日志",columns:l(me),onRefresh:l(n)},{default:d(({size:g,dynamicColumns:I})=>[s(z,{ref_key:"tableRef",ref:e,"row-key":"id","align-whole":"left","table-layout":"auto",loading:l(i),size:g,adaptive:"",adaptiveConfig:{offsetBottom:108},data:l(_),columns:I,pagination:S(x({},l(v)),{size:g}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:l(h),onPageCurrentChange:l(p),onCellDblclick:l(C)},{operation:d(({row:Y})=>[s(r,{class:"reset-margin !outline-none",link:"",type:"primary",size:g,icon:l(F)(l(se)),onClick:be=>l(m)(Y)},{default:d(()=>a[1]||(a[1]=[L(" 详情 ")])),_:2},1032,["size","icon","onClick"])]),_:2},1032,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange","onCellDblclick"])]),_:1},8,["columns","onRefresh"])])}}}),we=le(ge,[["__scopeId","data-v-8cb54bad"]]);export{we as default};
