var j=Object.defineProperty,O=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var x=(t,e,o)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,v=(t,e)=>{for(var o in e||(e={}))B.call(e,o)&&x(t,o,e[o]);if(P)for(var o of P(e))E.call(e,o)&&x(t,o,e[o]);return t},S=(t,e)=>O(t,W(e));import{P as Q,a as A}from"./plus-search-R_NvJ0WL.js";import{k as w,r as d,l as N,t as U,p as L,f as p,I as $,s as H,h as C,J,d as G,o as K,c as X,e as Z,v as ee,i as a,j as F,w as _,A as te,_ as ae}from"./index-DVVb6EPd.js";import{c as oe}from"./utils-FWkRq0Ub.js";import{g as re}from"./datePicker-WHgduTab.js";import{_ as le}from"./index.vue_vue_type_script_setup_true_lang-MWzJ_Gxw.js";import{u as ne}from"./drawer-BQoCnmoE.js";import{P as se}from"./index-DNYJPxdH.js";import"./index-C7rp1oYV.js";import"./epTheme-ByBpvkPZ.js";function ue(t){return w.get("/free-cert-quota",{params:t})}const ie={user_id:0,quota:0,type:"",order_id:0};function ce(t){return w.post("/free-cert-quota",{data:t})}function pe(){const t=d({}),e=d([]),o=d(!0),r=N({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function n(l){r.pageSize=l,u()}function m(l){r.currentPage=l,u()}function u(){o.value=!0;const l=S(v({},U(t.value)),{pageSize:r.pageSize,currentPage:r.currentPage});l.created_at&&(l.created_at=oe(l.created_at)),ue(l).then(({data:s})=>{e.value=s.items,r.total=s.total,r.pageSize=s.pageSize,r.currentPage=s.currentPage}).finally(()=>{o.value=!1})}return{loading:o,search:t,dataList:e,pagination:r,handleSizeChange:n,handleCurrentChange:m,onSearch:u,onReset:()=>{u()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const de=t=>{const e=L(()=>{t()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/类型/订单ID"},onChange:()=>{e()}},{label:"类型",prop:"type",valueType:"select",options:[{label:"增加",value:"increase"},{label:"减少",value:"decrease"},{label:"申请",value:"apply"},{label:"取消",value:"cancel"}],fieldProps:{placeholder:"请选择类型"}},{label:"用户名",prop:"user.username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"订单ID",prop:"order_id",valueType:"input",fieldProps:{placeholder:"请输入订单ID"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:re()}}]}},me=t=>{const e=d(!1),o=d(),r=d({}),n=[{label:"用户",prop:"user_id",valueType:"select",renderField:(l,s)=>p(le,{modelValue:l,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:s},null)},{label:"类型",prop:"type",valueType:"select",options:[{label:"增加",value:"increase"},{label:"减少",value:"decrease"}],fieldProps:{placeholder:"请选择类型"}},{label:"配额",prop:"quota",valueType:"input-number",fieldProps:{placeholder:"请输入配额",controlsPosition:"right"}}],m={user_id:[{required:!0,message:"请选择用户"}],quota:[{required:!0,message:"请输入配额"},{type:"number",message:"配额必须是数字"}],type:[{required:!0,message:"请选择类型"}]};function u(){var l,s;e.value=!0,(s=(l=o.value)==null?void 0:l.formInstance)==null||s.resetFields(),r.value=Object.fromEntries(Object.entries(ie).filter(([y,h])=>h!==0&&h!==""))}function f(){e.value=!1}return{storeRef:o,showStore:e,storeValues:r,storeColumns:n,rules:m,openStoreForm:u,handleStore:()=>{ce(r.value).then(()=>{t(),e.value=!1})},closeStoreForm:f}};function fe(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!J(t)}const he=()=>({tableColumns:[{label:"ID",prop:"id",minWidth:80},{label:"用户",prop:"user.username",minWidth:120,cellRenderer:$("user.username")},{label:"配额",prop:"quota",minWidth:100},{label:"变更前",prop:"quota_before",minWidth:100},{label:"变更后",prop:"quota_after",minWidth:100},{label:"类型",prop:"type",minWidth:100,cellRenderer:({row:e,props:o})=>{let r="info",n=e.type;switch(e.type){case"increase":r="success",n="增加";break;case"decrease":r="warning",n="减少";break;case"apply":r="primary",n="申请";break;case"cancel":r="danger",n="取消";break}return p(C("el-tag"),{size:o.size,type:r,effect:"plain"},fe(n)?n:{default:()=>[n]})}},{label:"订单ID",prop:"order_id",minWidth:100},{label:"创建时间",prop:"created_at",width:180,formatter:({created_at:e})=>e?H(e).format("YYYY-MM-DD HH:mm:ss"):"-"}]}),be={class:"main"},ge={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},ve=G({name:"FreecertQuota",__name:"index",setup(t){const{drawerSize:e}=ne(),{tableColumns:o}=he(),{loading:r,search:n,dataList:m,pagination:u,handleSizeChange:f,handleCurrentChange:b,onSearch:l,onReset:s,onCollapse:y}=pe(),{searchColumns:h}=de(()=>l()),{storeRef:z,showStore:R,storeColumns:k,rules:T,storeValues:g,openStoreForm:q,handleStore:D,closeStoreForm:V}=me(()=>l());return K(()=>{l()}),(Se,i)=>{const I=C("el-button"),M=C("pure-table");return Z(),X("div",be,[ee("div",ge,[p(a(Q),{modelValue:a(n),"onUpdate:modelValue":i[0]||(i[0]=c=>F(n)?n.value=c:null),columns:a(h),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:a(l),onReset:a(s),onCollapse:a(y)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),p(a(A),{title:"免费证书配额记录",columns:a(o),onRefresh:a(l)},{buttons:_(()=>[p(I,{type:"primary",onClick:i[1]||(i[1]=c=>a(q)())},{default:_(()=>i[3]||(i[3]=[te("配额管理")])),_:1})]),default:_(({size:c,dynamicColumns:Y})=>[p(M,{ref:"tableRef","row-key":"id","align-whole":"left","table-layout":"auto",loading:a(r),size:c,adaptive:"",adaptiveConfig:{offsetBottom:108},data:a(m),columns:Y,pagination:S(v({},a(u)),{size:c}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:a(f),onPageCurrentChange:a(b)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),p(a(se),{ref_key:"storeRef",ref:z,modelValue:a(g),"onUpdate:modelValue":i[2]||(i[2]=c=>F(g)?g.value=c:null),visible:a(R),form:{columns:a(k),rules:a(T),labelPosition:"right",labelSuffix:""},size:a(e),closeOnClickModal:!0,title:"配额管理",confirmText:"提交",cancelText:"取消",onConfirm:a(D),onCancel:a(V)},null,8,["modelValue","visible","form","size","onConfirm","onCancel"])])}}}),Te=ae(ve,[["__scopeId","data-v-edf1169d"]]);export{Te as default};
