var pe=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var $=(l,a,o)=>a in l?pe(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,E=(l,a)=>{for(var o in a||(a={}))he.call(a,o)&&$(l,o,a[o]);if(N)for(var o of N(a))fe.call(a,o)&&$(l,o,a[o]);return l},O=(l,a)=>ue(l,me(a));var U=(l,a,o)=>new Promise((i,c)=>{var b=n=>{try{e(o.next(n))}catch(r){c(r)}},_=n=>{try{e(o.throw(n))}catch(r){c(r)}},e=n=>n.done?i(n.value):Promise.resolve(n.value).then(b,_);e((o=o.apply(l,a)).next())});import{P as ge,a as be}from"./plus-search-9LL5vjUH.js";import{k as P,r as g,l as ve,m as x,t as _e,n as Ce,p as ye,f as s,I as we,s as B,h,C as De,d as Re,o as Se,c as z,e as S,v as Y,i as t,j as F,w as u,x as xe,y as j,z as ke,A,F as ze,G as Pe,E as Te,B as Ye,_ as Ae}from"./index-B8e-qeTz.js";import{c as Be}from"./utils-Dnh5kgzw.js";import{g as Ie}from"./datePicker-WHgduTab.js";import{u as We}from"./hooks-Dxk504sx.js";import{C as Me}from"./close-bold-C6b3L9K4.js";import{l as Ve,S as He}from"./vue-json-pretty-BKCOI2ax.js";import{u as Le}from"./drawer-BxEc30gF.js";import"./index-C0oCruPR.js";import"./epTheme-CJfp4t94.js";function Ne(l){return P.get("/agiso",{params:l})}function $e(l){return P.get(`/agiso/${l}`)}function Ee(l){return P.delete(`/agiso/${l}`)}function Oe(l){return P.delete("/agiso",{data:{ids:l}})}function Ue(l){const a=g({}),o=g([]),i=g(!0),c=ve({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function b(d){c.pageSize=d,r()}function _(d){c.currentPage=d,r()}const e=d=>{Ee(d).then(()=>{x("删除成功",{type:"success"}),r()})},n=d=>{Oe(d).then(()=>{x("删除成功",{type:"success"}),r()})};function r(){i.value=!0;const d=O(E({},_e(a.value)),{pageSize:c.pageSize,currentPage:c.currentPage});d.created_at&&(d.created_at=Be(d.created_at)),Ne(d).then(({data:C})=>{o.value=C.items,c.total=C.total,c.pageSize=C.pageSize,c.currentPage=C.currentPage,Ce(()=>{l.value&&l.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:a,dataList:o,pagination:c,handleSizeChange:b,handleCurrentChange:_,onSearch:r,onReset:()=>{r()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},handleDestroy:e,handleBatchDestroy:n}}const I=[{label:"淘宝",value:"TbAlds"},{label:"拼多多",value:"PddAlds"},{label:"京东",value:"AldsJd"},{label:"抖音",value:"AldsDoudian"}],Fe={TbAlds:"primary",PddAlds:"warning",AldsJd:"info",AldsDoudian:"info"},W=[{label:"未充值",value:0},{label:"已充值",value:1}],je={0:"info",1:"success"},qe=l=>{const a=ye(()=>{l()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"平台/交易单号/用户名"},onChange:()=>{a()}},{label:"充值状态",prop:"recharged",valueType:"select",options:W,fieldProps:{placeholder:"请选择充值状态"},onChange:()=>{a()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"平台",prop:"platform",valueType:"select",options:I,fieldProps:{placeholder:"请选择平台"}},{label:"类型",prop:"type",valueType:"input",fieldProps:{placeholder:"请输入类型"}},{label:"订单ID",prop:"order_id",valueType:"input",fieldProps:{placeholder:"请输入订单ID"}},{label:"交易单号",prop:"tid",valueType:"input",fieldProps:{placeholder:"请输入交易单号"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Ie()}}],debouncedSearch:a}},Je=()=>{const l=g(),a=g([]),o=De(),i=e=>{a.value=e.map(n=>n.id),l.value.setAdaptive()},c=()=>{var e;(e=l.value)==null||e.getTableRef().clearSelection()},b=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:80},{label:"平台",prop:"platform",minWidth:80,cellRenderer:({row:e,props:n})=>s(h("el-tag"),{size:n.size,type:Fe[e.platform],effect:"plain"},{default:()=>{var r;return[(r=I.find(m=>m.value===e.platform))==null?void 0:r.label]}})},{label:"充值状态",prop:"recharged",minWidth:100,cellRenderer:({row:e,props:n})=>s(h("el-tag"),{size:n.size,type:je[e.recharged],effect:"plain"},{default:()=>{var r;return[(r=W.find(m=>m.value===e.recharged))==null?void 0:r.label]}})},{label:"用户名",prop:"user.username",minWidth:120,cellRenderer:we("user.username")},{label:"订单ID",prop:"order_id",minWidth:100,cellRenderer:({row:e})=>s("span",{class:"cursor-pointer",onClick:()=>{o.push({path:"/order",query:{id:e.order_id}})}},[e.order_id])},{label:"交易单号",prop:"tid",minWidth:150},{label:"类型",prop:"type",minWidth:80},{label:"单价",prop:"price",minWidth:80},{label:"数量",prop:"count",minWidth:50},{label:"金额",prop:"amount",minWidth:80},{label:"时间戳",prop:"timestamp",minWidth:180,formatter:({timestamp:e})=>e?B(e*1e3).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:e})=>e?B(e).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}];return{tableRef:l,selectedIds:a,handleSelectionChange:i,handleSelectionCancel:c,tableColumns:b,handleRowClick:(e,n,r)=>{var D;const m=r.target;m.tagName==="BUTTON"||m.closest("button")||m.closest(".el-button")||(D=l.value)==null||D.getTableRef().toggleRowSelection(e)}}},Ge=()=>{const l=g(!1),a=g({}),o=g(!1),i=g([{title:"原始数据",name:"data",data:null}]);return{showDrawer:l,detailData:a,loading:o,columns:[{label:"ID",prop:"id"},{label:"用户名",prop:"user.username",cellRenderer:()=>{var e;return((e=a.value.user)==null?void 0:e.username)||"无关联用户"}},{label:"用户邮箱",prop:"user.email",cellRenderer:()=>{var e;return((e=a.value.user)==null?void 0:e.email)||"-"}},{label:"平台",prop:"platform",cellRenderer:()=>{var n;const e=a.value.platform;return((n=I.find(r=>r.value===e))==null?void 0:n.label)||e}},{label:"交易单号",prop:"tid"},{label:"类型",prop:"type"},{label:"充值状态",prop:"recharged",cellRenderer:()=>{var n;const e=a.value.recharged;return((n=W.find(r=>r.value===e))==null?void 0:n.label)||e}},{label:"单价",prop:"price"},{label:"数量",prop:"count"},{label:"金额",prop:"amount"},{label:"订单ID",prop:"order_id",cellRenderer:()=>a.value.order_id||"无关联订单"},{label:"时间戳",prop:"timestamp"},{label:"创建时间",prop:"created_at",cellRenderer:()=>a.value.created_at?B(a.value.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"}],dataList:i,openDrawer:e=>{a.value=e,l.value=!0,i.value=[{title:"原始数据",name:"data",data:a.value.data}]},closeDrawer:()=>{l.value=!1,a.value={},i.value=[{title:"原始数据",name:"data",data:null}]}}},Ke={class:"main"},Qe={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Xe={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ze={class:"flex-auto"},ea={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},aa={key:0},la=Re({name:"Agiso",__name:"index",setup(l){const{drawerSize:a}=Le(),{tableRef:o,selectedIds:i,handleSelectionChange:c,handleSelectionCancel:b,tableColumns:_,handleRowClick:e}=Je(),{loading:n,search:r,dataList:m,pagination:D,handleSizeChange:d,handleCurrentChange:C,onSearch:k,onReset:q,onCollapse:J,handleDestroy:G,handleBatchDestroy:K}=Ue(o),{searchColumns:Q}=qe(()=>k()),{showDrawer:T,detailData:M,columns:X,dataList:V,openDrawer:Z,closeDrawer:ee}=Ge(),ae=y=>U(null,null,function*(){try{const{data:p}=yield $e(y.id);Z(p)}catch(p){x("获取详情失败",{type:"error"})}}),le=y=>{if(y.recharged===1){x("已充值的记录不能删除",{type:"warning"});return}G(y.id)},te=()=>{if(i.value.length===0)return;if(m.value.filter(v=>i.value.includes(v.id)).filter(v=>v.recharged===1).length>0){x("选中的记录中包含已充值的记录，不能删除",{type:"warning"});return}K(i.value)};return Se(()=>{k()}),(y,p)=>{const v=h("el-button"),oe=h("el-tooltip"),H=h("el-popconfirm"),re=h("pure-table"),L=h("el-scrollbar"),ne=h("el-tab-pane"),se=h("el-tabs"),ie=h("el-drawer"),ce=Ye("motion-fade");return S(),z("div",Ke,[Y("div",Qe,[s(t(ge),{modelValue:t(r),"onUpdate:modelValue":p[0]||(p[0]=f=>F(r)?r.value=f:null),columns:t(Q),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(k),onReset:t(q),onCollapse:t(J)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),s(t(be),{title:"电商平台",columns:t(_),onRefresh:t(k)},{default:u(({size:f,dynamicColumns:R})=>[t(i).length>0?xe((S(),z("div",Xe,[Y("div",Ze,[s(oe,{placement:"top",content:"取消选择"},{default:u(()=>[s(v,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(We)(t(Me)),onClick:t(b)},null,8,["icon","onClick"])]),_:1}),Y("span",ea," 已选 "+ke(t(i).length)+" 项 ",1)]),s(H,{title:"确定要删除吗？",width:"160px",onConfirm:te},{reference:u(()=>[s(v,{type:"danger",size:"small"},{default:u(()=>p[2]||(p[2]=[A(" 批量删除 ")])),_:1})]),_:1})])),[[ce]]):j("",!0),s(re,{ref_key:"tableRef",ref:o,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(n),size:f,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(m),columns:R,pagination:t(D),paginationSmall:f==="small","header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onSelectionChange:t(c),onPageSizeChange:t(d),onPageCurrentChange:t(C),onRowClick:t(e)},{operation:u(({row:w})=>[s(v,{class:"reset-margin",link:"",type:"primary",size:"small",onClick:de=>ae(w)},{default:u(()=>p[3]||(p[3]=[A(" 详情 ")])),_:2},1032,["onClick"]),s(H,{title:`确认删除记录 ${w.tid} 吗？`,onConfirm:de=>le(w)},{reference:u(()=>[s(v,{class:"reset-margin",link:"",type:"danger",size:"small",disabled:w.recharged===1},{default:u(()=>p[4]||(p[4]=[A(" 删除 ")])),_:2},1032,["disabled"])]),_:2},1032,["title","onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","paginationSmall","onSelectionChange","onPageSizeChange","onPageCurrentChange","onRowClick"])]),_:1},8,["columns","onRefresh"]),s(ie,{modelValue:t(T),"onUpdate:modelValue":p[1]||(p[1]=f=>F(T)?T.value=f:null),title:"交易详情",direction:"rtl",size:t(a),"before-close":t(ee)},{default:u(()=>{var f;return[t(M)?(S(),z("div",aa,[s(L,null,{default:u(()=>[s(t(Ve),{border:"",data:[t(M)],columns:t(X),column:2},null,8,["data","columns"])]),_:1}),s(se,{"model-value":(f=t(V)[0])==null?void 0:f.name,type:"border-card",class:"mt-4"},{default:u(()=>[(S(!0),z(ze,null,Pe(t(V),(R,w)=>(S(),Te(ne,{key:w,name:R.name,label:R.title},{default:u(()=>[s(L,{"max-height":"calc(100vh - 300px)"},{default:u(()=>[s(t(He),{data:R.data},null,8,["data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["model-value"])])):j("",!0)]}),_:1},8,["modelValue","size","before-close"])])}}}),ha=Ae(la,[["__scopeId","data-v-9f83744a"]]);export{ha as default};
