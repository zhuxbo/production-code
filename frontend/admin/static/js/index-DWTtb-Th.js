var I=Object.defineProperty,F=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(a,e,l)=>e in a?I(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l,y=(a,e)=>{for(var l in e||(e={}))V.call(e,l)&&R(a,l,e[l]);if(x)for(var l of x(e))W.call(e,l)&&R(a,l,e[l]);return a},C=(a,e)=>F(a,Y(e));import{P as B,a as O}from"./plus-search-DsmSfcAq.js";import{u as U}from"./hooks-Jd8TOYNL.js";import{l as A,S as M}from"./vue-json-pretty-DDjkEqda.js";import{d as z,r as g,h as i,c as S,e as P,f as n,w as m,i as o,F as H,G as N,E as j,s as D,l as G,o as $,t as q,aK as K,x as J,A as T,B as Q,v as X,j as Z,_ as ee}from"./index-C2TQaEJO.js";import{g as ae,a as le,I as te,V as oe}from"./view-BVwQjYzj.js";import{c as ne}from"./utils-CdOSnC3M.js";import{g as re}from"./datePicker-WHgduTab.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-DlgbzPom.js";import"./index-BnpBDtos.js";import"./epTheme-Cp495Ovn.js";const pe=z({__name:"detail",props:{data:{type:Object,default:()=>({})}},setup(a){const e=a,l=[{label:"管理员",prop:"admin.username",cellRenderer:()=>{var r;return((r=e.data.admin)==null?void 0:r.username)||"-"}},{label:"请求地址",prop:"url"},{label:"请求方法",prop:"method"},{label:"所属模块",prop:"module"},{label:"操作",prop:"action"},{label:"请求耗时",prop:"duration"},{label:"请求IP",prop:"ip"},{label:"状态码",prop:"status_code"},{label:"状态",prop:"status",cellRenderer:()=>e.data.status===1?"成功":"失败"},{label:"请求时间",prop:"created_at",cellRenderer:()=>e.data.created_at?D(e.data.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"}],d=g([{title:"响应",name:"response",data:e.data.response},{title:"参数",name:"params",data:e.data.params}]);return(r,_)=>{const c=i("el-scrollbar"),f=i("el-tab-pane"),p=i("el-tabs");return P(),S("div",null,[n(c,null,{default:m(()=>[n(o(A),{border:"",data:[a.data],columns:l,column:5},null,8,["data"])]),_:1}),n(p,{modelValue:d.value[0].name,type:"border-card",class:"mt-4"},{default:m(()=>[(P(!0),S(H,null,N(d.value,(u,h)=>(P(),j(f,{key:h,name:u.name,label:u.title},{default:m(()=>[n(c,{"max-height":"calc(100vh - 240px)"},{default:m(()=>[n(o(M),{data:u.data,"onUpdate:data":t=>u.data=t},null,8,["data","onUpdate:data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])])}}});function ie(){const a=g({}),e=g(),l=g([]),d=g(!0),r=G({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function _(t){r.pageSize=t,p()}function c(t){r.currentPage=t,p()}function f(t){le("admin",t.id).then(s=>{K({title:"管理员日志详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>pe,props:{data:s.data}})})}function p(){d.value=!0;const t=C(y({},q(a.value)),{pageSize:r.pageSize,currentPage:r.currentPage});t.created_at&&(t.created_at=ne(t.created_at)),ae(t).then(({data:s})=>{l.value=s.items,r.total=s.total,r.pageSize=s.pageSize,r.currentPage=s.currentPage}).finally(()=>{d.value=!1})}const u=()=>{p()},h=()=>{setTimeout(()=>{var t,s;window.dispatchEvent(new Event("resize")),(s=(t=e.value)==null?void 0:t.setAdaptive)==null||s.call(t)},500)};return $(()=>{p()}),{tableRef:e,form:a,loading:d,dataList:l,pagination:r,onSearch:p,onDetail:f,onResetSearch:u,onCollapse:h,handleSizeChange:_,handleCurrentChange:c}}const de=[{label:"管理员",prop:"admin_id",valueType:"select",renderField:(a,e)=>n(se,{modelValue:a,uri:"/admin",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择管理员",onChange:e},null)},{label:"状态",prop:"status",valueType:"select",options:[{label:"成功",value:"1"},{label:"失败",value:"0"}],fieldProps:{placeholder:"请选择状态"}},{label:"状态码",prop:"status_code",valueType:"input",fieldProps:{placeholder:"请输入状态码"}},{label:"参数",prop:"params",valueType:"input",fieldProps:{placeholder:"请输入参数"}},{label:"响应",prop:"response",valueType:"input",fieldProps:{placeholder:"请输入响应"}},{label:"请求URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入请求URL"}},{label:"请求方法",prop:"method",valueType:"select",fieldProps:{placeholder:"请选择请求方法"},options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"OPTIONS",value:"OPTIONS"}]},{label:"所属模块",prop:"module",valueType:"input",fieldProps:{placeholder:"请输入所属模块"}},{label:"动作",prop:"action",valueType:"input",fieldProps:{placeholder:"请输入动作"}},{label:"IP地址",prop:"ip",valueType:"input",fieldProps:{placeholder:"请输入IP地址"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:re()}}],ue=[{label:"ID",prop:"id",minWidth:90},{label:"管理员",prop:"admin.username",minWidth:100},{headerRenderer:()=>n("div",{class:"flex flex-row items-center"},[n("span",null,[T("请求URL")]),J(n(i("iconifyIconOffline"),{icon:te,class:"ml-1 cursor-help"},null),[[Q("tippy"),{content:"双击下面请求URL进行拷贝"}]])]),prop:"url",minWidth:140},{label:"请求方法",prop:"method",minWidth:140},{label:"模块",prop:"module",minWidth:100},{label:"动作",prop:"action",minWidth:100},{label:"IP 地址",prop:"ip",minWidth:100},{label:"状态码",prop:"status_code",minWidth:100,cellRenderer:({row:a,props:e})=>n(i("el-tag"),{size:e.size,type:a.status_code<400?"success":"danger",effect:"plain"},{default:()=>[a.status_code]})},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:a,props:e})=>n(i("el-tag"),{size:e.size,type:a.status===1?"success":"danger",effect:"plain"},{default:()=>[a.status===1?"成功":"失败"]})},{label:"请求耗时",prop:"duration",minWidth:100,cellRenderer:({row:a,props:e})=>n(i("el-tag"),{size:e.size,type:a.duration<1e3?"success":"warning",effect:"plain"},{default:()=>[a.duration,T(" ms")]})},{label:"请求时间",prop:"created_at",minWidth:180,formatter:({created_at:a})=>a?D(a).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:80}],ce={class:"main"},me={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[24px] overflow-auto"},fe=z({name:"AdminLogs",__name:"index",setup(a){const{tableRef:e,form:l,loading:d,dataList:r,pagination:_,onSearch:c,onDetail:f,onResetSearch:p,onCollapse:u,handleSizeChange:h,handleCurrentChange:t}=ie();return(s,v)=>{const w=i("el-button"),k=i("pure-table");return P(),S("div",ce,[X("div",me,[n(o(B),{modelValue:o(l),"onUpdate:modelValue":v[0]||(v[0]=b=>Z(l)?l.value=b:null),columns:o(de),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:o(c),onReset:o(p),onCollapse:o(u)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),n(o(O),{title:"管理员日志",columns:o(ue),onRefresh:o(c)},{default:m(({size:b,dynamicColumns:L})=>[n(k,{ref_key:"tableRef",ref:e,"row-key":"id","align-whole":"left","table-layout":"auto",loading:o(d),size:b,adaptive:"",adaptiveConfig:{offsetBottom:108},data:o(r),columns:L,pagination:C(y({},o(_)),{size:b}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:o(h),onPageCurrentChange:o(t)},{operation:m(({row:E})=>[n(w,{class:"reset-margin !outline-none",link:"",type:"primary",size:b,icon:o(U)(o(oe)),onClick:he=>o(f)(E)},{default:m(()=>v[1]||(v[1]=[T(" 详情 ")])),_:2},1032,["size","icon","onClick"])]),_:2},1032,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),ze=ee(fe,[["__scopeId","data-v-b6412c10"]]);export{ze as default};
