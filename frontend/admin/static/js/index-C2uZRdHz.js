var ae=Object.defineProperty,le=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var M=(e,o,a)=>o in e?ae(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,T=(e,o)=>{for(var a in o||(o={}))se.call(o,a)&&M(e,a,o[a]);if(I)for(var a of I(o))re.call(o,a)&&M(e,a,o[a]);return e},D=(e,o)=>le(e,ne(o));var V=(e,o,a)=>new Promise((r,l)=>{var S=i=>{try{c(a.next(i))}catch(p){l(p)}},n=i=>{try{c(a.throw(i))}catch(p){l(p)}},c=i=>i.done?r(i.value):Promise.resolve(i.value).then(S,n);c((a=a.apply(e,o)).next())});import{P as ie,a as ue}from"./plus-search-DONTT3F1.js";import{k as _,r as f,l as ce,m as Y,t as pe,n as de,p as me,q as fe,f as d,s as he,h as P,d as ge,o as be,c as $,e as O,v as A,i as t,j as E,w as b,x as ve,y as Ce,z as Se,A as R,B as ye,_ as _e}from"./index-D9lkRtkU.js";import{c as we,p as xe}from"./utils-BTJ8R6fS.js";import{g as Pe}from"./datePicker-WHgduTab.js";import{u as Re}from"./hooks-C30YmLIe.js";import{u as ke}from"./drawer-DA-UdFhf.js";import{C as ze}from"./close-bold-DR0Tnm_R.js";import{P as Te}from"./index-ChpzrfiJ.js";import"./index-B6vBV-uA.js";import"./epTheme-Db9MQrTx.js";function De(e){return _.get("/admin",{params:e})}const N={username:"",password:"",email:"",mobile:0,status:1},Ve=Object.keys(N);function Ae(e){return _.post("/admin",{data:e})}function Fe(e,o){return _.put(`/admin/${e}`,{data:o})}function Be(e){return _.get(`/admin/${e}`)}function Ie(e){return _.delete(`/admin/${e}`)}function Me(e){return _.delete("/admin/batch",{data:{ids:e}})}function Ye(e){const o=f({}),a=f([]),r=f(!0),l=ce({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function S(s){l.pageSize=s,h()}function n(s){l.currentPage=s,h()}const c=f(!1),i=f(0),p=s=>{c.value=!0,s?i.value=s:i.value=0},y=s=>{Ie(s).then(()=>{Y("删除成功",{type:"success"}),h()})},w=s=>{Me(s).then(()=>{Y("删除成功",{type:"success"}),h()})};function h(){r.value=!0;const s=D(T({},pe(o.value)),{pageSize:l.pageSize,currentPage:l.currentPage});s.created_at&&(s.created_at=we(s.created_at)),De(s).then(({data:v})=>{a.value=v.items,l.total=v.total,l.pageSize=v.pageSize,l.currentPage=v.currentPage,de(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{r.value=!1})}return{loading:r,search:o,dataList:a,pagination:l,handleSizeChange:S,handleCurrentChange:n,onSearch:h,onReset:()=>{h()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:c,updateId:i,handleStore:p,handleDestroy:y,handleBatchDestroy:w}}const $e=e=>{const o=me(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/邮箱/手机号"},onChange:()=>{o()}},{label:"状态",prop:"status",valueType:"select",options:[{label:"正常",value:"1"},{label:"禁用",value:"0"}],fieldProps:{placeholder:"请选择状态"},onChange:()=>{o()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Pe()}}]}},Oe=e=>{const o=f(!1),a=f(),r=f(0),l=f({username:"",status:1}),S=[{label:"用户名",prop:"username",valueType:"copy",fieldProps:{placeholder:"请输入用户名"}},{label:"密码",prop:"password",valueType:"input",fieldProps:{placeholder:"不修改密码请留空",type:"password"},get rules(){return fe(()=>[{required:r.value==0,message:"请输入密码"},{min:6,max:32,message:"密码长度在 6 到 32 个字符",trigger:"blur"}]).value}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"状态",prop:"status",valueType:"switch",fieldProps:{activeValue:1,inactiveValue:0}}],n={username:[{required:!0,message:"请输入用户名"},{min:2,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}]};function c(g=0){var m;o.value=!0,g>0?r.value!==g&&y(g):((m=a.value.formInstance)==null||m.resetFields(),l.value=Object.fromEntries(Object.entries(N).filter(([s,v])=>v!==0&&v!==""))),r.value=g}function i(){r.value>0?h():w()}function p(){o.value=!1}const y=g=>{Be(g).then(m=>{l.value=xe(m.data,Ve)})},w=()=>V(null,null,function*(){Ae(l.value).then(()=>{e(),o.value=!1})}),h=()=>V(null,null,function*(){Fe(r.value,l.value).then(()=>{e(),o.value=!1})});return{storeRef:a,showStore:o,storeId:r,storeValues:l,storeColumns:S,rules:n,openStoreForm:c,confirmStoreForm:i,closeStoreForm:p}},Ee=()=>{const e=f(),o=f([]);return{tableRef:e,selectedIds:o,handleSelectionChange:n=>{o.value=n.map(c=>c.id),e.value.setAdaptive()},handleSelectionCancel:()=>{var n;(n=e.value)==null||n.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:60},{label:"用户名",prop:"username",minWidth:100},{label:"邮箱",prop:"email",minWidth:140},{label:"手机号",prop:"mobile",width:120},{label:"状态",prop:"status",width:70,cellRenderer:({row:n,props:c})=>d(P("el-tag"),{size:c.size,type:n.status===1?"success":"danger",effect:"plain"},{default:()=>[n.status===1?"正常":"禁用"]})},{label:"创建时间",prop:"created_at",width:160,formatter:({created_at:n})=>n?he(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleRowClick:(n,c,i)=>{var y;const p=i.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(y=e.value)==null||y.getTableRef().toggleRowSelection(n)}}},Ne={class:"main"},je={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ue={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},qe={class:"flex-auto"},Le={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},He=ge({name:"Admin",__name:"index",setup(e){const{drawerSize:o}=ke(),{tableRef:a,selectedIds:r,handleSelectionChange:l,handleSelectionCancel:S,tableColumns:n,handleRowClick:c}=Ee(),{loading:i,search:p,dataList:y,pagination:w,handleSizeChange:h,handleCurrentChange:g,onSearch:m,onReset:s,onCollapse:v,handleDestroy:j,handleBatchDestroy:U}=Ye(a),{searchColumns:q}=$e(()=>m()),{storeRef:L,showStore:H,storeId:K,storeColumns:W,rules:G,storeValues:k,openStoreForm:F,confirmStoreForm:J,closeStoreForm:Q}=Oe(()=>m());return be(()=>{m()}),(Ke,u)=>{const x=P("el-button"),X=P("el-tooltip"),B=P("el-popconfirm"),Z=P("pure-table"),ee=ye("motion-fade");return O(),$("div",Ne,[A("div",je,[d(t(ie),{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=C=>E(p)?p.value=C:null),columns:t(q),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(m),onReset:t(s),onCollapse:t(v)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),d(t(ue),{title:"管理员管理",columns:t(n),onRefresh:t(m)},{buttons:b(()=>[d(x,{type:"primary",onClick:u[1]||(u[1]=C=>t(F)())},{default:b(()=>u[4]||(u[4]=[R("新增管理员")])),_:1})]),default:b(({size:C,dynamicColumns:te})=>[t(r).length>0?ve((O(),$("div",Ue,[A("div",qe,[d(X,{placement:"top",content:"取消选择"},{default:b(()=>[d(x,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Re)(t(ze)),onClick:t(S)},null,8,["icon","onClick"])]),_:1}),A("span",Le," 已选 "+Se(t(r).length)+" 项 ",1)]),d(B,{title:"确定要删除吗？",width:"160px",onConfirm:u[2]||(u[2]=z=>t(U)(t(r)))},{reference:b(()=>[d(x,{type:"danger",size:"small"},{default:b(()=>u[5]||(u[5]=[R(" 批量删除 ")])),_:1})]),_:1})])),[[ee]]):Ce("",!0),d(Z,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(i),size:C,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(y),columns:te,pagination:D(T({},t(w)),{size:C}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(c),onSelectionChange:t(l),onPageSizeChange:t(h),onPageCurrentChange:t(g)},{operation:b(({row:z})=>[d(x,{class:"reset-margin !outline-none",type:"primary",link:"",size:C,onClick:oe=>t(F)(z.id)},{default:b(()=>u[6]||(u[6]=[R(" 编辑 ")])),_:2},1032,["size","onClick"]),d(B,{title:"确定要删除吗？",width:"160px",onConfirm:oe=>t(j)(z.id)},{reference:b(()=>[d(x,{class:"reset-margin !outline-none",link:"",type:"danger",size:C},{default:b(()=>u[7]||(u[7]=[R(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),d(t(Te),{ref_key:"storeRef",ref:L,modelValue:t(k),"onUpdate:modelValue":u[3]||(u[3]=C=>E(k)?k.value=C:null),visible:t(H),form:{columns:t(W),rules:t(G),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:t(K)>0?"编辑管理员":"新增管理员",confirmText:"提交",cancelText:"取消",onConfirm:t(J),onCancel:t(Q)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),nt=_e(He,[["__scopeId","data-v-6f1a7d4b"]]);export{nt as default};
