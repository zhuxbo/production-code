var F=Object.defineProperty,Y=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var k=(a,e,o)=>e in a?F(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,y=(a,e)=>{for(var o in e||(e={}))W.call(e,o)&&k(a,o,e[o]);if(D)for(var o of D(e))B.call(e,o)&&k(a,o,e[o]);return a},R=(a,e)=>Y(a,V(e));import{P as O,a as M}from"./plus-search-CwfvJRm8.js";import{u as H}from"./hooks-D_eDHlR7.js";import{l as N,S as A}from"./vue-json-pretty-D4nk8ozV.js";import{d as w,r as _,h as i,c as S,e as P,f as r,w as m,i as t,F as $,G as j,E as G,s as I,aL as q,l as K,o as J,t as Q,m as z,aK as X,I as Z,x as ee,A as T,B as ae,v as le,j as te,_ as oe}from"./index-4cMHn29j.js";import{b as re,a as ne,I as se,V as pe}from"./view-Cug9e6Wi.js";import{c as ie}from"./utils-BlIcfP1w.js";import{g as ue}from"./datePicker-WHgduTab.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-DCkkYG2a.js";import"./index-BrEuR0t-.js";import"./epTheme-BWtB1AEv.js";const de=w({__name:"detail",props:{data:{type:Object,default:()=>({})}},setup(a){const e=a,o=[{label:"用户",prop:"user.username",cellRenderer:()=>{var d;return((d=e.data.user)==null?void 0:d.username)||"-"}},{label:"请求地址",prop:"url"},{label:"请求方法",prop:"method"},{label:"所属模块",prop:"module"},{label:"操作",prop:"action"},{label:"请求耗时",prop:"duration"},{label:"请求IP",prop:"ip"},{label:"状态码",prop:"status_code"},{label:"状态",prop:"status",cellRenderer:()=>e.data.status===1?"成功":"失败"},{label:"请求时间",prop:"created_at",cellRenderer:()=>e.data.created_at?I(e.data.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"}],u=_([{title:"响应",name:"response",data:e.data.response},{title:"参数",name:"params",data:e.data.params}]);return(d,v)=>{const n=i("el-scrollbar"),f=i("el-tab-pane"),h=i("el-tabs");return P(),S("div",null,[r(n,null,{default:m(()=>[r(t(N),{border:"",data:[a.data],columns:o,column:5},null,8,["data"])]),_:1}),r(h,{modelValue:u.value[0].name,type:"border-card",class:"mt-4"},{default:m(()=>[(P(!0),S($,null,j(u.value,(c,b)=>(P(),G(f,{key:b,name:c.name,label:c.title},{default:m(()=>[r(n,{"max-height":"calc(100vh - 240px)"},{default:m(()=>[r(t(A),{data:c.data,"onUpdate:data":p=>c.data=p},null,8,["data","onUpdate:data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])])}}});function me(){const a=_({}),e=_(),o=_([]),u=_(!0),{copied:d,update:v}=q(),n=K({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function f(l){n.pageSize=l,p()}function h(l){n.currentPage=l,p()}function c({url:l},{property:s}){s==="url"&&(v(l),d.value?z(`${l} 已拷贝`,{type:"success"}):z("拷贝失败",{type:"warning"}))}function b(l){ne("user",l.id).then(s=>{X({title:"用户日志详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>de,props:{data:s.data}})})}function p(){u.value=!0;const l=R(y({},Q(a.value)),{pageSize:n.pageSize,currentPage:n.currentPage});l.created_at&&(l.created_at=ie(l.created_at)),re(l).then(({data:s})=>{o.value=s.items,n.total=s.total,n.pageSize=s.pageSize,n.currentPage=s.currentPage}).finally(()=>{u.value=!1})}const C=()=>{p()},x=()=>{setTimeout(()=>{var l,s;window.dispatchEvent(new Event("resize")),(s=(l=e.value)==null?void 0:l.setAdaptive)==null||s.call(l)},500)};return J(()=>{p()}),{tableRef:e,form:a,loading:u,dataList:o,pagination:n,onSearch:p,onDetail:b,onResetSearch:C,onCollapse:x,handleSizeChange:f,handleCurrentChange:h,handleCellDblclick:c}}const fe=[{label:"用户",prop:"user_id",valueType:"select",renderField:(a,e)=>r(ce,{modelValue:a,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:e},null)},{label:"状态",prop:"status",valueType:"select",options:[{label:"成功",value:"1"},{label:"失败",value:"0"}],fieldProps:{placeholder:"请选择状态"}},{label:"状态码",prop:"status_code",valueType:"input",fieldProps:{placeholder:"请输入状态码"}},{label:"参数",prop:"params",valueType:"input",fieldProps:{placeholder:"请输入参数"}},{label:"响应",prop:"response",valueType:"input",fieldProps:{placeholder:"请输入响应"}},{label:"请求URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入请求URL"}},{label:"请求方法",prop:"method",valueType:"select",fieldProps:{placeholder:"请选择请求方法"},options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"OPTIONS",value:"OPTIONS"}]},{label:"所属模块",prop:"module",valueType:"input",fieldProps:{placeholder:"请输入所属模块"}},{label:"动作",prop:"action",valueType:"input",fieldProps:{placeholder:"请输入动作"}},{label:"IP地址",prop:"ip",valueType:"input",fieldProps:{placeholder:"请输入IP地址"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ue()}}],he=[{label:"ID",prop:"id",minWidth:90},{label:"用户",prop:"user.username",minWidth:100,cellRenderer:Z("user.username")},{headerRenderer:()=>r("div",{class:"flex flex-row items-center"},[r("span",null,[T("请求URL")]),ee(r(i("iconifyIconOffline"),{icon:se,class:"ml-1 cursor-help"},null),[[ae("tippy"),{content:"双击下面请求URL进行拷贝"}]])]),prop:"url",minWidth:140},{label:"请求方法",prop:"method",minWidth:140},{label:"模块",prop:"module",minWidth:100},{label:"动作",prop:"action",minWidth:100},{label:"IP 地址",prop:"ip",minWidth:100},{label:"状态码",prop:"status_code",minWidth:100,cellRenderer:({row:a,props:e})=>r(i("el-tag"),{size:e.size,type:a.status_code<400?"success":"danger",effect:"plain"},{default:()=>[a.status_code]})},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:a,props:e})=>r(i("el-tag"),{size:e.size,type:a.status===1?"success":"danger",effect:"plain"},{default:()=>[a.status===1?"成功":"失败"]})},{label:"请求耗时",prop:"duration",minWidth:100,cellRenderer:({row:a,props:e})=>r(i("el-tag"),{size:e.size,type:a.duration<1e3?"success":"warning",effect:"plain"},{default:()=>[a.duration,T(" ms")]})},{label:"请求时间",prop:"created_at",minWidth:180,formatter:({created_at:a})=>a?I(a).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:80}],be={class:"main"},ge={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[24px] overflow-auto"},_e=w({name:"UserLogs",__name:"index",setup(a){const{tableRef:e,form:o,loading:u,dataList:d,pagination:v,onSearch:n,onDetail:f,onResetSearch:h,onCollapse:c,handleSizeChange:b,handleCurrentChange:p,handleCellDblclick:C}=me();return(x,l)=>{const s=i("el-button"),L=i("pure-table");return P(),S("div",be,[le("div",ge,[r(t(O),{modelValue:t(o),"onUpdate:modelValue":l[0]||(l[0]=g=>te(o)?o.value=g:null),columns:t(fe),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(n),onReset:t(h),onCollapse:t(c)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),r(t(M),{title:"用户日志",columns:t(he),onRefresh:t(n)},{default:m(({size:g,dynamicColumns:E})=>[r(L,{ref_key:"tableRef",ref:e,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(u),size:g,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(d),columns:E,pagination:R(y({},t(v)),{size:g}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:t(b),onPageCurrentChange:t(p),onCellDblclick:t(C)},{operation:m(({row:U})=>[r(s,{class:"reset-margin !outline-none",link:"",type:"primary",size:g,icon:t(H)(t(pe)),onClick:ve=>t(f)(U)},{default:m(()=>l[1]||(l[1]=[T(" 详情 ")])),_:2},1032,["size","icon","onClick"])]),_:2},1032,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange","onCellDblclick"])]),_:1},8,["columns","onRefresh"])])}}}),Ie=oe(_e,[["__scopeId","data-v-8870ec20"]]);export{Ie as default};
