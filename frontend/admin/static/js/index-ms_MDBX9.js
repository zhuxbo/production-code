var T=Object.defineProperty,v=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var y=(t,a,n)=>a in t?T(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,b=(t,a)=>{for(var n in a||(a={}))z.call(a,n)&&y(t,n,a[n]);if(S)for(var n of S(a))D.call(a,n)&&y(t,n,a[n]);return t},C=(t,a)=>v(t,k(a));import{P as Y,a as M}from"./plus-search-9LL5vjUH.js";import{k as V,r as m,l as B,t as N,n as U,p as F,f as u,h as g,A as E,I,s as j,C as q,d as A,o as H,c as L,e as O,v as W,i as o,j as $,w as G,_ as J}from"./index-B8e-qeTz.js";import{c as K}from"./utils-Dnh5kgzw.js";import{g as Q}from"./datePicker-WHgduTab.js";import"./index-C0oCruPR.js";import"./epTheme-CJfp4t94.js";function X(t){return V.get("/transaction",{params:t})}function Z(t){const a=m({}),n=m([]),e=m(!0),r=B({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function s(i){r.pageSize=i,p()}function d(i){r.currentPage=i,p()}function p(){e.value=!0;const i=C(b({},N(a.value)),{pageSize:r.pageSize,currentPage:r.currentPage});i.created_at&&(i.created_at=K(i.created_at)),X(i).then(({data:f})=>{n.value=f.items,r.total=f.total,r.pageSize=f.pageSize,r.currentPage=f.currentPage,U(()=>{t.value&&t.value.getTableRef().clearSelection()})}).finally(()=>{e.value=!1})}return{loading:e,search:a,dataList:n,pagination:r,handleSizeChange:s,handleCurrentChange:d,onSearch:p,onReset:()=>{p()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const x=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"},{label:"订单",value:"order"},{label:"取消",value:"cancel"}],ee={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger",order:"primary",cancel:"danger"};function ae(t){const a=F(()=>{t()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/交易单号/备注"},onChange:()=>{a()}},{label:"交易类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择交易类型"},options:x,onChange:()=>{a()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"交易单号",prop:"transaction_id",valueType:"input",fieldProps:{placeholder:"请输入交易单号"}},{label:"金额",prop:"amount",renderField:(e,r)=>{var d,p;const s=(c,l)=>{c!==void 0&&l!==void 0&&c>l||r([c,l])};return u("div",{class:"flex items-center gap-2 w-full"},[u(g("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[0])==null?void 0:d.toString(),"onUpdate:modelValue":c=>{const l=c===""?void 0:Number(c);s(l,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),u("span",{class:"flex-none"},[E("至")]),u(g("el-input"),{class:"flex-1",modelValue:(p=e==null?void 0:e[1])==null?void 0:p.toString(),"onUpdate:modelValue":c=>{const l=c===""?void 0:Number(c);s(e==null?void 0:e[0],l)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Q()}}]}}function te(){const t=m(),a=q(),n=[{label:"用户名",prop:"user.username",width:100,cellRenderer:I("user.username")},{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:r})=>u(g("el-tag"),{size:r.size,type:ee[e.type],effect:"plain"},{default:()=>{var s;return[(s=x.find(d=>d.value===e.type))==null?void 0:s.label]}})},{label:"单号",prop:"transaction_id",width:145,cellRenderer:({row:e})=>u("span",{class:"cursor-pointer",onClick:()=>{const s=["order","cancel"].includes(e.type)?"/order":"/funds";s&&a.push({path:s,query:{id:e.transaction_id}})}},[e.transaction_id])},{label:"交易金额",prop:"amount",width:100},{label:"交易前余额",prop:"balance_before",width:100},{label:"交易后余额",prop:"balance_after",width:100},{label:"备注",prop:"remark",minWidth:150},{label:"创建时间",prop:"created_at",width:160,formatter:({created_at:e})=>e?j(e).format("YYYY-MM-DD HH:mm:ss"):"-"}];return{tableRef:t,tableColumns:n}}const ne={class:"main"},re={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=A({name:"Transaction",__name:"index",setup(t){const{tableRef:a,tableColumns:n}=te(),{loading:e,search:r,dataList:s,pagination:d,handleSizeChange:p,handleCurrentChange:c,onSearch:l,onReset:i,onCollapse:f}=Z(a),{searchColumns:P}=ae(()=>l());return H(()=>{l()}),(le,_)=>{const w=g("pure-table");return O(),L("div",ne,[W("div",re,[u(o(Y),{modelValue:o(r),"onUpdate:modelValue":_[0]||(_[0]=h=>$(r)?r.value=h:null),columns:o(P),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:o(l),onReset:o(i),onCollapse:o(f)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),u(o(M),{title:"交易记录",columns:o(n),onRefresh:o(l)},{default:G(({size:h,dynamicColumns:R})=>[u(w,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:o(e),size:h,adaptive:"",adaptiveConfig:{offsetBottom:108},data:o(s),columns:R,pagination:C(b({},o(d)),{size:h}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:o(p),onPageCurrentChange:o(c)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),he=J(oe,[["__scopeId","data-v-f871e308"]]);export{he as default};
