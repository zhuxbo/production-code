var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var se=(i,h,b)=>h in i?me(i,h,{enumerable:!0,configurable:!0,writable:!0,value:b}):i[h]=b,L=(i,h)=>{for(var b in h||(h={}))ve.call(h,b)&&se(i,b,h[b]);if(le)for(var b of le(h))be.call(h,b)&&se(i,b,h[b]);return i},G=(i,h)=>fe(i,ge(h));var J=(i,h,b)=>new Promise((d,_)=>{var p=t=>{try{g(b.next(t))}catch(S){_(S)}},m=t=>{try{g(b.throw(t))}catch(S){_(S)}},g=t=>t.done?d(t.value):Promise.resolve(t.value).then(p,m);g((b=b.apply(i,h)).next())});import{r as F,l as X,t as ye,n as he,p as _e,j as r,f as V,D as x,M as Ce,N as Se,v as Y,m as z,e as H,g as j,i as k,G as P,A as $,w as u,_ as Z,q as ke,F as re,u as c,H as Re,I as we,y as W,aP as ze,T as xe,o as Ve,af as Pe,x as $e,k as Te,z as De,B as Ie,C as Ue,P as Fe}from"./index-2C-ofHV5.js";import{i as Oe,u as ie,p as Ae,d as ue,r as qe,s as Be,c as Ne,a as Ee,b as Ye,e as Me,f as We,g as je,h as He,j as Le,k as Ge,l as Je,m as Ke,n as Qe,O as Xe}from"./detail-CR-TgciR.js";import{c as ne}from"./utils-C-gUDCcE.js";import{P as Ze}from"./plus-search-B1FvdIYy.js";import{g as ae}from"./datePicker-ZEs-rmon.js";import{g as et,h as tt,i as lt,s as st,A as nt,j as oe,c as at,d as ot,a as rt,b as it,e as ut,f as dt}from"./dictionary-DwGUqBwq.js";import{p as Q,a as ct}from"./dictionary-DGN_erWP.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-BHKqx4-E.js";import{s as pt}from"./product-BetgexOv.js";import{u as ee}from"./dialog-DFvFShc1.js";import{C as mt}from"./close-bold-Dru7IMTV.js";import"./isIP-DL0XLegh.js";import"./index-CaJyLCRQ.js";function ft(i){const h=F({}),b=F([]),d=F(!0),_=X({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function p(v){_.pageSize=v,g()}function m(v){_.currentPage=v,g()}function g(){d.value=!0;const v=G(L({},ye(h.value)),{pageSize:_.pageSize,currentPage:_.currentPage});v.created_at&&(v.created_at=ne(v.created_at)),v.expires_at&&(v.expires_at=ne(v.expires_at)),Oe(v).then(({data:l})=>{b.value=l.items,_.total=l.total,_.pageSize=l.pageSize,_.currentPage=l.currentPage,he(()=>{i.value&&i.value.getTableRef().clearSelection()})}).finally(()=>{d.value=!1})}return{loading:d,search:h,dataList:b,pagination:_,handleSizeChange:p,handleCurrentChange:m,onSearch:g,onReset:()=>{g()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}function gt(i,h){const b=_e(()=>{i()},500),d=m=>m==="all"?st:m==="archived"?nt:oe,_=F(oe);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/域名/产品/订单号/备注"},onChange:()=>{b()}},{label:"状态集",prop:"statusSet",valueType:"select",fieldProps:{placeholder:"活动中"},options:et,onChange:m=>{h.value.status=void 0,_.value=d(m),b()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},get options(){return _.value},onChange:()=>{b()}},{label:"ID",prop:"id",valueType:"input",fieldProps:{placeholder:"请输入ID"}},{label:"周期",prop:"period",valueType:"select",fieldProps:{placeholder:"请选择周期"},options:Q},{label:"金额",prop:"amount",renderField:(m,g)=>{var S,v;const t=(l,w)=>{l!==void 0&&w!==void 0&&l>w||g([l,w])};return r("div",{class:"flex items-center gap-2 w-full"},[r(V("el-input"),{class:"flex-1",modelValue:(S=m==null?void 0:m[0])==null?void 0:S.toString(),"onUpdate:modelValue":l=>{const w=l===""?void 0:Number(l);t(w,m==null?void 0:m[1])},placeholder:"最小金额",clearable:!0},null),r("span",{class:"flex-none"},[x("至")]),r(V("el-input"),{class:"flex-1",modelValue:(v=m==null?void 0:m[1])==null?void 0:v.toString(),"onUpdate:modelValue":l=>{const w=l===""?void 0:Number(l);t(m==null?void 0:m[0],w)},placeholder:"最大金额",clearable:!0},null)])}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"产品名称",prop:"product_name",valueType:"input",fieldProps:{placeholder:"请输入产品名称"}},{label:"域名",prop:"domain",valueType:"input",fieldProps:{placeholder:"请输入域名"}},{label:"渠道",prop:"channel",valueType:"select",fieldProps:{placeholder:"请选择渠道"},options:tt},{label:"操作",prop:"action",valueType:"select",fieldProps:{placeholder:"请选择操作"},options:lt},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ae()}},{label:"过期时间",prop:"expires_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ae()}}]}}function vt(){const i=F(),h=F([]),b=F([]),d=t=>{h.value=t.map(S=>S.id),b.value=t,i.value.setAdaptive()},_=()=>{h.value=[],i.value.getTableRef().clearSelection()},p=t=>{const S=t.latest_cert,v=S.common_name,l=S.dcv.dns.host,w=S.dcv.dns.type,f=S.dcv.dns.value,n=`域名：${v}
主机记录：${l}
解析类型：${w}
记录值：${f}`;navigator.clipboard.writeText(n).then(()=>{z("解析记录已复制到剪贴板",{type:"success"})})},m=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:120},{label:"用户名",prop:"user.username",minWidth:120,cellRenderer:Ce("user.username")},{label:"产品",prop:"product.name",minWidth:150},{label:"通用名称",prop:"latest_cert.common_name",minWidth:150,cellRenderer:({row:t})=>{var l,w,f,n,o,C;const S=(l=t.latest_cert)==null?void 0:l.common_name,v=["unpaid","pending","processing"].includes((w=t.latest_cert)==null?void 0:w.status)&&((n=(f=t.latest_cert)==null?void 0:f.dcv)==null?void 0:n.method)&&["cname","txt"].includes(t.latest_cert.dcv.method)&&((C=(o=t.latest_cert.dcv)==null?void 0:o.dns)==null?void 0:C.value);return r("div",{className:"flex items-center gap-1"},[r("span",null,[S||"-"]),v&&r(V("el-button"),{link:!0,size:"small",onClick:T=>{T.stopPropagation(),p(t)},className:"!p-0 !m-0 !mt-1 !bg-transparent !border-none !shadow-none align-middle text-gray-500 hover:text-blue-500"},{default:()=>[r(V("el-icon"),{size:"14"},{default:()=>[r(Se,null,null)]})]})])}},{label:"有效期",prop:"period",minWidth:120,formatter:({period:t})=>ct[t]},{label:"金额",prop:"amount",minWidth:80},{label:"渠道",prop:"latest_cert.channel",minWidth:80,cellRenderer:({row:t})=>r(V("el-tag"),{type:ot[t.latest_cert.channel]},{default:()=>[at[t.latest_cert.channel]]})},{label:"操作",prop:"latest_cert.action",minWidth:80,cellRenderer:({row:t})=>r(V("el-tag"),{type:it[t.latest_cert.action]},{default:()=>[rt[t.latest_cert.action]]})},{label:"状态",prop:"latest_cert.status",minWidth:80,cellRenderer:({row:t})=>r(V("el-tag"),{type:dt[t.latest_cert.status]||"info"},{default:()=>[ut[t.latest_cert.status]]})},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:t})=>t?Y(t).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",width:140,slot:"operation"}];return{tableRef:i,selectedIds:h,selectedRows:b,tableColumns:m,handleSelectionChange:d,handleCancelSelection:_,handleRowClick:(t,S,v)=>{var w;const l=v.target;l.tagName==="BUTTON"||l.closest("button")||l.closest(".el-button")||(w=i.value)==null||w.getTableRef().toggleRowSelection(t)}}}const bt={class:"flex items-center gap-2"},yt=H({__name:"buttons",props:{row:{},size:{}},emits:["refresh"],setup(i,{emit:h}){const{toDetail:b}=ie(),d=h,_=f=>{var n,o;return!f.created_at||["unpaid","pending"].includes((n=f.latest_cert)==null?void 0:n.status)?!0:["processing","approving","active"].includes((o=f.latest_cert)==null?void 0:o.status)&&Y().diff(Y(f.created_at),"seconds")<f.product.refund_period*86400},p=f=>{Ae(f.id).then(()=>{z("支付成功",{type:"success"}),d("refresh")})},m=f=>{ue(f.id)},g=f=>{b({ids:f.id},"params")},t=f=>{qe(f.id).then(()=>{z("开始验证，请等待几分钟后刷新页面查看结果",{type:"success"}),d("refresh")})},S=f=>{Be(f.id).then(()=>{z("同步成功",{type:"success"}),d("refresh")})},v=f=>{Ne(f.id).then(()=>{z("提交成功",{type:"success"}),d("refresh")})},l=f=>{Ee(f.id).then(()=>{z("取消成功",{type:"success"}),d("refresh")})},w=f=>{Ye(f.id).then(()=>{z("撤销取消成功",{type:"success"}),d("refresh")})};return(f,n)=>{var T,q,U,B,N,O;const o=V("el-button"),C=V("el-popconfirm");return k(),j("div",bt,[["unpaid"].includes((T=i.row.latest_cert)==null?void 0:T.status)?(k(),P(o,{key:0,class:"reset-margin !outline-none",type:"warning",link:"",size:i.size,onClick:n[0]||(n[0]=y=>p(i.row))},{default:u(()=>[...n[8]||(n[8]=[x(" 支付 ",-1)])]),_:1},8,["size"])):$("",!0),["active"].includes((q=i.row.latest_cert)==null?void 0:q.status)?(k(),P(o,{key:1,class:"reset-margin !outline-none",type:"success",link:"",size:i.size,onClick:n[1]||(n[1]=y=>m(i.row))},{default:u(()=>[...n[9]||(n[9]=[x(" 下载 ",-1)])]),_:1},8,["size"])):$("",!0),["pending"].includes((U=i.row.latest_cert)==null?void 0:U.status)?(k(),P(o,{key:2,class:"reset-margin !outline-none",type:"warning",link:"",size:i.size,onClick:n[2]||(n[2]=y=>v(i.row))},{default:u(()=>[...n[10]||(n[10]=[x(" 提交 ",-1)])]),_:1},8,["size"])):$("",!0),r(o,{class:"reset-margin !outline-none",type:"primary",link:"",size:i.size,onClick:n[3]||(n[3]=y=>g(i.row))},{default:u(()=>[...n[11]||(n[11]=[x(" 查看 ",-1)])]),_:1},8,["size"]),["processing"].includes((B=i.row.latest_cert)==null?void 0:B.status)?(k(),P(o,{key:3,class:"reset-margin !outline-none",type:"primary",link:"",size:i.size,onClick:n[4]||(n[4]=y=>t(i.row))},{default:u(()=>[...n[12]||(n[12]=[x(" 验证 ",-1)])]),_:1},8,["size"])):$("",!0),["processing","active","approving"].includes((N=i.row.latest_cert)==null?void 0:N.status)?(k(),P(o,{key:4,class:"reset-margin !outline-none",type:"primary",link:"",size:i.size,onClick:n[5]||(n[5]=y=>S(i.row))},{default:u(()=>[...n[13]||(n[13]=[x(" 同步 ",-1)])]),_:1},8,["size"])):$("",!0),_(i.row)?(k(),P(C,{key:5,title:"确定要取消吗？",width:"160px",onConfirm:n[6]||(n[6]=y=>l(i.row))},{reference:u(()=>[r(o,{class:"reset-margin !outline-none",type:"danger",link:"",size:i.size},{default:u(()=>[...n[14]||(n[14]=[x(" 取消 ",-1)])]),_:1},8,["size"])]),_:1})):$("",!0),["cancelling"].includes((O=i.row.latest_cert)==null?void 0:O.status)?(k(),P(o,{key:6,class:"reset-margin !outline-none",type:"warning",link:"",size:i.size,onClick:n[7]||(n[7]=y=>w(i.row))},{default:u(()=>[...n[15]||(n[15]=[x(" 撤销取消 ",-1)])]),_:1},8,["size"])):$("",!0)])}}}),ht=Z(yt,[["__scopeId","data-v-89f881ac"]]),_t={class:"batch-buttons"},Ct=H({__name:"batch",props:{selectedRows:{},tableRef:{}},emits:["refresh"],setup(i,{emit:h}){const{toDetail:b}=ie(),d=i,_=h,p=()=>d.selectedRows||[],m=()=>p().map(s=>s.id),g=()=>p().some(s=>{var e;return((e=s.latest_cert)==null?void 0:e.status)==="active"}),t=()=>p().length>0,S=()=>p().some(s=>{var e,a,R;return["unpaid","pending","processing"].includes((e=s.latest_cert)==null?void 0:e.status)&&((R=(a=s.latest_cert)==null?void 0:a.dcv)==null?void 0:R.dns)}),v=()=>p().some(s=>{var e;return((e=s.latest_cert)==null?void 0:e.status)==="unpaid"}),l=()=>p().some(s=>{var e;return((e=s.latest_cert)==null?void 0:e.status)==="pending"}),w=()=>p().some(s=>{var e,a;return((e=s.latest_cert)==null?void 0:e.status)==="processing"&&((a=s.latest_cert)==null?void 0:a.domain_verify_status)!=2}),f=()=>p().some(s=>{var e;return["processing","active","approving"].includes((e=s.latest_cert)==null?void 0:e.status)}),n=()=>p().some(s=>{var e,a;return["unpaid","pending"].includes((e=s.latest_cert)==null?void 0:e.status)?!0:["processing","approving","active"].includes((a=s.latest_cert)==null?void 0:a.status)&&Y().diff(Y(s.created_at),"seconds")<s.product.refund_period*86400}),o=()=>p().some(s=>{var e;return((e=s.latest_cert)==null?void 0:e.status)==="cancelling"}),C=()=>{d.tableRef.clearSelection();const s=[];if(p().forEach(e=>{e.latest_cert.status=="active"&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个已签发证书",{type:"error"});return}ue(s.toString())},T=()=>{const s=m();b({ids:s.join(",")},"params")},q=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{var a;["unpaid","pending","processing"].includes(e.latest_cert.status)&&((a=e.latest_cert.dcv)!=null&&a.dns)&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个符合要求的证书 1.未签发 2.使用解析验证",{type:"error"});return}Me(s).then(e=>{let a="";e.data.forEach(R=>{let D=R.latest_cert,A=D.validation[0];if(["unpaid","pending","processing"].includes(D.status)&&(A!=null&&A.host))if((()=>{const E=new Set;for(const I of D.validation)if(I.host){if(E.size>0&&!E.has(I.host))return!0;E.add(I.host)}return!1})())a+=A.domain+`此证书多个域名解析记录不同，跳过复制

`;else{let E=D.validation.length>2?" 此证书多个域名解析记录相同":"";a+="域名："+A.domain+E+`
主机记录：`+A.host+`
解析类型：`+A.method+`
记录值：`+A.value+`

`}}),navigator.clipboard.writeText(a).then(()=>{z("复制成功",{type:"success"})}).catch(()=>{z("复制失败",{type:"error"})})}).catch(()=>{z("复制失败",{type:"error"})})},U=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{e.latest_cert.status=="unpaid"&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个未支付的订单",{type:"error"});return}We(s).then(()=>{z("支付成功",{type:"success"}),_("refresh")})},B=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{e.latest_cert.status=="pending"&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个待提交的订单",{type:"error"});return}je(s.toString()).then(()=>{z("提交成功",{type:"success"}),_("refresh")})},N=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{var a;e.latest_cert.status=="processing"&&((a=e.latest_cert)==null?void 0:a.domain_verify_status)!=2&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个符合要求的证书 1.状态是处理中 2.所有域名尚未完成验证",{type:"error"});return}He(s.toString()).then(()=>{z("开始验证，请等待几分钟后刷新页面查看结果",{type:"success"}),_("refresh")})},O=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{["processing","active","approving"].includes(e.latest_cert.status)&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("请至少选择一个待验证，已签发，待审核证书",{type:"error"});return}Le(s.toString()).then(()=>{z("同步成功",{type:"success"}),_("refresh")})},y=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{(["unpaid","pending"].includes(e.latest_cert.status)||["processing","approving","active"].includes(e.latest_cert.status)&&Y().diff(Y(e.created_at),"seconds")<e.product.refund_period*86400)&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("只有待支付、待提交、待验证、待审核、已签发并在退款期限内的订单可以取消",{type:"error"});return}Ge(s.toString()).then(()=>{z("取消成功",{type:"success"}),_("refresh")})},M=()=>{const s=[];if(d.tableRef.clearSelection(),p().forEach(e=>{["cancelling"].includes(e.latest_cert.status)&&(s.push(e.id),d.tableRef.toggleRowSelection(e))}),!s.length){z("只有取消中的证书可以撤销",{type:"error"});return}Je(s.toString()).then(()=>{z("撤销取消成功",{type:"success"}),_("refresh")})};return(s,e)=>{const a=V("el-button"),R=V("el-popconfirm");return k(),j("div",_t,[g()?(k(),P(a,{key:0,type:"primary",size:"small",class:"ml-2",onClick:e[0]||(e[0]=D=>C())},{default:u(()=>[...e[9]||(e[9]=[x(" 下载证书 ",-1)])]),_:1})):$("",!0),t()?(k(),P(a,{key:1,type:"primary",size:"small",class:"ml-2",onClick:e[1]||(e[1]=D=>T())},{default:u(()=>[...e[10]||(e[10]=[x(" 查看订单 ",-1)])]),_:1})):$("",!0),S()?(k(),P(a,{key:2,type:"primary",size:"small",class:"ml-2",onClick:e[2]||(e[2]=D=>q())},{default:u(()=>[...e[11]||(e[11]=[x(" 复制解析 ",-1)])]),_:1})):$("",!0),v()?(k(),P(a,{key:3,type:"primary",size:"small",class:"ml-2",onClick:e[3]||(e[3]=D=>U())},{default:u(()=>[...e[12]||(e[12]=[x(" 支付订单 ",-1)])]),_:1})):$("",!0),l()?(k(),P(a,{key:4,type:"primary",size:"small",class:"ml-2",onClick:e[4]||(e[4]=D=>B())},{default:u(()=>[...e[13]||(e[13]=[x(" 提交订单 ",-1)])]),_:1})):$("",!0),w()?(k(),P(a,{key:5,type:"primary",size:"small",class:"ml-2",onClick:e[5]||(e[5]=D=>N())},{default:u(()=>[...e[14]||(e[14]=[x(" 重新验证 ",-1)])]),_:1})):$("",!0),f()?(k(),P(a,{key:6,type:"primary",size:"small",class:"ml-2",onClick:e[6]||(e[6]=D=>O())},{default:u(()=>[...e[15]||(e[15]=[x(" 同步订单 ",-1)])]),_:1})):$("",!0),n()?(k(),P(R,{key:7,title:"确定要取消订单吗？",width:"160px",onConfirm:e[7]||(e[7]=D=>y())},{reference:u(()=>[r(a,{type:"danger",size:"small",class:"ml-2"},{default:u(()=>[...e[16]||(e[16]=[x(" 取消订单 ",-1)])]),_:1})]),_:1})):$("",!0),o()?(k(),P(a,{key:8,type:"warning",size:"small",class:"ml-2",onClick:e[8]||(e[8]=D=>M())},{default:u(()=>[...e[17]||(e[17]=[x(" 撤销取消 ",-1)])]),_:1})):$("",!0)])}}}),St=Z(Ct,[["__scopeId","data-v-2f70fd13"]]),kt={class:"dialog-footer"},Rt=H({__name:"input",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(i,{emit:h}){const b=i,d=h,{dialogSize:_}=ee(),p=F(),m=F(!1),g=F(null),t=X({user_id:"",product_id:"",period:12,api_id:"",action:"new",order_id:"",csr:"",private_key:"",common_name:""}),S=ke(()=>{var n;return(n=g.value)!=null&&n.periods?Q.filter(o=>g.value.periods.includes(o.value)):Q.filter(o=>[12,24,36,48,60].includes(o.value))}),v=()=>{t.order_id=""},l=n=>J(null,null,function*(){if(!n){g.value=null,t.period=12;return}const o=yield pt(Number(n));o.code===1&&(g.value=o.data,g.value.periods&&g.value.periods.length>0&&(g.value.periods.includes(t.period)||(t.period=g.value.periods[0])))}),w=()=>J(null,null,function*(){if(p.value)try{yield p.value.validate(),m.value=!0;const n=G(L({},t),{channel:"admin"});yield Ke(n),z("导入成功",{type:"success"}),f(),d("success")}finally{m.value=!1}}),f=()=>{Object.assign(t,{user_id:"",product_id:"",period:12,api_id:"",action:"new",order_id:"",csr:"",private_key:"",common_name:""}),g.value=null,d("update:visible",!1)};return re(()=>b.visible,n=>{var o;n||(o=p.value)==null||o.resetFields()}),(n,o)=>{const C=V("el-form-item"),T=V("el-option"),q=V("el-select"),U=V("el-input"),B=V("el-form"),N=V("el-button"),O=V("el-dialog");return k(),P(O,{"model-value":i.visible,title:"导入证书",width:c(_),"onUpdate:modelValue":o[9]||(o[9]=y=>n.$emit("update:visible",y))},{footer:u(()=>[W("span",kt,[r(N,{onClick:f},{default:u(()=>[...o[10]||(o[10]=[x("取消",-1)])]),_:1}),r(N,{type:"primary",loading:m.value,onClick:w},{default:u(()=>[...o[11]||(o[11]=[x("导入",-1)])]),_:1},8,["loading"])])]),default:u(()=>[r(B,{ref_key:"formRef",ref:p,model:t,"label-width":"100px",class:"ml-3 mr-3"},{default:u(()=>[r(C,{label:"用户",prop:"user_id",rules:[{required:!0,message:"请选择用户",trigger:"change"}]},{default:u(()=>[r(c(K),{modelValue:t.user_id,"onUpdate:modelValue":o[0]||(o[0]=y=>t.user_id=y),uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",style:{width:"100%"},onChange:v},null,8,["modelValue"])]),_:1}),r(C,{label:"产品",prop:"product_id",rules:[{required:!0,message:"请选择产品",trigger:"change"}]},{default:u(()=>[r(c(K),{modelValue:t.product_id,"onUpdate:modelValue":o[1]||(o[1]=y=>t.product_id=y),uri:"/product",searchField:"quickSearch",labelField:"name",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择产品",style:{width:"100%"},onChange:l},null,8,["modelValue"])]),_:1}),r(C,{label:"有效期",prop:"period",rules:[{required:!0,message:"请选择有效期",trigger:"change"}]},{default:u(()=>[r(q,{modelValue:t.period,"onUpdate:modelValue":o[2]||(o[2]=y=>t.period=y),placeholder:"请选择有效期",style:{width:"100%"},disabled:!t.product_id},{default:u(()=>[(k(!0),j(Re,null,we(S.value,y=>(k(),P(T,{key:y.value,label:y.label,value:y.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),r(C,{label:"接口ID",prop:"api_id",rules:[{required:!0,message:"请输入接口ID",trigger:"blur"}]},{default:u(()=>[r(U,{modelValue:t.api_id,"onUpdate:modelValue":o[3]||(o[3]=y=>t.api_id=y),placeholder:"请输入CA接口返回的证书ID"},null,8,["modelValue"])]),_:1}),r(C,{label:"通用名",prop:"common_name",rules:[{required:!0,message:"请输入通用名",trigger:"blur"}]},{default:u(()=>[r(U,{modelValue:t.common_name,"onUpdate:modelValue":o[4]||(o[4]=y=>t.common_name=y),placeholder:"请输入证书的通用名（域名）"},null,8,["modelValue"])]),_:1}),r(C,{label:"操作类型",prop:"action",rules:[{required:!0,message:"请选择操作类型",trigger:"change"}]},{default:u(()=>[r(q,{modelValue:t.action,"onUpdate:modelValue":o[5]||(o[5]=y=>t.action=y),placeholder:"请选择操作类型",style:{width:"100%"}},{default:u(()=>[r(T,{label:"新购",value:"new"}),r(T,{label:"续费",value:"renew"}),r(T,{label:"重签",value:"reissue"})]),_:1},8,["modelValue"])]),_:1}),t.action==="reissue"?(k(),P(C,{key:0,label:"原订单ID",prop:"order_id",rules:[{required:!0,message:"请选择原订单",trigger:"change"}]},{default:u(()=>[(k(),P(c(K),{key:t.user_id,modelValue:t.order_id,"onUpdate:modelValue":o[6]||(o[6]=y=>t.order_id=y),uri:"/order",searchField:"id",labelField:"id",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择原订单",style:{width:"100%"},clearable:!0,queryParams:{user_id:t.user_id},disabled:!t.user_id},null,8,["modelValue","queryParams","disabled"]))]),_:1})):$("",!0),r(C,{label:"CSR（可选）"},{default:u(()=>[r(U,{modelValue:t.csr,"onUpdate:modelValue":o[7]||(o[7]=y=>t.csr=y),type:"textarea",rows:4,placeholder:"请输入CSR内容（可选）"},null,8,["modelValue"])]),_:1}),r(C,{label:"私钥（可选）"},{default:u(()=>[r(U,{modelValue:t.private_key,"onUpdate:modelValue":o[8]||(o[8]=y=>t.private_key=y),type:"textarea",rows:4,placeholder:"请输入私钥内容（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","width"])}}}),wt={class:"dialog-footer"},zt=H({__name:"createUser",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(i,{emit:h}){const b=i,d=h,{dialogSize:_}=ee(),p=F(),m=F(!1),g=X({email:"",username:""}),t=()=>J(null,null,function*(){if(p.value)try{yield p.value.validate(),m.value=!0;const v={email:g.email,username:g.username||void 0};yield ze(v),z("用户创建成功，登录信息已发送到邮箱",{type:"success"}),S(),d("success")}catch(v){console.error(v)}finally{m.value=!1}}),S=()=>{Object.assign(g,{email:"",username:""}),d("update:visible",!1)};return re(()=>b.visible,v=>{var l;v||(l=p.value)==null||l.resetFields()}),(v,l)=>{const w=V("el-input"),f=V("el-form-item"),n=V("el-form"),o=V("el-button"),C=V("el-dialog");return k(),P(C,{"model-value":i.visible,title:"创建用户",width:c(_),"onUpdate:modelValue":l[2]||(l[2]=T=>v.$emit("update:visible",T))},{footer:u(()=>[W("span",wt,[r(o,{onClick:S},{default:u(()=>[...l[3]||(l[3]=[x("取消",-1)])]),_:1}),r(o,{type:"primary",loading:m.value,onClick:t},{default:u(()=>[...l[4]||(l[4]=[x("创建",-1)])]),_:1},8,["loading"])])]),default:u(()=>[r(n,{ref_key:"formRef",ref:p,model:g,"label-width":"100px"},{default:u(()=>[r(f,{label:"邮箱",prop:"email",rules:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],class:"ml-3 mr-3"},{default:u(()=>[r(w,{modelValue:g.email,"onUpdate:modelValue":l[0]||(l[0]=T=>g.email=T),placeholder:"请输入邮箱",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(f,{label:"用户名",prop:"username",rules:[{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],class:"ml-3 mr-3"},{default:u(()=>[r(w,{modelValue:g.username,"onUpdate:modelValue":l[1]||(l[1]=T=>g.username=T),placeholder:"不填写将自动生成",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","width"])}}}),xt={class:"main"},Vt={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Pt={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},$t={class:"flex-auto"},Tt={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Dt=H({name:"Order",__name:"index",setup(i){const{dialogSize:h}=ee(),b=xe(),{tableRef:d,selectedIds:_,selectedRows:p,tableColumns:m,handleSelectionChange:g,handleCancelSelection:t,handleRowClick:S}=vt(),{loading:v,search:l,dataList:w,pagination:f,handleSizeChange:n,handleCurrentChange:o,onSearch:C,onReset:T,onCollapse:q}=ft(d),{action:U,openAction:B}=Qe(),{searchColumns:N}=gt(C,l),O=F(!1),y=()=>{O.value=!0},M=F(!1),s=()=>{M.value=!0};let e=null;return Ve(()=>{const a=b.query;a.username&&(l.value.username=a.username),a.id&&(l.value.id=Number(a.id)),a.status&&(l.value.status=a.status),a.statusSet&&(l.value.statusSet=a.statusSet),a.domain&&(l.value.domain=a.domain),a.product_name&&(l.value.product_name=a.product_name),a.channel&&(l.value.channel=a.channel),a.action&&(l.value.action=a.action),a.expires_at&&Array.isArray(a.expires_at)&&(l.value.expires_at=a.expires_at),a.created_at&&Array.isArray(a.created_at)&&(l.value.created_at=a.created_at),a.amount&&Array.isArray(a.amount)&&(l.value.amount=a.amount.map(Number)),a.period&&(l.value.period=Number(a.period)),C(),e=setInterval(()=>{C()},180*1e3)}),Pe(()=>{e!==null&&(clearInterval(e),e=null)}),(a,R)=>{const D=V("el-button"),A=V("el-tooltip"),te=V("pure-table"),E=$e("motion-fade");return k(),j("div",xt,[W("div",Vt,[r(c(Ze),{modelValue:c(l),"onUpdate:modelValue":R[0]||(R[0]=I=>Te(l)?l.value=I:null),columns:c(N),"show-number":3,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:c(C),onReset:c(T),onCollapse:c(q)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),r(c(Fe),{title:"订单管理",columns:c(m),onRefresh:c(C)},{buttons:u(()=>[r(D,{type:"primary",onClick:R[1]||(R[1]=I=>c(B)("apply"))},{default:u(()=>[...R[6]||(R[6]=[x("申请证书",-1)])]),_:1}),r(D,{type:"success",onClick:R[2]||(R[2]=I=>c(B)("batchApply"))},{default:u(()=>[...R[7]||(R[7]=[x("批量申请",-1)])]),_:1}),c(h)!=="90%"?(k(),P(D,{key:0,type:"info",onClick:y},{default:u(()=>[...R[8]||(R[8]=[x("导入证书",-1)])]),_:1})):$("",!0),c(h)!=="90%"?(k(),P(D,{key:1,type:"info",onClick:s},{default:u(()=>[...R[9]||(R[9]=[x("创建用户",-1)])]),_:1})):$("",!0)]),default:u(({size:I,dynamicColumns:de})=>[c(_).length>0?De((k(),j("div",Pt,[W("div",$t,[r(A,{placement:"top",content:"取消选择"},{default:u(()=>[r(D,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:c(Ie)(c(mt)),onClick:c(t)},null,8,["icon","onClick"])]),_:1}),W("span",Tt," 已选 "+Ue(c(_).length)+" 项 ",1)]),r(St,{selectedRows:c(p),tableRef:c(d).getTableRef(),onRefresh:c(C)},null,8,["selectedRows","tableRef","onRefresh"])])),[[E]]):$("",!0),r(te,{ref_key:"tableRef",ref:d,"row-key":"id","align-whole":"left","table-layout":"auto",loading:c(v),size:I,adaptive:"",adaptiveConfig:{offsetBottom:108},data:c(w),columns:de,pagination:G(L({},c(f)),{size:I}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:c(S),onSelectionChange:c(g),onPageSizeChange:c(n),onPageCurrentChange:c(o)},{operation:u(({row:ce,size:pe})=>[r(ht,{row:ce,size:pe,onRefresh:c(C)},null,8,["row","size","onRefresh"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),r(Xe,{visible:c(U).visible,"onUpdate:visible":R[3]||(R[3]=I=>c(U).visible=I),actionType:c(U).type,orderId:c(U).id,onSuccess:c(C)},null,8,["visible","actionType","orderId","onSuccess"]),r(Rt,{visible:O.value,"onUpdate:visible":R[4]||(R[4]=I=>O.value=I),onSuccess:c(C)},null,8,["visible","onSuccess"]),r(zt,{visible:M.value,"onUpdate:visible":R[5]||(R[5]=I=>M.value=I),onSuccess:c(C)},null,8,["visible","onSuccess"])])}}}),Lt=Z(Dt,[["__scopeId","data-v-9d74bad8"]]);export{Lt as default};
