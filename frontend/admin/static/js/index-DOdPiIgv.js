var ee=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var U=(o,t,a)=>t in o?ee(o,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[t]=a,R=(o,t)=>{for(var a in t||(t={}))le.call(t,a)&&U(o,a,t[a]);if(M)for(var a of M(t))ae.call(t,a)&&U(o,a,t[a]);return o},T=(o,t)=>te(o,oe(t));import{r as d,l as ne,m as I,t as se,n as re,p as ie,v as Y,e as ue,o as ce,f as w,x as pe,g as L,i as A,y as D,j as c,u as e,k as q,w as m,z as de,A as me,B as fe,C as ge,D as x,P as he,_ as be}from"./index-2C-ofHV5.js";import{a as ve,d as Ce,i as Se,F as _e,u as ye,s as we,c as xe,e as Pe}from"./userLevel-CcvbNlzu.js";import{P as ke}from"./plus-search-B1FvdIYy.js";import{p as ze}from"./utils-C-gUDCcE.js";import{u as Re}from"./drawer-BlMYOobw.js";import{C as Te}from"./close-bold-Dru7IMTV.js";import{P as De}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";function Fe(o){const t=d({}),a=d([]),i=d(!0),s=ne({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function C(n){s.pageSize=n,h()}function l(n){s.currentPage=n,h()}const f=d(!1),g=d(0),p=n=>{f.value=!0,n?g.value=n:g.value=0},v=n=>{Ce(n).then(()=>{I("删除成功",{type:"success"}),h()})},S=n=>{ve(n).then(()=>{I("删除成功",{type:"success"}),h()})};function h(){i.value=!0;const n=T(R({},se(t.value)),{pageSize:s.pageSize,currentPage:s.currentPage});Se(n).then(({data:u})=>{a.value=u.items,s.total=u.total,s.pageSize=u.pageSize,s.currentPage=u.currentPage,re(()=>{o.value&&o.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:t,dataList:a,pagination:s,handleSizeChange:C,handleCurrentChange:l,onSearch:h,showStore:f,updateId:g,handleStore:p,handleDestroy:v,handleBatchDestroy:S}}const Ve=o=>{const t=ie(()=>{o()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"编号/名称"}},{label:"定制",prop:"custom",valueType:"select",options:[{label:"是",value:1},{label:"否",value:0}],fieldProps:{placeholder:"请选择是否定制"}}],debouncedSearch:t}},Be=o=>{const t=d(!1),a=d(),i=d(0),s=d({}),C=[{label:"编码",prop:"code",valueType:"input",fieldProps:{placeholder:"请输入编码"}},{label:"名称",prop:"name",valueType:"input",fieldProps:{placeholder:"请输入名称"}},{label:"定制",prop:"custom",valueType:"select",options:[{label:"是",value:1},{label:"否",value:0}],fieldProps:{placeholder:"请选择是否定制"}},{label:"权重",prop:"weight",valueType:"input-number",fieldProps:{placeholder:"请输入权重",min:1,max:1e4,controlsPosition:"right"}},{label:"成本价倍率",prop:"cost_rate",valueType:"input-number",fieldProps:{placeholder:"请输入成本价倍率",min:1,precision:4,step:.01,controlsPosition:"right"}}],l={code:[{required:!0,message:"请输入编码"},{min:3,max:50,message:"编码长度在 3 到 50 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入名称"},{min:3,max:100,message:"名称长度在 3 到 100 个字符",trigger:"blur"}],custom:[{required:!0,message:"请选择类型"}],weight:[{required:!0,message:"请输入权重"},{type:"number",message:"请输入数字",trigger:"blur"}],cost_rate:[{required:!0,message:"请输入成本价倍率"},{type:"number",min:1,message:"成本价倍率必须大于等于1",trigger:"blur"}]};function f(n=0){var u,y;t.value=!0,n>0?i.value!==n&&v(n):((y=(u=a.value)==null?void 0:u.formInstance)==null||y.resetFields(),s.value=Object.fromEntries(Object.entries(_e).filter(([F,P])=>P!==""))),i.value=n}function g(){i.value>0?h():S()}function p(){t.value=!1}const v=n=>{xe(n).then(({data:u})=>{s.value=ze(u,Pe)})},S=()=>{we(s.value).then(()=>{o(),t.value=!1})},h=()=>{ye(i.value,s.value).then(()=>{o(),t.value=!1})};return{storeRef:a,showStore:t,storeId:i,storeValues:s,storeColumns:C,rules:l,openStoreForm:f,confirmStoreForm:g,closeStoreForm:p}},Me=()=>{const o=d(),t=d([]);return{tableRef:o,selectedIds:t,handleSelectionChange:l=>{t.value=l.map(f=>f.id),o.value.setAdaptive()},handleSelectionCancel:()=>{var l;(l=o.value)==null||l.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:50},{label:"编码",prop:"code",minWidth:100},{label:"名称",prop:"name",minWidth:140},{label:"定制",prop:"custom",width:60,formatter:({custom:l})=>l===1?"是":"否"},{label:"成本价倍率",prop:"cost_rate",width:100,formatter:({cost_rate:l})=>l.toFixed(4)},{label:"权重",prop:"weight",width:70},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:l})=>l?Y(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"更新时间",prop:"updated_at",width:170,formatter:({updated_at:l})=>l?Y(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleRowClick:(l,f,g)=>{var v;const p=g.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(v=o.value)==null||v.getTableRef().toggleRowSelection(l)}}},Ue={class:"main"},Ie={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ye={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Le={class:"flex-auto"},Ae={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},qe=ue({name:"UserLevel",__name:"index",setup(o){const{drawerSize:t}=Re(),{tableRef:a,selectedIds:i,handleSelectionChange:s,handleSelectionCancel:C,tableColumns:l,handleRowClick:f}=Me(),{loading:g,search:p,dataList:v,pagination:S,handleSizeChange:h,handleCurrentChange:n,onSearch:u,handleDestroy:y,handleBatchDestroy:F}=Fe(a),{searchColumns:P,debouncedSearch:N}=Ve(()=>u()),{storeRef:O,showStore:$,storeId:j,storeColumns:E,rules:H,storeValues:k,openStoreForm:V,confirmStoreForm:W,closeStoreForm:K}=Be(()=>u());return ce(()=>{u()}),(Ne,r)=>{const _=w("el-button"),G=w("el-tooltip"),B=w("el-popconfirm"),J=w("pure-table"),Q=pe("motion-fade");return A(),L("div",Ue,[D("div",Ie,[c(e(ke),{modelValue:e(p),"onUpdate:modelValue":r[0]||(r[0]=b=>q(p)?p.value=b:null),columns:e(P),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:e(N)},null,8,["modelValue","columns","onChange"])]),c(e(he),{title:"用户级别",columns:e(l),onRefresh:e(u)},{buttons:m(()=>[c(_,{type:"primary",onClick:r[1]||(r[1]=b=>e(V)())},{default:m(()=>[...r[4]||(r[4]=[x("新增用户级别",-1)])]),_:1})]),default:m(({size:b,dynamicColumns:X})=>[e(i).length>0?de((A(),L("div",Ye,[D("div",Le,[c(G,{placement:"top",content:"取消选择"},{default:m(()=>[c(_,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:e(fe)(e(Te)),onClick:e(C)},null,8,["icon","onClick"])]),_:1}),D("span",Ae," 已选 "+ge(e(i).length)+" 项 ",1)]),c(B,{title:"确定要删除吗？",width:"160px",onConfirm:r[2]||(r[2]=z=>e(F)(e(i)))},{reference:m(()=>[c(_,{type:"danger",size:"small"},{default:m(()=>[...r[5]||(r[5]=[x(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[Q]]):me("",!0),c(J,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(g),size:b,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(v),columns:X,pagination:T(R({},e(S)),{size:b}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:e(f),onSelectionChange:e(s),onPageSizeChange:e(h),onPageCurrentChange:e(n)},{operation:m(({row:z})=>[c(_,{class:"reset-margin !outline-none",type:"primary",link:"",size:b,onClick:Z=>e(V)(z.id)},{default:m(()=>[...r[6]||(r[6]=[x(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),c(B,{title:"确定要删除吗？",width:"160px",onConfirm:Z=>e(y)(z.id)},{reference:m(()=>[c(_,{class:"reset-margin !outline-none",link:"",type:"danger",size:b},{default:m(()=>[...r[7]||(r[7]=[x(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(e(De),{ref_key:"storeRef",ref:O,modelValue:e(k),"onUpdate:modelValue":r[3]||(r[3]=b=>q(k)?k.value=b:null),visible:e($),form:{columns:e(E),rules:e(H),labelPosition:"right",labelSuffix:"",labelWidth:100},size:e(t),closeOnClickModal:!0,title:e(j)>0?"编辑用户级别":"新增用户级别",confirmText:"提交",cancelText:"取消",onConfirm:e(W),onCancel:e(K)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),Qe=be(qe,[["__scopeId","data-v-de69209a"]]);export{Qe as default};
