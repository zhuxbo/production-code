var te=Object.defineProperty,oe=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Y=(e,o,n)=>o in e?te(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,D=(e,o)=>{for(var n in o||(o={}))ae.call(o,n)&&Y(e,n,o[n]);if(I)for(var n of I(o))le.call(o,n)&&Y(e,n,o[n]);return e},T=(e,o)=>oe(e,ne(o));import{P as re,a as se}from"./plus-search-CXVUhiZd.js";import{k as _,r as d,l as ie,m as $,t as ce,n as ue,p as me,s as A,d as de,o as pe,c as O,e as N,v as V,f as u,i as t,j,w as p,x as fe,y as he,h as w,z as ge,A as k,B as Ce,_ as ve}from"./index-DCZMYJHA.js";import{p as be}from"./utils-CxrrWYbC.js";import{u as _e}from"./hooks-MU7UDT6Y.js";import{u as Se}from"./drawer-DPOMF7HO.js";import{C as ye}from"./close-bold-CBYhAie_.js";import{P as xe}from"./index-DWRVWbNd.js";import"./index-BpjGGhss.js";import"./epTheme-COmaAcfL.js";function we(e){return _.get("/chain",{params:e})}const U={common_name:"",intermediate_cert:""},ke=Object.keys(U);function ze(e){return _.post("/chain",{data:e})}function Re(e,o){return _.put(`/chain/${e}`,{data:o})}function Pe(e){return _.get(`/chain/${e}`)}function De(e){return _.delete(`/chain/${e}`)}function Te(e){return _.delete("/chain/batch",{data:{ids:e}})}function Ve(e){const o=d({}),n=d([]),i=d(!0),r=ie({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function b(a){r.pageSize=a,g()}function l(a){r.currentPage=a,g()}const f=d(!1),h=d(0),m=a=>{f.value=!0,a?h.value=a:h.value=0},v=a=>{De(a).then(()=>{$("删除成功",{type:"success"}),g()})},S=a=>{Te(a).then(()=>{$("删除成功",{type:"success"}),g()})};function g(){i.value=!0;const a=T(D({},ce(o.value)),{pageSize:r.pageSize,currentPage:r.currentPage});we(a).then(({data:c})=>{n.value=c.items,r.total=c.total,r.pageSize=c.pageSize,r.currentPage=c.currentPage,ue(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:o,dataList:n,pagination:r,handleSizeChange:b,handleCurrentChange:l,onSearch:g,showStore:f,updateId:h,handleStore:m,handleDestroy:v,handleBatchDestroy:S}}const Be=e=>{const o=me(()=>{e()},500);return{searchColumns:[{label:"名称",prop:"common_name",valueType:"input",fieldProps:{placeholder:"请输入名称"},onChange:()=>{o()}}]}},Fe=e=>{const o=d(!1),n=d(),i=d(0),r=d({}),b=[{label:"名称",prop:"common_name",valueType:"input",fieldProps:{placeholder:"请输入名称"}},{label:"中间证书",prop:"intermediate_cert",valueType:"textarea",fieldProps:{placeholder:"请输入中间证书",rows:15}}],l={common_name:[{required:!0,message:"请输入名称"},{max:100,message:"名称长度不能超过100个字符",trigger:"blur"}],intermediate_cert:[{required:!0,message:"请输入中间证书"},{max:4e3,message:"中间证书长度不能超过4000个字符",trigger:"blur"}]};function f(a=0){var c,x;o.value=!0,a>0?i.value!==a&&v(a):((x=(c=n.value)==null?void 0:c.formInstance)==null||x.resetFields(),r.value=Object.fromEntries(Object.entries(U).filter(([B,z])=>z!==""))),i.value=a}function h(){i.value>0?g():S()}function m(){o.value=!1}const v=a=>{Pe(a).then(c=>{r.value=be(c.data,ke)})},S=()=>{ze(r.value).then(()=>{e(),o.value=!1})},g=()=>{Re(i.value,r.value).then(()=>{e(),o.value=!1})};return{storeRef:n,showStore:o,storeId:i,storeValues:r,storeColumns:b,rules:l,openStoreForm:f,confirmStoreForm:h,closeStoreForm:m}},Me=()=>{const e=d(),o=d([]);return{tableRef:e,selectedIds:o,handleSelectionChange:l=>{o.value=l.map(f=>f.id),e.value.setAdaptive()},handleSelectionCancel:()=>{var l;(l=e.value)==null||l.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:80},{label:"名称",prop:"common_name",minWidth:150},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:l})=>l?A(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"更新时间",prop:"updated_at",minWidth:180,formatter:({updated_at:l})=>l?A(l).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleRowClick:(l,f,h)=>{var v;const m=h.target;m.tagName==="BUTTON"||m.closest("button")||m.closest(".el-button")||(v=e.value)==null||v.getTableRef().toggleRowSelection(l)}}},Ie={class:"main"},Ye={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},$e={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ae={class:"flex-auto"},Oe={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Ne=de({name:"Chain",__name:"index",setup(e){const{drawerSize:o}=Se(),{tableRef:n,selectedIds:i,handleSelectionChange:r,handleSelectionCancel:b,tableColumns:l,handleRowClick:f}=Me(),{loading:h,search:m,dataList:v,pagination:S,handleSizeChange:g,handleCurrentChange:a,onSearch:c,handleDestroy:x,handleBatchDestroy:B}=Ve(n),{searchColumns:z}=Be(()=>c()),{storeRef:E,showStore:H,storeId:W,storeColumns:L,rules:q,storeValues:R,openStoreForm:F,confirmStoreForm:K,closeStoreForm:G}=Fe(()=>c());return pe(()=>{c()}),(je,s)=>{const y=w("el-button"),J=w("el-tooltip"),M=w("el-popconfirm"),Q=w("pure-table"),X=Ce("motion-fade");return N(),O("div",Ie,[V("div",Ye,[u(t(re),{modelValue:t(m),"onUpdate:modelValue":s[0]||(s[0]=C=>j(m)?m.value=C:null),columns:t(z),"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1},null,8,["modelValue","columns"])]),u(t(se),{title:"证书链",columns:t(l),onRefresh:t(c)},{buttons:p(()=>[u(y,{type:"primary",onClick:s[1]||(s[1]=C=>t(F)())},{default:p(()=>s[4]||(s[4]=[k("新增证书链")])),_:1})]),default:p(({size:C,dynamicColumns:Z})=>[t(i).length>0?fe((N(),O("div",$e,[V("div",Ae,[u(J,{placement:"top",content:"取消选择"},{default:p(()=>[u(y,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(_e)(t(ye)),onClick:t(b)},null,8,["icon","onClick"])]),_:1}),V("span",Oe," 已选 "+ge(t(i).length)+" 项 ",1)]),u(M,{title:"确定要删除吗？",width:"160px",onConfirm:s[2]||(s[2]=P=>t(B)(t(i)))},{reference:p(()=>[u(y,{type:"danger",size:"small"},{default:p(()=>s[5]||(s[5]=[k(" 批量删除 ")])),_:1})]),_:1})])),[[X]]):he("",!0),u(Q,{ref_key:"tableRef",ref:n,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(h),size:C,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(v),columns:Z,pagination:T(D({},t(S)),{size:C}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(f),onSelectionChange:t(r),onPageSizeChange:t(g),onPageCurrentChange:t(a)},{operation:p(({row:P})=>[u(y,{class:"reset-margin !outline-none",type:"primary",link:"",size:C,onClick:ee=>t(F)(P.id)},{default:p(()=>s[6]||(s[6]=[k(" 编辑 ")])),_:2},1032,["size","onClick"]),u(M,{title:"确定要删除吗？",width:"160px",onConfirm:ee=>t(x)(P.id)},{reference:p(()=>[u(y,{class:"reset-margin !outline-none",link:"",type:"danger",size:C},{default:p(()=>s[7]||(s[7]=[k(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),u(t(xe),{ref_key:"storeRef",ref:E,modelValue:t(R),"onUpdate:modelValue":s[3]||(s[3]=C=>j(R)?R.value=C:null),visible:t(H),form:{columns:t(L),rules:t(q),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:t(W)>0?"编辑证书链":"新增证书链",confirmText:"提交",cancelText:"取消",onConfirm:t(K),onCancel:t(G)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),Xe=ve(Ne,[["__scopeId","data-v-2bc2d46d"]]);export{Xe as default};
