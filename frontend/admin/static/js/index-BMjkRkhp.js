var oe=Object.defineProperty,ae=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var $=(e,o,a)=>o in e?oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,D=(e,o)=>{for(var a in o||(o={}))ne.call(o,a)&&$(e,a,o[a]);if(M)for(var a of M(o))re.call(o,a)&&$(e,a,o[a]);return e},F=(e,o)=>ae(e,le(o));import{K as S,r as m,l as se,m as Y,t as ie,n as ue,p as ce,j as c,M as pe,v as de,e as me,o as fe,f as R,x as he,g as q,i as O,y as V,u as t,k as W,w as h,z as ge,A as be,B as ve,C as Ce,D as k,P as _e,_ as ye}from"./index-2C-ofHV5.js";import{c as Se,p as xe}from"./utils-C-gUDCcE.js";import{P as Pe}from"./plus-search-B1FvdIYy.js";import{g as we}from"./datePicker-ZEs-rmon.js";import{_ as Re}from"./index.vue_vue_type_script_setup_true_lang-BHKqx4-E.js";import{u as ke}from"./drawer-BlMYOobw.js";import{C as Te}from"./close-bold-Dru7IMTV.js";import{P as ze}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";function De(e){return S.get("/contact",{params:e})}const A={user_id:0,first_name:"",last_name:"",identification_number:"",title:"",email:"",phone:0},Fe=Object.keys(A);function Ve(e){return S.post("/contact",{data:e})}function Be(e,o){return S.put(`/contact/${e}`,{data:o})}function Ie(e){return S.get(`/contact/${e}`)}function Me(e){return S.delete(`/contact/${e}`)}function $e(e){return S.delete("/contact/batch",{data:{ids:e}})}function Ye(e){const o=m({}),a=m([]),r=m(!0),n=se({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function y(l){n.pageSize=l,f()}function i(l){n.currentPage=l,f()}const g=m(!1),b=m(0),p=l=>{g.value=!0,l?b.value=l:b.value=0},C=l=>{Me(l).then(()=>{Y("删除成功",{type:"success"}),f()})},x=l=>{$e(l).then(()=>{Y("删除成功",{type:"success"}),f()})};function f(){r.value=!0;const l=F(D({},ie(o.value)),{pageSize:n.pageSize,currentPage:n.currentPage});l.created_at&&(l.created_at=Se(l.created_at)),De(l).then(({data:_})=>{a.value=_.items,n.total=_.total,n.pageSize=_.pageSize,n.currentPage=_.currentPage,ue(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{r.value=!1})}return{loading:r,search:o,dataList:a,pagination:n,handleSizeChange:y,handleCurrentChange:i,onSearch:f,onReset:()=>{f()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:g,updateId:b,handleStore:p,handleDestroy:C,handleBatchDestroy:x}}const qe=e=>{const o=ce(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/姓名/邮箱/手机号"},onChange:()=>{o()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"名字",prop:"first_name",valueType:"input",fieldProps:{placeholder:"请输入名字"}},{label:"姓氏",prop:"last_name",valueType:"input",fieldProps:{placeholder:"请输入姓氏"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"电话",prop:"phone",valueType:"input",fieldProps:{placeholder:"请输入电话",type:"number"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:we()}}]}},Oe=e=>{const o=m(!1),a=m(),r=m(0),n=m({}),y=[{label:"用户",prop:"user_id",valueType:"select",renderField:(d,u)=>c(Re,{modelValue:d,uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",onChange:u,refreshKey:r.value},null)},{label:"姓氏",prop:"last_name",valueType:"input",fieldProps:{placeholder:"请输入姓氏"}},{label:"名字",prop:"first_name",valueType:"input",fieldProps:{placeholder:"请输入名字"}},{label:"身份证号",prop:"identification_number",valueType:"input",fieldProps:{placeholder:"请输入身份证号"}},{label:"职位",prop:"title",valueType:"input",fieldProps:{placeholder:"请输入职位"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"电话",prop:"phone",valueType:"input",fieldProps:{placeholder:"请输入电话",type:"number"}}],i={user_id:[{required:!0,message:"请选择用户"},{type:"number",min:1,message:"用户ID必须大于0"}],last_name:[{required:!0,message:"请输入姓氏"},{max:50,message:"姓氏长度不能超过50个字符",trigger:"blur"}],first_name:[{required:!0,message:"请输入名字"},{max:50,message:"名字长度不能超过50个字符",trigger:"blur"}],identification_number:[{pattern:/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/,message:"请输入正确的身份证号",trigger:"blur"}],title:[{required:!0,message:"请输入职位"},{max:20,message:"职位长度不能超过50个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入电话"},{pattern:/^[0-9]{1,15}$/,message:"请输入正确的格式",trigger:"blur"}]};function g(d=0){var u,l;o.value=!0,d>0?r.value!==d&&C(d):((l=(u=a.value)==null?void 0:u.formInstance)==null||l.resetFields(),n.value=Object.fromEntries(Object.entries(A).filter(([_,w])=>w!==0&&w!==""))),r.value=d}function b(){r.value>0?f():x()}function p(){o.value=!1}const C=d=>{Ie(d).then(u=>{n.value=xe(u.data,Fe)})},x=()=>{Ve(n.value).then(()=>{e(),o.value=!1})},f=()=>{Be(r.value,n.value).then(()=>{e(),o.value=!1})};return{storeRef:a,showStore:o,storeId:r,storeValues:n,storeColumns:y,rules:i,openStoreForm:g,confirmStoreForm:b,closeStoreForm:p}},We=()=>{const e=m(),o=m([]),a=i=>{o.value=i.map(g=>g.id),e.value.setAdaptive()},r=()=>{var i;(i=e.value)==null||i.getTableRef().clearSelection()},n=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:80},{label:"用户名",prop:"user.username",minWidth:120,cellRenderer:pe("user.username")},{label:"姓",prop:"last_name",minWidth:120},{label:"名",prop:"first_name",minWidth:120},{label:"职位",prop:"title",minWidth:120},{label:"邮箱",prop:"email",minWidth:180},{label:"手机号",prop:"phone",minWidth:120},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:i})=>i?de(i).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}];return{tableRef:e,selectedIds:o,handleSelectionChange:a,handleSelectionCancel:r,tableColumns:n,handleRowClick:(i,g,b)=>{var C;const p=b.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(C=e.value)==null||C.getTableRef().toggleRowSelection(i)}}},Ae={class:"main"},Ee={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ne={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ue={class:"flex-auto"},je={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Ke=me({name:"Contact",__name:"index",setup(e){const{drawerSize:o}=ke(),{tableRef:a,selectedIds:r,handleSelectionChange:n,handleSelectionCancel:y,tableColumns:i,handleRowClick:g}=We(),{loading:b,search:p,dataList:C,pagination:x,handleSizeChange:f,handleCurrentChange:d,onSearch:u,onReset:l,onCollapse:_,handleDestroy:w,handleBatchDestroy:E}=Ye(a),{searchColumns:N}=qe(()=>u()),{storeRef:U,showStore:j,storeId:K,storeColumns:L,rules:H,storeValues:T,openStoreForm:B,confirmStoreForm:X,closeStoreForm:G}=Oe(()=>u());return fe(()=>{u()}),(Le,s)=>{const P=R("el-button"),J=R("el-tooltip"),I=R("el-popconfirm"),Q=R("pure-table"),Z=he("motion-fade");return O(),q("div",Ae,[V("div",Ee,[c(t(Pe),{modelValue:t(p),"onUpdate:modelValue":s[0]||(s[0]=v=>W(p)?p.value=v:null),columns:t(N),"show-number":1,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(u),onReset:t(l),onCollapse:t(_)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),c(t(_e),{title:"联系人管理",columns:t(i),onRefresh:t(u)},{buttons:h(()=>[c(P,{type:"primary",onClick:s[1]||(s[1]=v=>t(B)())},{default:h(()=>[...s[4]||(s[4]=[k(" 新增联系人 ",-1)])]),_:1})]),default:h(({size:v,dynamicColumns:ee})=>[t(r).length>0?ge((O(),q("div",Ne,[V("div",Ue,[c(J,{placement:"top",content:"取消选择"},{default:h(()=>[c(P,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(ve)(t(Te)),onClick:t(y)},null,8,["icon","onClick"])]),_:1}),V("span",je," 已选 "+Ce(t(r).length)+" 项 ",1)]),c(I,{title:"确定要删除吗？",width:"160px",onConfirm:s[2]||(s[2]=z=>t(E)(t(r)))},{reference:h(()=>[c(P,{type:"danger",size:"small"},{default:h(()=>[...s[5]||(s[5]=[k(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[Z]]):be("",!0),c(Q,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(b),size:v,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(C),columns:ee,pagination:F(D({},t(x)),{size:v}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(g),onSelectionChange:t(n),onPageSizeChange:t(f),onPageCurrentChange:t(d)},{operation:h(({row:z})=>[c(P,{class:"reset-margin !outline-none",type:"primary",link:"",size:v,onClick:te=>t(B)(z.id)},{default:h(()=>[...s[6]||(s[6]=[k(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),c(I,{title:"确定要删除吗？",width:"160px",onConfirm:te=>t(w)(z.id)},{reference:h(()=>[c(P,{class:"reset-margin !outline-none",link:"",type:"danger",size:v},{default:h(()=>[...s[7]||(s[7]=[k(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(t(ze),{ref_key:"storeRef",ref:U,modelValue:t(T),"onUpdate:modelValue":s[3]||(s[3]=v=>W(T)?T.value=v:null),visible:t(j),form:{columns:t(L),rules:t(H),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:t(K)>0?"编辑联系人":"新增联系人",confirmText:"提交",cancelText:"取消",onConfirm:t(X),onCancel:t(G)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),lt=ye(Ke,[["__scopeId","data-v-7f8e8673"]]);export{lt as default};
