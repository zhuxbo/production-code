var oe=Object.defineProperty,re=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var Y=(a,l,o)=>l in a?oe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,D=(a,l)=>{for(var o in l||(l={}))se.call(l,o)&&Y(a,o,l[o]);if(M)for(var o of M(l))ie.call(l,o)&&Y(a,o,l[o]);return a},B=(a,l)=>re(a,ne(l));import{r as h,l as ue,cg as ce,m as k,ch as pe,ci as de,t as me,S as fe,n as he,p as ge,j as c,cj as ve,q as be,ck as Ce,cl as ye,bd as _e,cm as Se,M as Pe,v as U,f as x,e as Fe,T as ke,o as we,x as xe,g as W,i as I,y as V,u as e,k as $,w as f,z as Re,A as Te,B as ze,C as De,D as w,P as Be,_ as Ve}from"./index-2C-ofHV5.js";import{c as qe,p as Ee}from"./utils-C-gUDCcE.js";import{P as Ae}from"./plus-search-B1FvdIYy.js";import{g as Me}from"./datePicker-ZEs-rmon.js";import{_ as T}from"./index.vue_vue_type_script_setup_true_lang-BHKqx4-E.js";import{u as Ye}from"./drawer-BlMYOobw.js";import{C as Ue}from"./close-bold-Dru7IMTV.js";import{P as We}from"./index-DtDmFput.js";import"./index-CaJyLCRQ.js";function Ie(a){const l=h({}),o=h([]),i=h(!0),t=ue({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function _(r){t.pageSize=r,s()}function n(r){t.currentPage=r,s()}const p=h(!1),v=h(0),b=r=>{p.value=!0,r?v.value=r:v.value=0},d=r=>{de(r).then(()=>{k("删除成功",{type:"success"}),s()})},P=r=>{pe(r).then(()=>{k("删除成功",{type:"success"}),s()})},F=r=>{ce(r).then(({data:C})=>{C.direct_login_url?(window.open(C.direct_login_url,"_blank"),k("正在跳转到会员中心...",{type:"success"})):k("获取登录链接失败",{type:"error"})}).catch(()=>{k("直接登录失败",{type:"error"})})};function s(){i.value=!0;const r=B(D({},me(l.value)),{pageSize:t.pageSize,currentPage:t.currentPage});r.created_at&&(r.created_at=qe(r.created_at)),fe(r).then(({data:C})=>{o.value=C.items,t.total=C.total,t.pageSize=C.pageSize,t.currentPage=C.currentPage,he(()=>{a.value&&a.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:l,dataList:o,pagination:t,handleSizeChange:_,handleCurrentChange:n,onSearch:s,onReset:()=>{s()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:p,updateId:v,handleStore:b,handleDestroy:d,handleBatchDestroy:P,handleDirectLogin:F}}const $e=a=>{const l=ge(()=>{a()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/邮箱/手机号"},onChange:()=>{l()}},{label:"状态",prop:"status",valueType:"select",options:[{label:"正常",value:"1"},{label:"禁用",value:"0"}],fieldProps:{placeholder:"请选择状态"},onChange:()=>{l()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"级别",prop:"level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(i,t)=>c(T,{modelValue:i,uri:"/user-level",queryParams:{custom:0},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择级别",onChange:t},null)},{label:"定制级别",prop:"custom_level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(i,t)=>c(T,{modelValue:i,uri:"/user-level",queryParams:{custom:1},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择定制级别",onChange:t},null)},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Me()}}]}},Oe=a=>{const l=h(!1),o=h(),i=h(0),t=h({username:"",level_code:"",status:1}),_=[{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"密码",prop:"password",valueType:"input",fieldProps:{placeholder:"不修改密码请留空",type:"password"},get rules(){return be(()=>[{required:i.value===0,message:"请输入密码",trigger:"blur"},{min:6,max:32,message:"密码长度在 6 到 32 个字符",trigger:"blur"}]).value}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"手机号",prop:"mobile",valueType:"input",fieldProps:{placeholder:"请输入手机号",type:"number"}},{label:"级别",prop:"level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(s,m)=>c(T,{modelValue:s,uri:"/user-level",queryParams:{custom:0},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择级别",onChange:m},null)},{label:"定制级别",prop:"custom_level_code",valueType:"select",fieldProps:{clearable:!0},renderField:(s,m)=>c(T,{modelValue:s,uri:"/user-level",queryParams:{custom:1},searchField:"quickSearch",labelField:"name",valueField:"code",itemsField:"items",totalField:"total",placeholder:"请选择定制级别",onChange:m},null)},{label:"信用额度",prop:"credit_limit",valueType:"input-number",fieldProps:{placeholder:"请输入信用额度",precision:2}},{label:"状态",prop:"status",valueType:"switch",fieldProps:{activeValue:1,inactiveValue:0}}],n={username:[{required:!0,message:"请输入用户名"},{min:2,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],level_code:[{required:!0,message:"请选择级别"}],status:[{required:!0,message:"请选择状态"}]};function p(s=0){var m;l.value=!0,s>0?i.value!==s&&d(s):((m=o.value.formInstance)==null||m.resetFields(),t.value=Object.fromEntries(Object.entries(ve).filter(([y,r])=>r!==0&&r!==""))),i.value=s}function v(){i.value>0?F():P()}function b(){l.value=!1}const d=s=>{_e(s).then(({data:m})=>{t.value=Ee(m,Se)})},P=()=>{ye(t.value).then(()=>{a(),l.value=!1})},F=()=>{Ce(i.value,t.value).then(()=>{a(),l.value=!1})};return{storeRef:o,showStore:l,storeId:i,storeValues:t,storeColumns:_,rules:n,openStoreForm:p,confirmStoreForm:v,closeStoreForm:b}},Le=()=>{const a=h(),l=h([]),o=n=>{l.value=n.map(p=>p.id),a.value.setAdaptive()},i=()=>{var n;(n=a.value)==null||n.getTableRef().clearSelection()},t=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:90},{label:"用户名",prop:"username",minWidth:100,cellRenderer:Pe("username")},{label:"邮箱",prop:"email",minWidth:140},{label:"手机号",prop:"mobile",minWidth:100},{label:"级别",prop:"level.name",minWidth:100},{label:"定制级别",prop:"custom_level.name",minWidth:100},{label:"余额",prop:"balance",minWidth:100},{label:"信用额度",prop:"credit_limit",minWidth:100},{label:"最后登录",prop:"last_login_at",minWidth:150,formatter:({last_login_at:n})=>n?U(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"创建时间",prop:"created_at",minWidth:150,formatter:({created_at:n})=>n?U(n).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:n,props:p})=>c(x("el-tag"),{size:p.size,type:n.status===1?"success":"danger",effect:"plain"},{default:()=>[n.status===1?"正常":"禁用"]})},{label:"操作",fixed:"right",slot:"operation",width:160}];return{tableRef:a,selectedIds:l,handleSelectionChange:o,handleSelectionCancel:i,tableColumns:t,handleRowClick:(n,p,v)=>{var d;const b=v.target;b.tagName==="BUTTON"||b.closest("button")||b.closest(".el-button")||(d=a.value)==null||d.getTableRef().toggleRowSelection(n)}}},Ne={class:"main"},je={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},He={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ke={class:"flex-auto"},Ge={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Je=Fe({name:"User",__name:"index",setup(a){const{drawerSize:l}=Ye(),o=ke(),{tableRef:i,selectedIds:t,handleSelectionChange:_,handleSelectionCancel:n,tableColumns:p,handleRowClick:v}=Le(),{loading:b,search:d,dataList:P,pagination:F,handleSizeChange:s,handleCurrentChange:m,onSearch:y,onReset:r,onCollapse:C,handleDestroy:O,handleBatchDestroy:L,handleDirectLogin:N}=Ie(i),{searchColumns:j}=$e(()=>y()),{storeRef:H,showStore:K,storeId:G,storeColumns:J,rules:Q,storeValues:z,openStoreForm:q,confirmStoreForm:X,closeStoreForm:Z}=Oe(()=>y());return we(()=>{o.query.username&&(d.value.username=o.query.username),y()}),(Qe,u)=>{const S=x("el-button"),ee=x("el-tooltip"),E=x("el-popconfirm"),le=x("pure-table"),te=xe("motion-fade");return I(),W("div",Ne,[V("div",je,[c(e(Ae),{modelValue:e(d),"onUpdate:modelValue":u[0]||(u[0]=g=>$(d)?d.value=g:null),columns:e(j),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:e(y),onReset:e(r),onCollapse:e(C)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),c(e(Be),{title:"用户管理",columns:e(p),onRefresh:e(y)},{buttons:f(()=>[c(S,{type:"primary",onClick:u[1]||(u[1]=g=>e(q)())},{default:f(()=>[...u[4]||(u[4]=[w("新增用户",-1)])]),_:1})]),default:f(({size:g,dynamicColumns:ae})=>[e(t).length>0?Re((I(),W("div",He,[V("div",Ke,[c(ee,{placement:"top",content:"取消选择"},{default:f(()=>[c(S,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:e(ze)(e(Ue)),onClick:e(n)},null,8,["icon","onClick"])]),_:1}),V("span",Ge," 已选 "+De(e(t).length)+" 项 ",1)]),c(E,{title:"确定要删除吗？",width:"160px",onConfirm:u[2]||(u[2]=R=>e(L)(e(t)))},{reference:f(()=>[c(S,{type:"danger",size:"small"},{default:f(()=>[...u[5]||(u[5]=[w(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[te]]):Te("",!0),c(le,{ref_key:"tableRef",ref:i,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(b),size:g,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(P),columns:ae,pagination:B(D({},e(F)),{size:g}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:e(v),onSelectionChange:e(_),onPageSizeChange:e(s),onPageCurrentChange:e(m)},{operation:f(({row:R})=>[c(S,{class:"reset-margin !outline-none",type:"success",link:"",size:g,onClick:A=>e(N)(R.id)},{default:f(()=>[...u[6]||(u[6]=[w(" 登录 ",-1)])]),_:1},8,["size","onClick"]),c(S,{class:"reset-margin !outline-none",type:"primary",link:"",size:g,onClick:A=>e(q)(R.id)},{default:f(()=>[...u[7]||(u[7]=[w(" 编辑 ",-1)])]),_:1},8,["size","onClick"]),c(E,{title:"确定要删除吗？",width:"160px",onConfirm:A=>e(O)(R.id)},{reference:f(()=>[c(S,{class:"reset-margin !outline-none",link:"",type:"danger",size:g},{default:f(()=>[...u[8]||(u[8]=[w(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(e(We),{ref_key:"storeRef",ref:H,modelValue:e(z),"onUpdate:modelValue":u[3]||(u[3]=g=>$(z)?z.value=g:null),visible:e(K),form:{columns:e(J),rules:e(Q),labelPosition:"right",labelSuffix:""},size:e(l),closeOnClickModal:!0,title:e(G)>0?"编辑用户":"新增用户",confirmText:"提交",cancelText:"取消",onConfirm:e(X),onCancel:e(Z)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),il=Ve(Je,[["__scopeId","data-v-803344ca"]]);export{il as default};
