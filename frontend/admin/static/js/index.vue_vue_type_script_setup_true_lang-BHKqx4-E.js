var H=Object.defineProperty;var z=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var B=(u,r,t)=>r in u?H(u,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[r]=t,A=(u,r)=>{for(var t in r||(r={}))I.call(r,t)&&B(u,t,r[t]);if(z)for(var t of z(r))N.call(r,t)&&B(u,t,r[t]);return u};var w=(u,r,t)=>new Promise((a,g)=>{var s=i=>{try{c(t.next(i))}catch(p){g(p)}},v=i=>{try{c(t.throw(i))}catch(p){g(p)}},c=i=>i.done?a(i.value):Promise.resolve(i.value).then(s,v);c((t=t.apply(u,r)).next())});import{e as Q,r as m,q as J,F as _,o as T,K as $,f as P,G as M,i as C,aV as W,w as j,j as X,g as Y,H as Z,I as ee,aG as ae}from"./index-2C-ofHV5.js";const ue=Q({__name:"index",props:{modelValue:{},uri:{},searchField:{default:"keyword"},labelField:{default:"name"},valueField:{default:"id"},placeholder:{default:"请选择"},pageSize:{default:7},showPagination:{type:Boolean,default:!0},queryParams:{default:()=>({})},itemsField:{default:"items"},totalField:{default:"total"},refreshKey:{},multiple:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(u,{expose:r,emit:t}){const a=u,g=t,s=m([]),v=m(!1),c=m(1),i=m(a.pageSize),p=m(0),y=m(""),D=m(a.refreshKey),h=m(!0),V=m(!0),G=J(()=>Math.ceil(p.value/i.value));_(()=>a.refreshKey,(e,l)=>{e!==l&&l!==void 0&&(c.value=1,y.value="",h.value=!0,F()),D.value=e},{immediate:!0}),_(()=>a.modelValue,e=>{e&&!K(e)&&x()&&O(e)},{immediate:!0});function x(){return a.refreshKey===void 0||a.refreshKey===null?!0:typeof a.refreshKey=="number"?a.refreshKey>0:a.refreshKey!==""}function K(e){return e?Array.isArray(e)?e.every(l=>s.value.some(n=>n.value===l)):s.value.some(l=>l.value===e):!0}T(()=>w(null,null,function*(){a.modelValue&&x()&&(yield O(a.modelValue))}));function O(e){return w(this,null,function*(){if(e&&!K(e))try{v.value=!0;let l="",n={};if(Array.isArray(e)){const f=e.filter(d=>!s.value.some(b=>b.value===d));if(f.length===0)return;a.valueField==="id"?(l=`${a.uri}/batch`,n={ids:f}):(l=`${a.uri}`,n={[a.valueField]:f.join(",")})}else a.valueField==="id"?l=`${a.uri}/${e}`:(l=`${a.uri}`,n={[a.valueField]:e});const o=yield $.get(l,{params:n});if(o.data){const d=(Array.isArray(o.data.items)?o.data.items:Array.isArray(o.data)?o.data:[o.data]).map(b=>({label:b[a.labelField],value:b[a.valueField]}));s.value=k(s.value,d)}}finally{v.value=!1}})}function k(e,l){const n=[...e];for(const o of l)n.some(d=>d.value===o.value)||n.push(o);return n}function L(e){g("update:modelValue",e),g("change",e)}function R(){V.value&&(V.value=!1,h.value=!0,F())}function U(e){e&&V.value&&(V.value=!1,h.value=!0,F())}function F(){return w(this,arguments,function*(e={}){if(!(v.value||!h.value))try{v.value=!0;const l=yield $.get(a.uri,{params:A(A({currentPage:c.value,pageSize:i.value},a.queryParams),e)});if(l.data){const n=(l.data[a.itemsField]||[]).map(f=>({label:f[a.labelField],value:f[a.valueField]})),o=S();s.value=k(o,n),p.value=l.data[a.totalField]||0}h.value=!1}finally{v.value=!1}})}function S(){if(!a.modelValue)return[];const e=Array.isArray(a.modelValue)?a.modelValue:[a.modelValue];return s.value.filter(l=>e.includes(l.value))}r({getSelectedOptions:S,options:s});function q(e){if(y.value===""&&e==="")return;y.value=e,c.value=1,h.value=!0;const l={};l[a.searchField]=e,F(l)}function E(e){c.value=e,h.value=!0;const l={};y.value&&(l[a.searchField]=y.value),F(l)}return(e,l)=>{const n=P("el-option"),o=P("el-pagination"),f=P("el-select");return C(),M(f,ae({"model-value":u.modelValue,placeholder:u.placeholder,filterable:"",remote:"","reserve-keyword":"","remote-show-suffix":"","remote-method":q,loading:v.value,multiple:u.multiple},e.$attrs,{"onUpdate:modelValue":L,onVisibleChange:U,onFocus:R}),W({default:j(()=>[(C(!0),Y(Z,null,ee(s.value,d=>(C(),M(n,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},[u.showPagination&&G.value>1?{name:"footer",fn:j(()=>[X(o,{"current-page":c.value,"onUpdate:currentPage":l[0]||(l[0]=d=>c.value=d),"page-size":i.value,"pager-count":5,total:p.value,layout:"total, prev, pager, next",onCurrentChange:E},null,8,["current-page","page-size","total"])]),key:"0"}:void 0]),1040,["model-value","placeholder","loading","multiple"])}}});export{ue as _};
