var w=Object.defineProperty,z=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var y=(a,t,o)=>t in a?w(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,g=(a,t)=>{for(var o in t||(t={}))k.call(t,o)&&y(a,o,t[o]);if(_)for(var o of _(t))T.call(t,o)&&y(a,o,t[o]);return a},b=(a,t)=>z(a,D(t));import{K as I,r as f,l as L,t as Y,p as M,j as u,f as h,D as V,E as B,M as N,v as U,e as E,o as F,g as j,i as q,y as H,u as l,k as O,w as W,P as A,_ as K}from"./index-2C-ofHV5.js";import{c as $}from"./utils-C-gUDCcE.js";import{P as G}from"./plus-search-B1FvdIYy.js";import{g as J}from"./datePicker-ZEs-rmon.js";import"./index-CaJyLCRQ.js";function Q(a){return I.get("/invoice-limit",{params:a})}function X(){const a=f({}),t=f([]),o=f(!0),e=L({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function i(n){e.pageSize=n,s()}function c(n){e.currentPage=n,s()}function s(){o.value=!0;const n=b(g({},Y(a.value)),{pageSize:e.pageSize,currentPage:e.currentPage});n.created_at&&(n.created_at=$(n.created_at)),Q(n).then(({data:p})=>{t.value=p.items,e.total=p.total,e.pageSize=p.pageSize,e.currentPage=p.currentPage}).finally(()=>{o.value=!1})}return{loading:o,search:a,dataList:t,pagination:e,handleSizeChange:i,handleCurrentChange:c,onSearch:s,onReset:()=>{s()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const S=[{label:"开票",value:"issue"},{label:"作废",value:"void"},{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"}],Z={issue:"success",void:"danger",addfunds:"primary",refunds:"warning"};function ee(a){const t=M(()=>{a()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"限额ID/用户名"},onChange:()=>{t()}},{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型"},options:S,onChange:()=>{t()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"限额ID",prop:"limit_id",valueType:"input",fieldProps:{placeholder:"请输入限额ID"}},{label:"金额",prop:"amount",renderField:(e,i)=>{var s,d;const c=(r,n)=>{r!==void 0&&n!==void 0&&r>n||i([r,n])};return u("div",{class:"flex items-center gap-2 w-full"},[u(h("el-input"),{class:"flex-1",modelValue:(s=e==null?void 0:e[0])==null?void 0:s.toString(),"onUpdate:modelValue":r=>{const n=r===""?void 0:Number(r);c(n,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),u("span",{class:"flex-none"},[V("至")]),u(h("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[1])==null?void 0:d.toString(),"onUpdate:modelValue":r=>{const n=r===""?void 0:Number(r);c(e==null?void 0:e[0],n)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:J()}}]}}function te(){const a=f(),t=B(),o=[{label:"用户名",prop:"user.username",minWidth:100,cellRenderer:N("user.username")},{label:"限额ID",prop:"limit_id",minWidth:100,cellRenderer:({row:e})=>u("span",{class:"cursor-pointer",onClick:()=>{t.push({path:["addfunds","refunds"].includes(e.type)?"/funds":"/invoice",query:{id:e.limit_id}})}},[e.limit_id])},{label:"类型",prop:"type",width:100,cellRenderer:({row:e,props:i})=>u(h("el-tag"),{size:i.size,type:Z[e.type],effect:"plain"},{default:()=>{var c;return[(c=S.find(s=>s.value===e.type))==null?void 0:c.label]}})},{label:"金额",prop:"amount",width:100},{label:"操作前",prop:"limit_before",width:100},{label:"操作后",prop:"limit_after",width:100},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?U(e).format("YYYY-MM-DD HH:mm:ss"):"-"}];return{tableRef:a,tableColumns:o}}const ne={class:"main"},ae={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=E({name:"InvoiceLimit",__name:"index",setup(a){const{tableRef:t,tableColumns:o}=te(),{loading:e,search:i,dataList:c,pagination:s,handleSizeChange:d,handleCurrentChange:r,onSearch:n,onReset:p,onCollapse:P}=X(),{searchColumns:v}=ee(()=>n());return F(()=>{n()}),(le,C)=>{const x=h("pure-table");return q(),j("div",ne,[H("div",ae,[u(l(G),{modelValue:l(i),"onUpdate:modelValue":C[0]||(C[0]=m=>O(i)?i.value=m:null),columns:l(v),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:l(n),onReset:l(p),onCollapse:l(P)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),u(l(A),{title:"发票额度",columns:l(o),onRefresh:l(n)},{default:W(({size:m,dynamicColumns:R})=>[u(x,{ref_key:"tableRef",ref:t,"row-key":"id","align-whole":"left","table-layout":"auto",loading:l(e),size:m,adaptive:"",adaptiveConfig:{offsetBottom:108},data:l(c),columns:R,pagination:b(g({},l(s)),{size:m}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:l(d),onPageCurrentChange:l(r)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),de=K(oe,[["__scopeId","data-v-f595bdbe"]]);export{de as default};
