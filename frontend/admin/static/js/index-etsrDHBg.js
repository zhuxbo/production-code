var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var se=(_,y,v)=>y in _?me(_,y,{enumerable:!0,configurable:!0,writable:!0,value:v}):_[y]=v,L=(_,y)=>{for(var v in y||(y={}))ve.call(y,v)&&se(_,v,y[v]);if(le)for(var v of le(y))be.call(y,v)&&se(_,v,y[v]);return _},G=(_,y)=>fe(_,ge(y));var J=(_,y,v)=>new Promise((d,h)=>{var c=t=>{try{g(v.next(t))}catch(S){h(S)}},m=t=>{try{g(v.throw(t))}catch(S){h(S)}},g=t=>t.done?d(t.value):Promise.resolve(t.value).then(c,m);g((v=v.apply(_,y)).next())});import{P as ye,a as he}from"./plus-search-CXVUhiZd.js";import{i as _e,u as re,p as Ce,d as ie,r as Se,s as ke,c as Re,a as we,b as ze,e as Ve,f as Pe,g as $e,h as Te,j as xe,k as De,l as Ie,m as Ue,n as Fe,O as Oe}from"./detail-SsnRMBle.js";import{c as ne}from"./utils-CxrrWYbC.js";import{r as F,l as X,t as Ae,n as qe,p as Be,f as i,h as P,A as V,I as Ne,aM as Ee,s as Y,m as z,d as H,c as j,e as k,E as $,y as T,w as u,_ as Z,q as Ye,D as ue,i as p,G as Me,F as We,v as W,aN as je,o as He,M as Le,a7 as Ge,j as Je,x as Ke,z as Qe,B as Xe}from"./index-DCZMYJHA.js";import{g as ae}from"./datePicker-WHgduTab.js";import{g as Ze,h as et,i as tt,s as lt,A as st,j as oe,c as nt,d as at,a as ot,b as rt,e as it,f as ut}from"./dictionary-Ba-0oiyK.js";import{p as Q,a as dt}from"./dictionary-WAXYN_DV.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-p3szPhEz.js";import{s as pt}from"./product-Ck1GeDw5.js";import{u as ee}from"./dialog-B4C_kYsi.js";import{u as ct}from"./hooks-MU7UDT6Y.js";import{C as mt}from"./close-bold-CBYhAie_.js";import"./index-BpjGGhss.js";import"./epTheme-COmaAcfL.js";import"./isIP-CERt79Yl.js";function ft(_){const y=F({}),v=F([]),d=F(!0),h=X({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function c(f){h.pageSize=f,g()}function m(f){h.currentPage=f,g()}function g(){d.value=!0;const f=G(L({},Ae(y.value)),{pageSize:h.pageSize,currentPage:h.currentPage});f.created_at&&(f.created_at=ne(f.created_at)),f.expires_at&&(f.expires_at=ne(f.expires_at)),_e(f).then(({data:l})=>{v.value=l.items,h.total=l.total,h.pageSize=l.pageSize,h.currentPage=l.currentPage,qe(()=>{_.value&&_.value.getTableRef().clearSelection()})}).finally(()=>{d.value=!1})}return{loading:d,search:y,dataList:v,pagination:h,handleSizeChange:c,handleCurrentChange:m,onSearch:g,onReset:()=>{g()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}function gt(_,y){const v=Be(()=>{_()},500),d=m=>m==="all"?lt:m==="archived"?st:oe,h=F(oe);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"用户名/域名/产品/订单号/备注"},onChange:()=>{v()}},{label:"状态集",prop:"statusSet",valueType:"select",fieldProps:{placeholder:"活动中"},options:Ze,onChange:m=>{y.value.status=void 0,h.value=d(m),v()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},get options(){return h.value},onChange:()=>{v()}},{label:"ID",prop:"id",valueType:"input",fieldProps:{placeholder:"请输入ID"}},{label:"周期",prop:"period",valueType:"select",fieldProps:{placeholder:"请选择周期"},options:Q},{label:"金额",prop:"amount",renderField:(m,g)=>{var S,f;const t=(l,w)=>{l!==void 0&&w!==void 0&&l>w||g([l,w])};return i("div",{class:"flex items-center gap-2 w-full"},[i(P("el-input"),{class:"flex-1",modelValue:(S=m==null?void 0:m[0])==null?void 0:S.toString(),"onUpdate:modelValue":l=>{const w=l===""?void 0:Number(l);t(w,m==null?void 0:m[1])},placeholder:"最小金额",clearable:!0},null),i("span",{class:"flex-none"},[V("至")]),i(P("el-input"),{class:"flex-1",modelValue:(f=m==null?void 0:m[1])==null?void 0:f.toString(),"onUpdate:modelValue":l=>{const w=l===""?void 0:Number(l);t(m==null?void 0:m[0],w)},placeholder:"最大金额",clearable:!0},null)])}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"产品名称",prop:"product_name",valueType:"input",fieldProps:{placeholder:"请输入产品名称"}},{label:"域名",prop:"domain",valueType:"input",fieldProps:{placeholder:"请输入域名"}},{label:"渠道",prop:"channel",valueType:"select",fieldProps:{placeholder:"请选择渠道"},options:et},{label:"操作",prop:"action",valueType:"select",fieldProps:{placeholder:"请选择操作"},options:tt},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ae()}},{label:"过期时间",prop:"expires_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ae()}}]}}function vt(){const _=F(),y=F([]),v=F([]),d=t=>{y.value=t.map(S=>S.id),v.value=t,_.value.setAdaptive()},h=()=>{y.value=[],_.value.getTableRef().clearSelection()},c=t=>{const S=t.latest_cert,f=S.common_name,l=S.dcv.dns.host,w=S.dcv.dns.type,s=S.dcv.dns.value,n=`域名：${f}
主机记录：${l}
解析类型：${w}
记录值：${s}`;navigator.clipboard.writeText(n).then(()=>{z("解析记录已复制到剪贴板",{type:"success"})})},m=[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",minWidth:120},{label:"用户名",prop:"user.username",minWidth:120,cellRenderer:Ne("user.username")},{label:"产品",prop:"product.name",minWidth:150},{label:"通用名称",prop:"latest_cert.common_name",minWidth:150,cellRenderer:({row:t})=>{var l,w,s,n,r,C;const S=(l=t.latest_cert)==null?void 0:l.common_name,f=["unpaid","pending","processing"].includes((w=t.latest_cert)==null?void 0:w.status)&&((n=(s=t.latest_cert)==null?void 0:s.dcv)==null?void 0:n.method)&&["cname","txt"].includes(t.latest_cert.dcv.method)&&((C=(r=t.latest_cert.dcv)==null?void 0:r.dns)==null?void 0:C.value);return i("div",{className:"flex items-center gap-1"},[i("span",null,[S||"-"]),f&&i(P("el-button"),{link:!0,size:"small",onClick:x=>{x.stopPropagation(),c(t)},className:"!p-0 !m-0 !mt-1 !bg-transparent !border-none !shadow-none align-middle text-gray-500 hover:text-blue-500"},{default:()=>[i(P("el-icon"),{size:"14"},{default:()=>[i(Ee,null,null)]})]})])}},{label:"有效期",prop:"period",minWidth:120,formatter:({period:t})=>dt[t]},{label:"金额",prop:"amount",minWidth:80},{label:"渠道",prop:"latest_cert.channel",minWidth:80,cellRenderer:({row:t})=>i(P("el-tag"),{type:at[t.latest_cert.channel]},{default:()=>[nt[t.latest_cert.channel]]})},{label:"操作",prop:"latest_cert.action",minWidth:80,cellRenderer:({row:t})=>i(P("el-tag"),{type:rt[t.latest_cert.action]},{default:()=>[ot[t.latest_cert.action]]})},{label:"状态",prop:"latest_cert.status",minWidth:80,cellRenderer:({row:t})=>i(P("el-tag"),{type:ut[t.latest_cert.status]||"info"},{default:()=>[it[t.latest_cert.status]]})},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:t})=>t?Y(t).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",width:140,slot:"operation"}];return{tableRef:_,selectedIds:y,selectedRows:v,tableColumns:m,handleSelectionChange:d,handleCancelSelection:h,handleRowClick:(t,S,f)=>{var w;const l=f.target;l.tagName==="BUTTON"||l.closest("button")||l.closest(".el-button")||(w=_.value)==null||w.getTableRef().toggleRowSelection(t)}}}const bt={class:"flex items-center gap-2"},yt=H({__name:"buttons",props:{row:{},size:{}},emits:["refresh"],setup(_,{emit:y}){const{toDetail:v}=re(),d=y,h=s=>{var n,r;return!s.created_at||["unpaid","pending"].includes((n=s.latest_cert)==null?void 0:n.status)?!0:["processing","approving","active"].includes((r=s.latest_cert)==null?void 0:r.status)&&Y().diff(Y(s.created_at),"seconds")<s.product.refund_period*86400},c=s=>{Ce(s.id).then(()=>{z("支付成功",{type:"success"}),d("refresh")})},m=s=>{ie(s.id)},g=s=>{v({ids:s.id},"params")},t=s=>{Se(s.id).then(()=>{z("开始验证，请等待几分钟后刷新页面查看结果",{type:"success"}),d("refresh")})},S=s=>{ke(s.id).then(()=>{z("同步成功",{type:"success"}),d("refresh")})},f=s=>{Re(s.id).then(()=>{z("提交成功",{type:"success"}),d("refresh")})},l=s=>{we(s.id).then(()=>{z("取消成功",{type:"success"}),d("refresh")})},w=s=>{ze(s.id).then(()=>{z("撤销取消成功",{type:"success"}),d("refresh")})};return(s,n)=>{var x,q,U,B,N,O;const r=P("el-button"),C=P("el-popconfirm");return k(),j("div",bt,[["unpaid"].includes((x=s.row.latest_cert)==null?void 0:x.status)?(k(),$(r,{key:0,class:"reset-margin !outline-none",type:"warning",link:"",size:s.size,onClick:n[0]||(n[0]=b=>c(s.row))},{default:u(()=>n[8]||(n[8]=[V(" 支付 ")])),_:1},8,["size"])):T("",!0),["active"].includes((q=s.row.latest_cert)==null?void 0:q.status)?(k(),$(r,{key:1,class:"reset-margin !outline-none",type:"success",link:"",size:s.size,onClick:n[1]||(n[1]=b=>m(s.row))},{default:u(()=>n[9]||(n[9]=[V(" 下载 ")])),_:1},8,["size"])):T("",!0),["pending"].includes((U=s.row.latest_cert)==null?void 0:U.status)?(k(),$(r,{key:2,class:"reset-margin !outline-none",type:"warning",link:"",size:s.size,onClick:n[2]||(n[2]=b=>f(s.row))},{default:u(()=>n[10]||(n[10]=[V(" 提交 ")])),_:1},8,["size"])):T("",!0),i(r,{class:"reset-margin !outline-none",type:"primary",link:"",size:s.size,onClick:n[3]||(n[3]=b=>g(s.row))},{default:u(()=>n[11]||(n[11]=[V(" 查看 ")])),_:1},8,["size"]),["processing"].includes((B=s.row.latest_cert)==null?void 0:B.status)?(k(),$(r,{key:3,class:"reset-margin !outline-none",type:"primary",link:"",size:s.size,onClick:n[4]||(n[4]=b=>t(s.row))},{default:u(()=>n[12]||(n[12]=[V(" 验证 ")])),_:1},8,["size"])):T("",!0),["processing","active","approving"].includes((N=s.row.latest_cert)==null?void 0:N.status)?(k(),$(r,{key:4,class:"reset-margin !outline-none",type:"primary",link:"",size:s.size,onClick:n[5]||(n[5]=b=>S(s.row))},{default:u(()=>n[13]||(n[13]=[V(" 同步 ")])),_:1},8,["size"])):T("",!0),h(s.row)?(k(),$(C,{key:5,title:"确定要取消吗？",width:"160px",onConfirm:n[6]||(n[6]=b=>l(s.row))},{reference:u(()=>[i(r,{class:"reset-margin !outline-none",type:"danger",link:"",size:s.size},{default:u(()=>n[14]||(n[14]=[V(" 取消 ")])),_:1},8,["size"])]),_:1})):T("",!0),["cancelling"].includes((O=s.row.latest_cert)==null?void 0:O.status)?(k(),$(r,{key:6,class:"reset-margin !outline-none",type:"warning",link:"",size:s.size,onClick:n[7]||(n[7]=b=>w(s.row))},{default:u(()=>n[15]||(n[15]=[V(" 撤销取消 ")])),_:1},8,["size"])):T("",!0)])}}}),ht=Z(yt,[["__scopeId","data-v-ee97ad8e"]]),_t={class:"batch-buttons"},Ct=H({__name:"batch",props:{selectedRows:{},tableRef:{}},emits:["refresh"],setup(_,{emit:y}){const{toDetail:v}=re(),d=_,h=y,c=()=>d.selectedRows||[],m=()=>c().map(a=>a.id),g=()=>c().some(a=>{var e;return((e=a.latest_cert)==null?void 0:e.status)==="active"}),t=()=>c().length>0,S=()=>c().some(a=>{var e,o,R;return["unpaid","pending","processing"].includes((e=a.latest_cert)==null?void 0:e.status)&&((R=(o=a.latest_cert)==null?void 0:o.dcv)==null?void 0:R.dns)}),f=()=>c().some(a=>{var e;return((e=a.latest_cert)==null?void 0:e.status)==="unpaid"}),l=()=>c().some(a=>{var e;return((e=a.latest_cert)==null?void 0:e.status)==="pending"}),w=()=>c().some(a=>{var e,o;return((e=a.latest_cert)==null?void 0:e.status)==="processing"&&((o=a.latest_cert)==null?void 0:o.domain_verify_status)!=2}),s=()=>c().some(a=>{var e;return["processing","active","approving"].includes((e=a.latest_cert)==null?void 0:e.status)}),n=()=>c().some(a=>{var e,o;return["unpaid","pending"].includes((e=a.latest_cert)==null?void 0:e.status)?!0:["processing","approving","active"].includes((o=a.latest_cert)==null?void 0:o.status)&&Y().diff(Y(a.created_at),"seconds")<a.product.refund_period*86400}),r=()=>c().some(a=>{var e;return((e=a.latest_cert)==null?void 0:e.status)==="cancelling"}),C=()=>{d.tableRef.clearSelection();const a=[];if(c().forEach(e=>{e.latest_cert.status=="active"&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个已签发证书",{type:"error"});return}ie(a.toString())},x=()=>{const a=m();v({ids:a.join(",")},"params")},q=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{var o;["unpaid","pending","processing"].includes(e.latest_cert.status)&&((o=e.latest_cert.dcv)!=null&&o.dns)&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个符合要求的证书 1.未签发 2.使用解析验证",{type:"error"});return}Ve(a).then(e=>{let o="";e.data.forEach(R=>{let D=R.latest_cert,A=D.validation[0];if(["unpaid","pending","processing"].includes(D.status)&&(A!=null&&A.host))if((()=>{const E=new Set;for(const I of D.validation)if(I.host){if(E.size>0&&!E.has(I.host))return!0;E.add(I.host)}return!1})())o+=A.domain+`此证书多个域名解析记录不同，跳过复制

`;else{let E=D.validation.length>2?" 此证书多个域名解析记录相同":"";o+="域名："+A.domain+E+`
主机记录：`+A.host+`
解析类型：`+A.method+`
记录值：`+A.value+`

`}}),navigator.clipboard.writeText(o).then(()=>{z("复制成功",{type:"success"})}).catch(()=>{z("复制失败",{type:"error"})})}).catch(()=>{z("复制失败",{type:"error"})})},U=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{e.latest_cert.status=="unpaid"&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个未支付的订单",{type:"error"});return}Pe(a).then(()=>{z("支付成功",{type:"success"}),h("refresh")})},B=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{e.latest_cert.status=="pending"&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个待提交的订单",{type:"error"});return}$e(a.toString()).then(()=>{z("提交成功",{type:"success"}),h("refresh")})},N=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{var o;e.latest_cert.status=="processing"&&((o=e.latest_cert)==null?void 0:o.domain_verify_status)!=2&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个符合要求的证书 1.状态是处理中 2.所有域名尚未完成验证",{type:"error"});return}Te(a.toString()).then(()=>{z("开始验证，请等待几分钟后刷新页面查看结果",{type:"success"}),h("refresh")})},O=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{["processing","active","approving"].includes(e.latest_cert.status)&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("请至少选择一个待验证，已签发，待审核证书",{type:"error"});return}xe(a.toString()).then(()=>{z("同步成功",{type:"success"}),h("refresh")})},b=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{(["unpaid","pending"].includes(e.latest_cert.status)||["processing","approving","active"].includes(e.latest_cert.status)&&Y().diff(Y(e.created_at),"seconds")<e.product.refund_period*86400)&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("只有待支付、待提交、待验证、待审核、已签发并在退款期限内的订单可以取消",{type:"error"});return}De(a.toString()).then(()=>{z("取消成功",{type:"success"}),h("refresh")})},M=()=>{const a=[];if(d.tableRef.clearSelection(),c().forEach(e=>{["cancelling"].includes(e.latest_cert.status)&&(a.push(e.id),d.tableRef.toggleRowSelection(e))}),!a.length){z("只有取消中的证书可以撤销",{type:"error"});return}Ie(a.toString()).then(()=>{z("撤销取消成功",{type:"success"}),h("refresh")})};return(a,e)=>{const o=P("el-button"),R=P("el-popconfirm");return k(),j("div",_t,[g()?(k(),$(o,{key:0,type:"primary",size:"small",class:"ml-2",onClick:e[0]||(e[0]=D=>C())},{default:u(()=>e[9]||(e[9]=[V(" 下载证书 ")])),_:1})):T("",!0),t()?(k(),$(o,{key:1,type:"primary",size:"small",class:"ml-2",onClick:e[1]||(e[1]=D=>x())},{default:u(()=>e[10]||(e[10]=[V(" 查看订单 ")])),_:1})):T("",!0),S()?(k(),$(o,{key:2,type:"primary",size:"small",class:"ml-2",onClick:e[2]||(e[2]=D=>q())},{default:u(()=>e[11]||(e[11]=[V(" 复制解析 ")])),_:1})):T("",!0),f()?(k(),$(o,{key:3,type:"primary",size:"small",class:"ml-2",onClick:e[3]||(e[3]=D=>U())},{default:u(()=>e[12]||(e[12]=[V(" 支付订单 ")])),_:1})):T("",!0),l()?(k(),$(o,{key:4,type:"primary",size:"small",class:"ml-2",onClick:e[4]||(e[4]=D=>B())},{default:u(()=>e[13]||(e[13]=[V(" 提交订单 ")])),_:1})):T("",!0),w()?(k(),$(o,{key:5,type:"primary",size:"small",class:"ml-2",onClick:e[5]||(e[5]=D=>N())},{default:u(()=>e[14]||(e[14]=[V(" 重新验证 ")])),_:1})):T("",!0),s()?(k(),$(o,{key:6,type:"primary",size:"small",class:"ml-2",onClick:e[6]||(e[6]=D=>O())},{default:u(()=>e[15]||(e[15]=[V(" 同步订单 ")])),_:1})):T("",!0),n()?(k(),$(R,{key:7,title:"确定要取消订单吗？",width:"160px",onConfirm:e[7]||(e[7]=D=>b())},{reference:u(()=>[i(o,{type:"danger",size:"small",class:"ml-2"},{default:u(()=>e[16]||(e[16]=[V(" 取消订单 ")])),_:1})]),_:1})):T("",!0),r()?(k(),$(o,{key:8,type:"warning",size:"small",class:"ml-2",onClick:e[8]||(e[8]=D=>M())},{default:u(()=>e[17]||(e[17]=[V(" 撤销取消 ")])),_:1})):T("",!0)])}}}),St=Z(Ct,[["__scopeId","data-v-271f6409"]]),kt={class:"dialog-footer"},Rt=H({__name:"input",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(_,{emit:y}){const v=_,d=y,{dialogSize:h}=ee(),c=F(),m=F(!1),g=F(null),t=X({user_id:"",product_id:"",period:12,api_id:"",action:"new",order_id:"",csr:"",private_key:"",common_name:""}),S=Ye(()=>{var n;return(n=g.value)!=null&&n.periods?Q.filter(r=>g.value.periods.includes(r.value)):Q.filter(r=>[12,24,36,48,60].includes(r.value))}),f=()=>{t.order_id=""},l=n=>J(null,null,function*(){if(!n){g.value=null,t.period=12;return}const r=yield pt(Number(n));r.code===1&&(g.value=r.data,g.value.periods&&g.value.periods.length>0&&(g.value.periods.includes(t.period)||(t.period=g.value.periods[0])))}),w=()=>J(null,null,function*(){if(c.value)try{yield c.value.validate(),m.value=!0;const n=G(L({},t),{channel:"admin"});yield Ue(n),z("导入成功",{type:"success"}),s(),d("success")}finally{m.value=!1}}),s=()=>{Object.assign(t,{user_id:"",product_id:"",period:12,api_id:"",action:"new",order_id:"",csr:"",private_key:"",common_name:""}),g.value=null,d("update:visible",!1)};return ue(()=>v.visible,n=>{var r;n||(r=c.value)==null||r.resetFields()}),(n,r)=>{const C=P("el-form-item"),x=P("el-option"),q=P("el-select"),U=P("el-input"),B=P("el-form"),N=P("el-button"),O=P("el-dialog");return k(),$(O,{"model-value":n.visible,title:"导入证书",width:p(h),"onUpdate:modelValue":r[9]||(r[9]=b=>n.$emit("update:visible",b))},{footer:u(()=>[W("span",kt,[i(N,{onClick:s},{default:u(()=>r[10]||(r[10]=[V("取消")])),_:1}),i(N,{type:"primary",loading:m.value,onClick:w},{default:u(()=>r[11]||(r[11]=[V("导入")])),_:1},8,["loading"])])]),default:u(()=>[i(B,{ref_key:"formRef",ref:c,model:t,"label-width":"100px",class:"ml-3 mr-3"},{default:u(()=>[i(C,{label:"用户",prop:"user_id",rules:[{required:!0,message:"请选择用户",trigger:"change"}]},{default:u(()=>[i(p(K),{modelValue:t.user_id,"onUpdate:modelValue":r[0]||(r[0]=b=>t.user_id=b),uri:"/user",searchField:"quickSearch",labelField:"username",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择用户",style:{width:"100%"},onChange:f},null,8,["modelValue"])]),_:1}),i(C,{label:"产品",prop:"product_id",rules:[{required:!0,message:"请选择产品",trigger:"change"}]},{default:u(()=>[i(p(K),{modelValue:t.product_id,"onUpdate:modelValue":r[1]||(r[1]=b=>t.product_id=b),uri:"/product",searchField:"quickSearch",labelField:"name",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择产品",style:{width:"100%"},onChange:l},null,8,["modelValue"])]),_:1}),i(C,{label:"有效期",prop:"period",rules:[{required:!0,message:"请选择有效期",trigger:"change"}]},{default:u(()=>[i(q,{modelValue:t.period,"onUpdate:modelValue":r[2]||(r[2]=b=>t.period=b),placeholder:"请选择有效期",style:{width:"100%"},disabled:!t.product_id},{default:u(()=>[(k(!0),j(We,null,Me(S.value,b=>(k(),$(x,{key:b.value,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),i(C,{label:"接口ID",prop:"api_id",rules:[{required:!0,message:"请输入接口ID",trigger:"blur"}]},{default:u(()=>[i(U,{modelValue:t.api_id,"onUpdate:modelValue":r[3]||(r[3]=b=>t.api_id=b),placeholder:"请输入CA接口返回的证书ID"},null,8,["modelValue"])]),_:1}),i(C,{label:"通用名",prop:"common_name",rules:[{required:!0,message:"请输入通用名",trigger:"blur"}]},{default:u(()=>[i(U,{modelValue:t.common_name,"onUpdate:modelValue":r[4]||(r[4]=b=>t.common_name=b),placeholder:"请输入证书的通用名（域名）"},null,8,["modelValue"])]),_:1}),i(C,{label:"操作类型",prop:"action",rules:[{required:!0,message:"请选择操作类型",trigger:"change"}]},{default:u(()=>[i(q,{modelValue:t.action,"onUpdate:modelValue":r[5]||(r[5]=b=>t.action=b),placeholder:"请选择操作类型",style:{width:"100%"}},{default:u(()=>[i(x,{label:"新购",value:"new"}),i(x,{label:"续费",value:"renew"}),i(x,{label:"重签",value:"reissue"})]),_:1},8,["modelValue"])]),_:1}),t.action==="reissue"?(k(),$(C,{key:0,label:"原订单ID",prop:"order_id",rules:[{required:!0,message:"请选择原订单",trigger:"change"}]},{default:u(()=>[(k(),$(p(K),{key:t.user_id,modelValue:t.order_id,"onUpdate:modelValue":r[6]||(r[6]=b=>t.order_id=b),uri:"/order",searchField:"id",labelField:"id",valueField:"id",itemsField:"items",totalField:"total",placeholder:"请选择原订单",style:{width:"100%"},clearable:!0,queryParams:{user_id:t.user_id},disabled:!t.user_id},null,8,["modelValue","queryParams","disabled"]))]),_:1})):T("",!0),i(C,{label:"CSR（可选）"},{default:u(()=>[i(U,{modelValue:t.csr,"onUpdate:modelValue":r[7]||(r[7]=b=>t.csr=b),type:"textarea",rows:4,placeholder:"请输入CSR内容（可选）"},null,8,["modelValue"])]),_:1}),i(C,{label:"私钥（可选）"},{default:u(()=>[i(U,{modelValue:t.private_key,"onUpdate:modelValue":r[8]||(r[8]=b=>t.private_key=b),type:"textarea",rows:4,placeholder:"请输入私钥内容（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","width"])}}}),wt={class:"dialog-footer"},zt=H({__name:"createUser",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(_,{emit:y}){const v=_,d=y,{dialogSize:h}=ee(),c=F(),m=F(!1),g=X({email:"",username:""}),t=()=>J(null,null,function*(){if(c.value)try{yield c.value.validate(),m.value=!0;const f={email:g.email,username:g.username||void 0};yield je(f),z("用户创建成功，登录信息已发送到邮箱",{type:"success"}),S(),d("success")}catch(f){console.error(f)}finally{m.value=!1}}),S=()=>{Object.assign(g,{email:"",username:""}),d("update:visible",!1)};return ue(()=>v.visible,f=>{var l;f||(l=c.value)==null||l.resetFields()}),(f,l)=>{const w=P("el-input"),s=P("el-form-item"),n=P("el-form"),r=P("el-button"),C=P("el-dialog");return k(),$(C,{"model-value":f.visible,title:"创建用户",width:p(h),"onUpdate:modelValue":l[2]||(l[2]=x=>f.$emit("update:visible",x))},{footer:u(()=>[W("span",wt,[i(r,{onClick:S},{default:u(()=>l[3]||(l[3]=[V("取消")])),_:1}),i(r,{type:"primary",loading:m.value,onClick:t},{default:u(()=>l[4]||(l[4]=[V("创建")])),_:1},8,["loading"])])]),default:u(()=>[i(n,{ref_key:"formRef",ref:c,model:g,"label-width":"100px"},{default:u(()=>[i(s,{label:"邮箱",prop:"email",rules:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],class:"ml-3 mr-3"},{default:u(()=>[i(w,{modelValue:g.email,"onUpdate:modelValue":l[0]||(l[0]=x=>g.email=x),placeholder:"请输入邮箱",autocomplete:"off"},null,8,["modelValue"])]),_:1}),i(s,{label:"用户名",prop:"username",rules:[{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],class:"ml-3 mr-3"},{default:u(()=>[i(w,{modelValue:g.username,"onUpdate:modelValue":l[1]||(l[1]=x=>g.username=x),placeholder:"不填写将自动生成",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","width"])}}}),Vt={class:"main"},Pt={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},$t={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Tt={class:"flex-auto"},xt={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Dt=H({name:"Order",__name:"index",setup(_){const{dialogSize:y}=ee(),v=Le(),{tableRef:d,selectedIds:h,selectedRows:c,tableColumns:m,handleSelectionChange:g,handleCancelSelection:t,handleRowClick:S}=vt(),{loading:f,search:l,dataList:w,pagination:s,handleSizeChange:n,handleCurrentChange:r,onSearch:C,onReset:x,onCollapse:q}=ft(d),{action:U,openAction:B}=Fe(),{searchColumns:N}=gt(C,l),O=F(!1),b=()=>{O.value=!0},M=F(!1),a=()=>{M.value=!0};let e=null;return He(()=>{const o=v.query;o.username&&(l.value.username=o.username),o.id&&(l.value.id=Number(o.id)),o.status&&(l.value.status=o.status),o.statusSet&&(l.value.statusSet=o.statusSet),o.domain&&(l.value.domain=o.domain),o.product_name&&(l.value.product_name=o.product_name),o.channel&&(l.value.channel=o.channel),o.action&&(l.value.action=o.action),o.expires_at&&Array.isArray(o.expires_at)&&(l.value.expires_at=o.expires_at),o.created_at&&Array.isArray(o.created_at)&&(l.value.created_at=o.created_at),o.amount&&Array.isArray(o.amount)&&(l.value.amount=o.amount.map(Number)),o.period&&(l.value.period=Number(o.period)),C(),e=setInterval(()=>{C()},3*60*1e3)}),Ge(()=>{e!==null&&(clearInterval(e),e=null)}),(o,R)=>{const D=P("el-button"),A=P("el-tooltip"),te=P("pure-table"),E=Xe("motion-fade");return k(),j("div",Vt,[W("div",Pt,[i(p(ye),{modelValue:p(l),"onUpdate:modelValue":R[0]||(R[0]=I=>Je(l)?l.value=I:null),columns:p(N),"show-number":3,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:p(C),onReset:p(x),onCollapse:p(q)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),i(p(he),{title:"订单管理",columns:p(m),onRefresh:p(C)},{buttons:u(()=>[i(D,{type:"primary",onClick:R[1]||(R[1]=I=>p(B)("apply"))},{default:u(()=>R[6]||(R[6]=[V("申请证书")])),_:1}),i(D,{type:"success",onClick:R[2]||(R[2]=I=>p(B)("batchApply"))},{default:u(()=>R[7]||(R[7]=[V("批量申请")])),_:1}),p(y)!=="90%"?(k(),$(D,{key:0,type:"info",onClick:b},{default:u(()=>R[8]||(R[8]=[V("导入证书")])),_:1})):T("",!0),p(y)!=="90%"?(k(),$(D,{key:1,type:"info",onClick:a},{default:u(()=>R[9]||(R[9]=[V("创建用户")])),_:1})):T("",!0)]),default:u(({size:I,dynamicColumns:de})=>[p(h).length>0?Ke((k(),j("div",$t,[W("div",Tt,[i(A,{placement:"top",content:"取消选择"},{default:u(()=>[i(D,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:p(ct)(p(mt)),onClick:p(t)},null,8,["icon","onClick"])]),_:1}),W("span",xt," 已选 "+Qe(p(h).length)+" 项 ",1)]),i(St,{selectedRows:p(c),tableRef:p(d).getTableRef(),onRefresh:p(C)},null,8,["selectedRows","tableRef","onRefresh"])])),[[E]]):T("",!0),i(te,{ref_key:"tableRef",ref:d,"row-key":"id","align-whole":"left","table-layout":"auto",loading:p(f),size:I,adaptive:"",adaptiveConfig:{offsetBottom:108},data:p(w),columns:de,pagination:G(L({},p(s)),{size:I}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:p(S),onSelectionChange:p(g),onPageSizeChange:p(n),onPageCurrentChange:p(r)},{operation:u(({row:pe,size:ce})=>[i(ht,{row:pe,size:ce,onRefresh:p(C)},null,8,["row","size","onRefresh"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),i(Oe,{visible:p(U).visible,"onUpdate:visible":R[3]||(R[3]=I=>p(U).visible=I),actionType:p(U).type,orderId:p(U).id,onSuccess:p(C)},null,8,["visible","actionType","orderId","onSuccess"]),i(Rt,{visible:O.value,"onUpdate:visible":R[4]||(R[4]=I=>O.value=I),onSuccess:p(C)},null,8,["visible","onSuccess"]),i(zt,{visible:M.value,"onUpdate:visible":R[5]||(R[5]=I=>M.value=I),onSuccess:p(C)},null,8,["visible","onSuccess"])])}}}),Jt=Z(Dt,[["__scopeId","data-v-c895e342"]]);export{Jt as default};
