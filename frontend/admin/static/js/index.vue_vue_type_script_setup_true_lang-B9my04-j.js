var G=Object.defineProperty;var S=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var B=(o,r,t)=>r in o?G(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,w=(o,r)=>{for(var t in r||(r={}))N.call(r,t)&&B(o,t,r[t]);if(S)for(var t of S(r))Q.call(r,t)&&B(o,t,r[t]);return o};var b=(o,r,t)=>new Promise((a,g)=>{var s=i=>{try{c(t.next(i))}catch(v){g(v)}},m=i=>{try{c(t.throw(i))}catch(v){g(v)}},c=i=>i.done?a(i.value):Promise.resolve(i.value).then(s,m);c((t=t.apply(o,r)).next())});import{d as T,r as p,q as H,D as $,o as I,k as x,E as D,e as A,aT as J,w as M,f as W,h as P,c as X,G as Y,F as Z,az as ee}from"./index-2hNLZh7L.js";const te=T({__name:"index",props:{modelValue:{},uri:{},searchField:{},labelField:{default:"name"},valueField:{default:"id"},placeholder:{default:"请选择"},pageSize:{default:7},showPagination:{type:Boolean,default:!0},queryParams:{default:()=>({})},itemsField:{default:"items"},totalField:{default:"total"},refreshKey:{},multiple:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(o,{expose:r,emit:t}){const a=o,g=t,s=p([]),m=p(!1),c=p(1),i=p(a.pageSize),v=p(0),y=p(""),E=p(a.refreshKey),h=p(!0),_=p(!0),L=H(()=>Math.ceil(v.value/i.value));$(()=>a.refreshKey,(e,l)=>{e!==l&&l!==void 0&&(c.value=1,y.value="",h.value=!0,F()),E.value=e},{immediate:!0}),$(()=>a.modelValue,e=>{e&&!O(e)&&C()&&k(e)},{immediate:!0});function C(){return a.refreshKey===void 0||a.refreshKey===null?!0:typeof a.refreshKey=="number"?a.refreshKey>0:a.refreshKey!==""}function O(e){return e?Array.isArray(e)?e.every(l=>s.value.some(u=>u.value===l)):s.value.some(l=>l.value===e):!0}I(()=>b(null,null,function*(){a.modelValue&&C()&&(yield k(a.modelValue))}));function k(e){return b(this,null,function*(){if(e&&!O(e))try{m.value=!0;let l="",u={};if(Array.isArray(e)){const f=e.filter(d=>!s.value.some(V=>V.value===d));if(f.length===0)return;a.valueField==="id"?(l=`${a.uri}/batch`,u={ids:f}):(l=`${a.uri}`,u={[a.valueField]:f.join(",")})}else a.valueField==="id"?l=`${a.uri}/${e}`:(l=`${a.uri}`,u={[a.valueField]:e});const n=yield x.get(l,{params:u});if(n.data){const d=(Array.isArray(n.data.items)?n.data.items:Array.isArray(n.data)?n.data:[n.data]).map(V=>({label:V[a.labelField],value:V[a.valueField]}));s.value=z(s.value,d)}}finally{m.value=!1}})}function z(e,l){const u=[...e];for(const n of l)u.some(d=>d.value===n.value)||u.push(n);return u}function R(e){g("update:modelValue",e),g("change",e)}function U(e){e&&_.value&&(_.value=!1,h.value=!0,F())}function F(){return b(this,arguments,function*(e={}){if(!(m.value||!h.value))try{m.value=!0;const l=yield x.get(a.uri,{params:w(w({currentPage:c.value,pageSize:i.value},a.queryParams),e)});if(l.data){const u=(l.data[a.itemsField]||[]).map(f=>({label:f[a.labelField],value:f[a.valueField]})),n=K();s.value=z(n,u),v.value=l.data[a.totalField]||0}h.value=!1}finally{m.value=!1}})}function K(){if(!a.modelValue)return[];const e=Array.isArray(a.modelValue)?a.modelValue:[a.modelValue];return s.value.filter(l=>e.includes(l.value))}r({getSelectedOptions:K,options:s});function j(e){if(y.value===""&&e==="")return;y.value=e,c.value=1,h.value=!0;const l={};l[a.searchField]=e,F(l)}function q(e){c.value=e,h.value=!0;const l={};y.value&&(l[a.searchField]=y.value),F(l)}return(e,l)=>{const u=P("el-option"),n=P("el-pagination"),f=P("el-select");return A(),D(f,ee({"model-value":e.modelValue,placeholder:e.placeholder,filterable:"",remote:"","reserve-keyword":"","remote-show-suffix":"","remote-method":j,loading:m.value,multiple:e.multiple},e.$attrs,{"onUpdate:modelValue":R,onVisibleChange:U}),J({default:M(()=>[(A(!0),X(Z,null,Y(s.value,d=>(A(),D(u,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},[e.showPagination&&L.value>1?{name:"footer",fn:M(()=>[W(n,{"current-page":c.value,"onUpdate:currentPage":l[0]||(l[0]=d=>c.value=d),"page-size":i.value,"pager-count":5,total:v.value,layout:"total, prev, pager, next",onCurrentChange:q},null,8,["current-page","page-size","total"])]),key:"0"}:void 0]),1040,["model-value","placeholder","loading","multiple"])}}});export{te as _};
