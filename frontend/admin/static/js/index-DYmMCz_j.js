var B=Object.defineProperty,M=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var k=(a,e,o)=>e in a?B(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,P=(a,e)=>{for(var o in e||(e={}))W.call(e,o)&&k(a,o,e[o]);if(D)for(var o of D(e))A.call(e,o)&&k(a,o,e[o]);return a},x=(a,e)=>M(a,U(e));import{e as L,r as b,f as p,g as R,i as C,j as n,w as u,u as l,H,I as N,G as F,v as Y,aO as O,l as j,o as E,t as $,m as w,aN as G,z as q,D as S,x as J,y as K,k as Q,B as X,P as Z,_ as ee}from"./index-2C-ofHV5.js";import{l as ae,P as te}from"./vue-json-pretty-CC0b4iVL.js";import{d as le,a as oe,I as ne,V as re}from"./view-5HzsZJHw.js";import{c as se}from"./utils-C-gUDCcE.js";import{P as ie}from"./plus-search-B1FvdIYy.js";import{g as pe}from"./datePicker-ZEs-rmon.js";import"./index-CaJyLCRQ.js";const ce=L({__name:"detail",props:{data:{type:Object,default:()=>({})}},setup(a){const e=a,o=[{label:"请求地址",prop:"url"},{label:"请求接口",prop:"api"},{label:"状态码",prop:"status_code"},{label:"状态",prop:"status",cellRenderer:()=>e.data.status===1?"成功":"失败"},{label:"请求耗时",prop:"duration"},{label:"请求时间",prop:"created_at",cellRenderer:()=>e.data.created_at?Y(e.data.created_at).format("YYYY-MM-DD HH:mm:ss"):"-"}],c=b([{title:"响应",name:"response",data:e.data.response},{title:"参数",name:"params",data:e.data.params}]);return(_,v)=>{const r=p("el-scrollbar"),m=p("el-tab-pane"),f=p("el-tabs");return C(),R("div",null,[n(r,null,{default:u(()=>[n(l(ae),{border:"",data:[a.data],columns:o,column:5},null,8,["data"])]),_:1}),n(f,{modelValue:c.value[0].name,type:"border-card",class:"mt-4"},{default:u(()=>[(C(!0),R(H,null,N(c.value,(d,g)=>(C(),F(m,{key:g,name:d.name,label:d.title},{default:u(()=>[n(r,{"max-height":"calc(100vh - 240px)"},{default:u(()=>[n(l(te),{data:d.data,"onUpdate:data":i=>d.data=i},null,8,["data","onUpdate:data"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])])}}});function de(){const a=b({}),e=b(),o=b([]),c=b(!0),{copied:_,update:v}=O(),r=j({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function m(t){r.pageSize=t,i()}function f(t){r.currentPage=t,i()}function d({url:t},{property:s}){s==="url"&&(v(t),_.value?w(`${t} 已拷贝`,{type:"success"}):w("拷贝失败",{type:"warning"}))}function g(t){oe("ca",t.id).then(s=>{G({title:"CA日志详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>ce,props:{data:s.data}})})}function i(){c.value=!0;const t=x(P({},$(a.value)),{pageSize:r.pageSize,currentPage:r.currentPage});t.created_at&&(t.created_at=se(t.created_at)),le(t).then(({data:s})=>{o.value=s.items,r.total=s.total,r.pageSize=s.pageSize,r.currentPage=s.currentPage}).finally(()=>{c.value=!1})}const y=()=>{i()},z=()=>{setTimeout(()=>{var t,s;window.dispatchEvent(new Event("resize")),(s=(t=e.value)==null?void 0:t.setAdaptive)==null||s.call(t)},500)};return E(()=>{i()}),{tableRef:e,form:a,loading:c,dataList:o,pagination:r,onSearch:i,onDetail:g,onResetSearch:y,onCollapse:z,handleSizeChange:m,handleCurrentChange:f,handleCellDblclick:d}}const ue=[{label:"请求API",prop:"api",valueType:"input",fieldProps:{placeholder:"请输入请求API"}},{label:"状态",prop:"status",valueType:"select",options:[{label:"成功",value:"1"},{label:"失败",value:"0"}],fieldProps:{placeholder:"请选择状态"}},{label:"状态码",prop:"status_code",valueType:"input",fieldProps:{placeholder:"请输入状态码"}},{label:"请求URL",prop:"url",valueType:"input",fieldProps:{placeholder:"请输入请求URL"}},{label:"参数",prop:"params",valueType:"input",fieldProps:{placeholder:"请输入参数"}},{label:"响应",prop:"response",valueType:"input",fieldProps:{placeholder:"请输入响应"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:pe()}}],me=[{label:"ID",prop:"id",minWidth:60},{headerRenderer:()=>n("div",{class:"flex flex-row items-center"},[n("span",null,[S("请求URL")]),q(n(p("iconifyIconOffline"),{icon:ne,class:"ml-1 cursor-help"},null),[[J("tippy"),{content:"双击下面请求URL进行拷贝"}]])]),prop:"url",minWidth:140},{label:"请求API",prop:"api",minWidth:140},{label:"状态码",prop:"status_code",minWidth:100,cellRenderer:({row:a,props:e})=>n(p("el-tag"),{size:e.size,type:a.status_code<400?"success":"danger",effect:"plain"},{default:()=>[a.status_code]})},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:a,props:e})=>n(p("el-tag"),{size:e.size,type:a.status===1?"success":"danger",effect:"plain"},{default:()=>[a.status===1?"成功":"失败"]})},{label:"请求耗时",prop:"duration",minWidth:100,cellRenderer:({row:a,props:e})=>n(p("el-tag"),{size:e.size,type:a.duration<1e3?"success":"warning",effect:"plain"},{default:()=>[a.duration,S(" ms")]})},{label:"请求时间",prop:"created_at",minWidth:180,formatter:({created_at:a})=>a?Y(a).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:80}],fe={class:"main"},ge={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[24px] overflow-auto"},he=L({name:"CaLogs",__name:"index",setup(a){const{tableRef:e,form:o,loading:c,dataList:_,pagination:v,onSearch:r,onDetail:m,onResetSearch:f,onCollapse:d,handleSizeChange:g,handleCurrentChange:i,handleCellDblclick:y}=de();return(z,t)=>{const s=p("el-button"),I=p("pure-table");return C(),R("div",fe,[K("div",ge,[n(l(ie),{modelValue:l(o),"onUpdate:modelValue":t[0]||(t[0]=h=>Q(o)?o.value=h:null),columns:l(ue),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:l(r),onReset:l(f),onCollapse:l(d)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),n(l(Z),{title:"CA日志",columns:l(me),onRefresh:l(r)},{default:u(({size:h,dynamicColumns:T})=>[n(I,{ref_key:"tableRef",ref:e,"row-key":"id","align-whole":"left","table-layout":"auto",loading:l(c),size:h,adaptive:"",adaptiveConfig:{offsetBottom:108},data:l(_),columns:T,pagination:x(P({},l(v)),{size:h}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:l(g),onPageCurrentChange:l(i),onCellDblclick:l(y)},{operation:u(({row:V})=>[n(s,{class:"reset-margin !outline-none",link:"",type:"primary",size:h,icon:l(X)(l(re)),onClick:be=>l(m)(V)},{default:u(()=>[...t[1]||(t[1]=[S(" 详情 ",-1)])]),_:1},8,["size","icon","onClick"])]),_:2},1032,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange","onCellDblclick"])]),_:1},8,["columns","onRefresh"])])}}}),ze=ee(he,[["__scopeId","data-v-59d77dff"]]);export{ze as default};
