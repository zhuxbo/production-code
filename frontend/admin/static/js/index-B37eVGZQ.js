var w=Object.defineProperty,z=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var S=(n,t,o)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,g=(n,t)=>{for(var o in t||(t={}))D.call(t,o)&&S(n,o,t[o]);if(_)for(var o of _(t))T.call(t,o)&&S(n,o,t[o]);return n},b=(n,t)=>z(n,k(t));import{P as I,a as L}from"./plus-search-DsTBMFwC.js";import{k as Y,r as f,l as M,t as V,p as B,f as p,h,A as N,I as U,s as F,C as E,d as j,o as q,c as A,e as H,v as O,i as l,j as W,w as $,_ as G}from"./index-y8QMp6Ai.js";import{c as J}from"./utils-3kAzAwBH.js";import{g as K}from"./datePicker-WHgduTab.js";import"./index-DPhin83c.js";import"./epTheme-l5vfs7Oj.js";function Q(n){return Y.get("/invoice-limit",{params:n})}function X(){const n=f({}),t=f([]),o=f(!0),e=M({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function i(a){e.pageSize=a,s()}function c(a){e.currentPage=a,s()}function s(){o.value=!0;const a=b(g({},V(n.value)),{pageSize:e.pageSize,currentPage:e.currentPage});a.created_at&&(a.created_at=J(a.created_at)),Q(a).then(({data:u})=>{t.value=u.items,e.total=u.total,e.pageSize=u.pageSize,e.currentPage=u.currentPage}).finally(()=>{o.value=!1})}return{loading:o,search:n,dataList:t,pagination:e,handleSizeChange:i,handleCurrentChange:c,onSearch:s,onReset:()=>{s()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const y=[{label:"开票",value:"issue"},{label:"作废",value:"void"},{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"}],Z={issue:"success",void:"danger",addfunds:"primary",refunds:"warning"};function ee(n){const t=B(()=>{n()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"限额ID/用户名"},onChange:()=>{t()}},{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型"},options:y,onChange:()=>{t()}},{label:"用户名",prop:"username",valueType:"input",fieldProps:{placeholder:"请输入用户名"}},{label:"限额ID",prop:"limit_id",valueType:"input",fieldProps:{placeholder:"请输入限额ID"}},{label:"金额",prop:"amount",renderField:(e,i)=>{var s,d;const c=(r,a)=>{r!==void 0&&a!==void 0&&r>a||i([r,a])};return p("div",{class:"flex items-center gap-2 w-full"},[p(h("el-input"),{class:"flex-1",modelValue:(s=e==null?void 0:e[0])==null?void 0:s.toString(),"onUpdate:modelValue":r=>{const a=r===""?void 0:Number(r);c(a,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),p("span",{class:"flex-none"},[N("至")]),p(h("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[1])==null?void 0:d.toString(),"onUpdate:modelValue":r=>{const a=r===""?void 0:Number(r);c(e==null?void 0:e[0],a)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:K()}}]}}function te(){const n=f(),t=E(),o=[{label:"用户名",prop:"user.username",minWidth:100,cellRenderer:U("user.username")},{label:"限额ID",prop:"limit_id",minWidth:100,cellRenderer:({row:e})=>p("span",{class:"cursor-pointer",onClick:()=>{t.push({path:["addfunds","refunds"].includes(e.type)?"/funds":"/invoice",query:{id:e.limit_id}})}},[e.limit_id])},{label:"类型",prop:"type",width:100,cellRenderer:({row:e,props:i})=>p(h("el-tag"),{size:i.size,type:Z[e.type],effect:"plain"},{default:()=>{var c;return[(c=y.find(s=>s.value===e.type))==null?void 0:c.label]}})},{label:"金额",prop:"amount",width:100},{label:"操作前",prop:"limit_before",width:100},{label:"操作后",prop:"limit_after",width:100},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?F(e).format("YYYY-MM-DD HH:mm:ss"):"-"}];return{tableRef:n,tableColumns:o}}const ae={class:"main"},ne={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=j({name:"InvoiceLimit",__name:"index",setup(n){const{tableRef:t,tableColumns:o}=te(),{loading:e,search:i,dataList:c,pagination:s,handleSizeChange:d,handleCurrentChange:r,onSearch:a,onReset:u,onCollapse:v}=X(),{searchColumns:x}=ee(()=>a());return q(()=>{a()}),(le,C)=>{const P=h("pure-table");return H(),A("div",ae,[O("div",ne,[p(l(I),{modelValue:l(i),"onUpdate:modelValue":C[0]||(C[0]=m=>W(i)?i.value=m:null),columns:l(x),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:l(a),onReset:l(u),onCollapse:l(v)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),p(l(L),{title:"发票额度",columns:l(o),onRefresh:l(a)},{default:$(({size:m,dynamicColumns:R})=>[p(P,{ref_key:"tableRef",ref:t,"row-key":"id","align-whole":"left","table-layout":"auto",loading:l(e),size:m,adaptive:"",adaptiveConfig:{offsetBottom:108},data:l(c),columns:R,pagination:b(g({},l(s)),{size:m}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:l(d),onPageCurrentChange:l(r)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),me=G(oe,[["__scopeId","data-v-ed9c4376"]]);export{me as default};
