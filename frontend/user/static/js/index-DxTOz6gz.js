var oe=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var I=(e,o,n)=>o in e?oe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,D=(e,o)=>{for(var n in o||(o={}))le.call(o,n)&&I(e,n,o[n]);if($)for(var n of $(o))re.call(o,n)&&I(e,n,o[n]);return e},F=(e,o)=>ne(e,ae(o));import{P as se,a as ie}from"./plus-search-Ddw1G523.js";import{k as y,l as d,m as ce,y as Y,t as ue,n as pe,p as de,q as me,d as fe,v as he,r as k,b as ge,c as O,o as q,f as V,e as c,g as t,x as A,j as f,w as be,A as ve,B as Ce,h as R,_ as _e}from"./index-B0ybLaAg.js";import{c as Se,g as ye,p as xe}from"./datePicker-BB6kNVow.js";import{u as Pe}from"./hooks-YYeV-sAi.js";import{u as we,P as ke}from"./drawer-CnJ8ts9O.js";import{C as Re}from"./close-bold-CbLIC3il.js";import"./epTheme-3SYpKPUj.js";import"./index-J36KFx34.js";function Te(e){return y.get("/contact",{params:e})}const E={user_id:0,first_name:"",last_name:"",identification_number:"",title:"",email:"",phone:0},ze=Object.keys(E);function De(e){return y.post("/contact",{data:e})}function Fe(e,o){return y.put(`/contact/${e}`,{data:o})}function Ve(e){return y.get(`/contact/${e}`)}function Be(e){return y.delete(`/contact/${e}`)}function Me(e){return y.delete("/contact/batch",{data:{ids:e}})}function $e(e){const o=d({}),n=d([]),i=d(!0),l=ce({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function S(a){l.pageSize=a,m()}function s(a){l.currentPage=a,m()}const h=d(!1),g=d(0),u=a=>{h.value=!0,a?g.value=a:g.value=0},C=a=>{Be(a).then(()=>{Y("删除成功",{type:"success"}),m()})},x=a=>{Me(a).then(()=>{Y("删除成功",{type:"success"}),m()})};function m(){i.value=!0;const a=F(D({},ue(o.value)),{pageSize:l.pageSize,currentPage:l.currentPage});a.created_at&&(a.created_at=Se(a.created_at)),Te(a).then(({data:_})=>{n.value=_.items,l.total=_.total,l.pageSize=_.pageSize,l.currentPage=_.currentPage,pe(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{i.value=!1})}return{loading:i,search:o,dataList:n,pagination:l,handleSizeChange:S,handleCurrentChange:s,onSearch:m,onReset:()=>{m()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:h,updateId:g,handleStore:u,handleDestroy:C,handleBatchDestroy:x}}const Ie=e=>{const o=de(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"姓名/邮箱/手机号"},onChange:()=>{o()}},{label:"名字",prop:"first_name",valueType:"input",fieldProps:{placeholder:"请输入名字"}},{label:"姓氏",prop:"last_name",valueType:"input",fieldProps:{placeholder:"请输入姓氏"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"电话",prop:"phone",valueType:"input",fieldProps:{placeholder:"请输入电话",type:"number"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:ye()}}]}},Ye=e=>{const o=d(!1),n=d(),i=d(0),l=d({}),S=[{label:"姓氏",prop:"last_name",valueType:"input",fieldProps:{placeholder:"请输入姓氏"}},{label:"名字",prop:"first_name",valueType:"input",fieldProps:{placeholder:"请输入名字"}},{label:"身份证号",prop:"identification_number",valueType:"input",fieldProps:{placeholder:"请输入身份证号"}},{label:"职位",prop:"title",valueType:"input",fieldProps:{placeholder:"请输入职位"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"电话",prop:"phone",valueType:"input",fieldProps:{placeholder:"请输入电话",type:"number"}}],s={last_name:[{required:!0,message:"请输入姓氏"},{max:50,message:"姓氏长度不能超过50个字符",trigger:"blur"}],first_name:[{required:!0,message:"请输入名字"},{max:50,message:"名字长度不能超过50个字符",trigger:"blur"}],identification_number:[{pattern:/^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/,message:"请输入正确的身份证号",trigger:"blur"}],title:[{required:!0,message:"请输入职位"},{max:20,message:"职位长度不能超过50个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入电话"},{pattern:/^[0-9]{1,15}$/,message:"请输入正确的格式",trigger:"blur"}]};function h(b=0){var p,a;o.value=!0,b>0?i.value!==b&&C(b):((a=(p=n.value)==null?void 0:p.formInstance)==null||a.resetFields(),l.value=Object.fromEntries(Object.entries(E).filter(([_,w])=>w!==0&&w!==""))),i.value=b}function g(){i.value>0?m():x()}function u(){o.value=!1}const C=b=>{Ve(b).then(({data:p})=>{l.value=xe(p,ze)})},x=()=>{De(l.value).then(()=>{e(),o.value=!1})},m=()=>{Fe(i.value,l.value).then(()=>{e(),o.value=!1})};return{storeRef:n,showStore:o,storeId:i,storeValues:l,storeColumns:S,rules:s,openStoreForm:h,confirmStoreForm:g,closeStoreForm:u}},Oe=()=>{const e=d(),o=d([]);return{tableRef:e,selectedIds:o,handleSelectionChange:s=>{o.value=s.map(h=>h.id),e.value.setAdaptive()},handleSelectionCancel:()=>{var s;(s=e.value)==null||s.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"姓",prop:"last_name",minWidth:120},{label:"名",prop:"first_name",minWidth:120},{label:"职位",prop:"title",minWidth:120},{label:"邮箱",prop:"email",minWidth:180},{label:"手机号",prop:"phone",minWidth:120},{label:"创建时间",prop:"created_at",minWidth:180,formatter:({created_at:s})=>s?me(s).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:110}],handleRowClick:(s,h,g)=>{var C;const u=g.target;u.tagName==="BUTTON"||u.closest("button")||u.closest(".el-button")||(C=e.value)==null||C.getTableRef().toggleRowSelection(s)}}},qe={class:"main"},Ae={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ee={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},Ne={class:"flex-auto"},We={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},je=fe({name:"Contact",__name:"index",setup(e){const{drawerSize:o}=we(),{tableRef:n,selectedIds:i,handleSelectionChange:l,handleSelectionCancel:S,tableColumns:s,handleRowClick:h}=Oe(),{loading:g,search:u,dataList:C,pagination:x,handleSizeChange:m,handleCurrentChange:b,onSearch:p,onReset:a,onCollapse:_,handleDestroy:w,handleBatchDestroy:N}=$e(n),{searchColumns:W}=Ie(()=>p()),{storeRef:j,showStore:U,storeId:L,storeColumns:H,rules:K,storeValues:T,openStoreForm:B,confirmStoreForm:X,closeStoreForm:G}=Ye(()=>p());return he(()=>{p()}),(Ue,r)=>{const P=k("el-button"),J=k("el-tooltip"),M=k("el-popconfirm"),Q=k("pure-table"),Z=ge("motion-fade");return q(),O("div",qe,[V("div",Ae,[c(t(se),{modelValue:t(u),"onUpdate:modelValue":r[0]||(r[0]=v=>A(u)?u.value=v:null),columns:t(W),"show-number":1,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(p),onReset:t(a),onCollapse:t(_)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),c(t(ie),{title:"联系人管理",columns:t(s),onRefresh:t(p)},{buttons:f(()=>[c(P,{type:"primary",onClick:r[1]||(r[1]=v=>t(B)())},{default:f(()=>r[4]||(r[4]=[R(" 新增联系人 ")])),_:1})]),default:f(({size:v,dynamicColumns:ee})=>[t(i).length>0?be((q(),O("div",Ee,[V("div",Ne,[c(J,{placement:"top",content:"取消选择"},{default:f(()=>[c(P,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Pe)(t(Re)),onClick:t(S)},null,8,["icon","onClick"])]),_:1}),V("span",We," 已选 "+Ce(t(i).length)+" 项 ",1)]),c(M,{title:"确定要删除吗？",width:"160px",onConfirm:r[2]||(r[2]=z=>t(N)(t(i)))},{reference:f(()=>[c(P,{type:"danger",size:"small"},{default:f(()=>r[5]||(r[5]=[R(" 批量删除 ")])),_:1})]),_:1})])),[[Z]]):ve("",!0),c(Q,{ref_key:"tableRef",ref:n,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(g),size:v,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(C),columns:ee,pagination:F(D({},t(x)),{size:v}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(h),onSelectionChange:t(l),onPageSizeChange:t(m),onPageCurrentChange:t(b)},{operation:f(({row:z})=>[c(P,{class:"reset-margin !outline-none",type:"primary",link:"",size:v,onClick:te=>t(B)(z.id)},{default:f(()=>r[6]||(r[6]=[R(" 编辑 ")])),_:2},1032,["size","onClick"]),c(M,{title:"确定要删除吗？",width:"160px",onConfirm:te=>t(w)(z.id)},{reference:f(()=>[c(P,{class:"reset-margin !outline-none",link:"",type:"danger",size:v},{default:f(()=>r[7]||(r[7]=[R(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),c(t(ke),{ref_key:"storeRef",ref:j,modelValue:t(T),"onUpdate:modelValue":r[3]||(r[3]=v=>A(T)?T.value=v:null),visible:t(U),form:{columns:t(H),rules:t(K),labelPosition:"right",labelSuffix:""},size:t(o),closeOnClickModal:!0,title:t(L)>0?"编辑联系人":"新增联系人",confirmText:"提交",cancelText:"取消",onConfirm:t(X),onCancel:t(G)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),tt=_e(je,[["__scopeId","data-v-7c6a3610"]]);export{tt as default};
