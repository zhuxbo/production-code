var K=Object.defineProperty,Q=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var U=(n,a,e)=>a in n?K(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,V=(n,a)=>{for(var e in a||(a={}))Z.call(a,e)&&U(n,e,a[e]);if(I)for(var e of I(a))ee.call(a,e)&&U(n,e,a[e]);return n},B=(n,a)=>Q(n,Y(a));var L=(n,a,e)=>new Promise((t,l)=>{var o=d=>{try{m(e.next(d))}catch(_){l(_)}},i=d=>{try{m(e.throw(d))}catch(_){l(_)}},m=d=>d.done?t(d.value):Promise.resolve(d.value).then(o,i);m((e=e.apply(n,a)).next())});import{P as ae,a as le}from"./plus-search-BCU4eNaM.js";import{i as te,b as O,e as N,c as q,n as D,a as F,d as ne}from"./product-BW9WTNMT.js";import{l as b,m as oe,z as $,ab as M,t as re,n as se,p as ie,e as s,r as g,aF as pe,aX as ue,d as W,V as de,i as A,o as x,j as c,c as j,a0 as ce,a1 as me,g as u,f as G,h as S,B as ve,a$ as E,v as fe,x as ge,A as _e,_ as be}from"./index-DfMmiWOn.js";import"./epTheme-NPik1Mxd.js";import"./index-SVd0T3CG.js";function he(n){const a=b({}),e=b([]),t=b(!0),l=oe({total:0,pageSize:100,currentPage:1,background:!0,pageSizes:[10,20,50,100],hideOnSinglePage:!0}),o=$(()=>l.total<=l.pageSize);function i(r){l.pageSize=r,d()}function m(r){l.currentPage=r,d()}function d(){t.value=!0;const r=B(V({},re(a.value)),{pageSize:l.pageSize,currentPage:l.currentPage});te(r).then(({data:h})=>{e.value=h.items,l.total=h.total,l.pageSize=h.pageSize,l.currentPage=h.currentPage,se(()=>{n.value&&n.value.getTableRef().clearSelection()})}).finally(()=>{t.value=!1})}function _(r){M.push({name:"Order",query:{product_id:r.id,type:"apply"}})}function p(r){M.push({name:"Order",query:{product_id:r.id,type:"batchApply"}})}return{loading:t,search:a,dataList:e,pagination:l,isSinglePage:o,handleSizeChange:i,handleCurrentChange:m,onSearch:d,handleApply:_,handleBatchApply:p}}const w=(n,a)=>(e,t)=>{const l=b(e),o=i=>{l.value===i?(l.value=void 0,t(void 0)):(l.value=i,t(i))};return s("div",{class:"flex flex-wrap gap-1 items-center"},[s("div",{class:"flex flex-wrap gap-1"},[n.map(i=>s(g("el-button"),{key:i.value,type:l.value===i.value?"primary":"default",onClick:()=>o(i.value),class:"ml-3 w-28"},{default:()=>[i.label]}))]),(a==null?void 0:a.showToggleButton)&&s(g("el-button"),{type:"primary",link:!0,onClick:a.onToggle,class:"ml-3 flex items-center whitespace-nowrap text-base"},{default:()=>[s(g("el-icon"),{class:"mr-1"},{default:()=>[a.collapsed?s(pe,null,null):s(ue,null,null)]}),a.collapsed?"展开":"收起"]})])},ye=n=>{const a=ie(()=>{n()},500),e=b(!0),t=()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},l=()=>{e.value=!e.value,t()};return{searchColumns:$(()=>[{label:"证书品牌",prop:"brand",valueType:"radio",options:O,renderField:w(O,{showToggleButton:!0,onToggle:l,collapsed:e.value})},{label:"加密标准",prop:"encryption_standard",valueType:"radio",options:N,renderField:w(N),hideInSearch:e.value},{label:"验证类型",prop:"validation_type",valueType:"radio",options:q,renderField:w(q),hideInSearch:e.value},{label:"域名类型",prop:"name_type",valueType:"radio",options:D,renderField:w(D),hideInSearch:e.value},{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"编码/名称/备注",clearable:!0,style:{width:"240px"},class:"ml-3"},hideInSearch:e.value}]),debouncedSearch:a}},Ce=()=>({tableRef:b(),tableColumns:[{label:"名称",prop:"name",minWidth:150},{label:"说明",prop:"remark",minWidth:150},{label:"价格",prop:"price.price",width:100,formatter(e){var t;return(t=e.price)!=null&&t.price&&e.price.price!=="0.00"?parseFloat(e.price.price)+"/"+F[e.price.period]:"-"}},{label:"附加标准域名价格",prop:"price.alternative_standard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_standard_price&&e.price.alternative_standard_price!=="0.00"?parseFloat(e.price.alternative_standard_price)+"/"+F[e.price.period]:"-"}},{label:"附加通配符价格",prop:"price.alternative_wildcard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_wildcard_price&&e.price.alternative_wildcard_price!=="0.00"?parseFloat(e.price.alternative_wildcard_price)+"/"+F[e.price.period]:"-"}},{label:"操作",slot:"operation",width:110,fixed:"right"}]}),xe={class:"dialog-footer"},Se=W({__name:"export",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(n,{emit:a}){const e=n,t=a,l=$({get:()=>e.visible,set:p=>t("update:visible",p)}),o=b({brands:[],priceRate:1}),i=()=>{o.value={brands:[],priceRate:1}},m=b(!1),d=()=>L(null,null,function*(){if(!m.value){if(o.value.priceRate<=0){E.error("价格倍率必须大于0");return}m.value=!0;try{const p={};o.value.brands.length>0&&(p.brands=o.value.brands),o.value.priceRate!==1&&(p.priceRate=o.value.priceRate),yield ne(p),E.success("导出成功"),l.value=!1}catch(p){console.error("导出失败:",p),E.error(p.message||"导出失败")}finally{m.value=!1}}}),_=()=>{l.value=!1,i()};return de(()=>e.visible,p=>{p&&i()}),(p,r)=>{const h=g("el-option"),P=g("el-select"),k=g("el-form-item"),C=g("el-input-number"),z=g("el-form"),R=g("el-button"),f=g("el-dialog");return x(),A(f,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=v=>l.value=v),title:"导出产品价格",width:"500px","destroy-on-close":"",onClose:_},{footer:c(()=>[G("div",xe,[s(R,{onClick:_},{default:c(()=>r[3]||(r[3]=[S("取消")])),_:1}),s(R,{type:"primary",loading:m.value,onClick:d},{default:c(()=>[S(ve(m.value?"导出中...":"导出"),1)]),_:1},8,["loading"])])]),default:c(()=>[s(z,{model:o.value,"label-width":"120px","label-position":"right"},{default:c(()=>[s(k,{label:"品牌筛选"},{default:c(()=>[s(P,{modelValue:o.value.brands,"onUpdate:modelValue":r[0]||(r[0]=v=>o.value.brands=v),multiple:"",placeholder:"选择品牌（不选择则导出所有品牌）",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":""},{default:c(()=>[(x(!0),j(ce,null,me(u(O),v=>(x(),A(h,{key:v.value,label:v.label,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(k,{label:"价格倍率"},{default:c(()=>[s(C,{modelValue:o.value.priceRate,"onUpdate:modelValue":r[1]||(r[1]=v=>o.value.priceRate=v),min:.01,max:1e3,step:.1,precision:2,style:{width:"100%"},placeholder:"输入价格倍率"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ke={class:"main"},we={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Pe=W({name:"Product",__name:"index",setup(n){const{tableRef:a,tableColumns:e}=Ce(),{loading:t,search:l,dataList:o,pagination:i,isSinglePage:m,handleSizeChange:d,handleCurrentChange:_,onSearch:p,handleApply:r,handleBatchApply:h}=he(a),{searchColumns:P,debouncedSearch:k}=ye(()=>p()),C=b(!1),z=()=>{C.value=!0};return fe(()=>{p()}),(R,f)=>{const v=g("el-button"),X=g("pure-table");return x(),j("div",ke,[G("div",we,[s(u(ae),{modelValue:u(l),"onUpdate:modelValue":f[0]||(f[0]=y=>ge(l)?l.value=y:null),columns:u(P),"show-number":6,"col-props":{xs:24,sm:24,md:24,lg:24,xl:24},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:u(k)},null,8,["modelValue","columns","onChange"])]),s(u(le),{title:"产品列表",columns:u(e),onRefresh:u(p)},{buttons:c(()=>[s(v,{type:"success",onClick:z},{default:c(()=>f[2]||(f[2]=[S("导出价格")])),_:1})]),default:c(({size:y,dynamicColumns:H})=>[s(X,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:u(t),size:y,adaptive:"",adaptiveConfig:{offsetBottom:u(m)?44:108},data:u(o),columns:H,pagination:B(V({},u(i)),{size:y}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:u(d),onPageCurrentChange:u(_)},{operation:c(({row:T})=>[s(v,{class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:J=>u(r)(T)},{default:c(()=>f[3]||(f[3]=[S(" 申请 ")])),_:2},1032,["size","onClick"]),T.alternative_name_types.length?_e("",!0):(x(),A(v,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:J=>u(h)(T)},{default:c(()=>f[4]||(f[4]=[S(" 批量 ")])),_:2},1032,["size","onClick"]))]),_:2},1032,["loading","size","adaptiveConfig","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),s(Se,{visible:C.value,"onUpdate:visible":f[1]||(f[1]=y=>C.value=y)},null,8,["visible"])])}}}),Ee=be(Pe,[["__scopeId","data-v-7e0ff5a5"]]);export{Ee as default};
