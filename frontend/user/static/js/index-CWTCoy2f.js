var j=Object.defineProperty;var z=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var N=(u,l,s)=>l in u?j(u,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[l]=s,q=(u,l)=>{for(var s in l||(l={}))H.call(l,s)&&N(u,s,l[s]);if(z)for(var s of z(l))Y.call(l,s)&&N(u,s,l[s]);return u};var S=(u,l,s)=>new Promise((y,_)=>{var R=m=>{try{v(s.next(m))}catch(p){_(p)}},V=m=>{try{v(s.throw(m))}catch(p){_(p)}},v=m=>m.done?y(m.value):Promise.resolve(m.value).then(R,V);v((s=s.apply(u,l)).next())});import{p as $,M as Q,N as W,r as D,f as X,C as ee,l as x,F as oe,v as P,y as d,G as o,k as r,H as re,u as ae,al as te,t as se,x as a,A as I,K as b,z as k,m as h,_ as le}from"./index-D5efkW8k.js";import{r as ne}from"./auth-8X049xxM.js";import{s as ie}from"./verifyCode-Dcp6w-MG.js";import{E as ue,u as de}from"./message-CcCWF0Wj.js";import{b as me,i as ce,M as f,L as A}from"./lock-fill-DQ5zZJCF.js";import{e as fe,a as pe,u as ge,b as _e,d as ye}from"./dark-RCXbEOcu.js";import{U as ve}from"./user-3-fill-C6TxwxWQ.js";import"./epTheme-fw8KIjwK.js";import"./user-DCOGtfwP.js";const we={class:"select-none"},xe=["src"],be={class:"flex-c absolute right-5 top-3"},he={class:"login-container"},Ce={class:"img"},Ve={class:"login-box"},Se={class:"login-form"},ke={class:"outline-none"},Re={class:"w-full flex justify-between"},Ee={class:"w-full flex-c absolute bottom-3 text-sm text-[rgba(0,0,0,0.6)] dark:text-[rgba(220,220,242,0.8)]"},Ie={class:"hover:text-primary",href:"/",target:"_blank"},C="registration_source",Ue=$({name:"Register",__name:"index",setup(u){const l=Q(),s=W(),y=D(null),_=D(!1),{isDisabled:R,text:V,start:v}=de(),{initStorage:m}=fe();m();const{dataTheme:p,overallStyle:B,dataThemeChange:U}=pe();U(B.value);const{title:T}=ge(),t=X({username:"",password:"",confirmPassword:"",email:"",verifyCode:""}),F=n=>{const e=Date.now()+2592e5,c={value:n,expiry:e};localStorage.setItem(C,JSON.stringify(c))},L=()=>{const n=localStorage.getItem(C);if(!n)return null;try{const e=JSON.parse(n);return Date.now()>e.expiry?(localStorage.removeItem(C),null):e.value}catch(e){return localStorage.removeItem(C),null}},M=()=>{localStorage.removeItem(C)};ee(()=>{const n=s.query.source;n&&F(n)});const O={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,e,c)=>{e===""?c(new Error("请再次输入密码")):t.password!==e?c(new Error("两次输入密码不一致")):c()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"请输入正确的邮箱格式",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},Z=()=>S(null,null,function*(){if(!t.email){h("请先输入邮箱",{type:"warning"});return}try{yield ie({email:t.email,type:"register"}),h("验证码已发送，请查收邮件",{type:"success"}),v()}catch(n){h("验证码发送失败，请稍后重试",{type:"error"})}});function G(){l.push("/login")}function J(){return S(this,null,function*(){y.value&&y.value.validate(n=>S(null,null,function*(){if(n){_.value=!0;try{const e=L(),c=q({username:t.username,password:t.password,email:t.email,code:t.verifyCode},e&&{source:e});yield ne(c),h("注册成功，请登录",{type:"success"}),M(),l.push("/login")}catch(e){h("注册失败，请重试",{type:"error"})}finally{_.value=!1}}}))})}return(n,e)=>{const c=x("el-switch"),w=x("el-input"),g=x("el-form-item"),E=x("el-button"),K=x("el-form");return P(),oe("div",we,[d("img",{src:o(me),class:"wave"},null,8,xe),d("div",be,[r(c,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=i=>re(p)?p.value=i:null),"inline-prompt":"","active-icon":o(ye),"inactive-icon":o(_e),onChange:o(U)},null,8,["modelValue","active-icon","inactive-icon","onChange"])]),d("div",he,[d("div",Ce,[(P(),ae(te(se(o(ce)))))]),d("div",Ve,[d("div",Se,[r(o(f),{delay:300},{default:a(()=>[d("h2",ke,I(o(T)),1)]),_:1}),r(K,{ref_key:"formRef",ref:y,model:t,rules:O,size:"large"},{default:a(()=>[r(o(f),{delay:100},{default:a(()=>[r(g,{prop:"username"},{default:a(()=>[r(w,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=i=>t.username=i),clearable:"",placeholder:"用户名","prefix-icon":o(b)(o(ve))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),r(o(f),{delay:150},{default:a(()=>[r(g,{prop:"password"},{default:a(()=>[r(w,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=i=>t.password=i),clearable:"","show-password":"",placeholder:"密码","prefix-icon":o(b)(o(A))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),r(o(f),{delay:200},{default:a(()=>[r(g,{prop:"confirmPassword"},{default:a(()=>[r(w,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=i=>t.confirmPassword=i),clearable:"","show-password":"",placeholder:"确认密码","prefix-icon":o(b)(o(A))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),r(o(f),{delay:250},{default:a(()=>[r(g,{prop:"email"},{default:a(()=>[r(w,{modelValue:t.email,"onUpdate:modelValue":e[4]||(e[4]=i=>t.email=i),clearable:"",placeholder:"邮箱","prefix-icon":o(b)(o(ue))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),r(o(f),{delay:300},{default:a(()=>[r(g,{prop:"verifyCode"},{default:a(()=>[d("div",Re,[r(w,{modelValue:t.verifyCode,"onUpdate:modelValue":e[5]||(e[5]=i=>t.verifyCode=i),clearable:"",placeholder:"邮箱验证码","prefix-icon":o(b)("ri:shield-keyhole-line")},null,8,["modelValue","prefix-icon"]),r(E,{disabled:o(R),class:"ml-2!",onClick:Z},{default:a(()=>[k(I(o(V).length>0?o(V)+"秒后重新获取":"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),r(o(f),{delay:350},{default:a(()=>[r(g,null,{default:a(()=>[r(E,{class:"w-full",size:"default",type:"primary",loading:_.value,onClick:J},{default:a(()=>[...e[6]||(e[6]=[k(" 注册 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),r(o(f),{delay:400},{default:a(()=>[r(g,null,{default:a(()=>[r(E,{class:"w-full",size:"default",onClick:G},{default:a(()=>[...e[7]||(e[7]=[k(" 返回登录 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])]),d("div",Ee,[e[8]||(e[8]=k(" Copyright © 2020-present ",-1)),d("a",Ie,"  "+I(o(T)),1)])])}}}),Me=le(Ue,[["__scopeId","data-v-03e138b8"]]);export{Me as default};
