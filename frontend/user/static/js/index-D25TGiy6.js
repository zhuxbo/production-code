var te=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var z=(r,t,o)=>t in r?te(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,R=(r,t)=>{for(var o in t||(t={}))se.call(t,o)&&z(r,o,t[o]);if(B)for(var o of B(t))ne.call(t,o)&&z(r,o,t[o]);return r},N=(r,t)=>oe(r,ae(t));var F=(r,t,o)=>new Promise((x,d)=>{var w=p=>{try{m(o.next(p))}catch(f){d(f)}},V=p=>{try{m(o.throw(p))}catch(f){d(f)}},m=p=>p.done?x(p.value):Promise.resolve(p.value).then(w,V);m((o=o.apply(r,t)).next())});import{U as le,F as G,v as S,y as n,p as ie,r as b,M as re,N as ue,f as ce,bY as de,w as q,C as pe,l as h,D as me,G as a,k as s,H as fe,u as _e,al as ve,t as ge,x as i,A as D,K as A,z as y,I as P,ac as he,bZ as ye,T as xe,aJ as H,a5 as O,b_ as Y,a3 as j,m as k,ax as we,_ as be}from"./index-D5efkW8k.js";import{b as ke,i as Ce,M as C,L as Ve}from"./lock-fill-DQ5zZJCF.js";import{l as De}from"./rule-diwFXDwY.js";import{e as Te,a as Me,u as Re,b as Ie,d as Se}from"./dark-RCXbEOcu.js";import{u as I}from"./user-DCOGtfwP.js";import{g as Ee}from"./auth-8X049xxM.js";import{U as Le}from"./user-3-fill-C6TxwxWQ.js";import"./epTheme-fw8KIjwK.js";const Ue={viewBox:"0 0 24 24",width:"1em",height:"1em"};function Be(r,t){return S(),G("svg",Ue,[...t[0]||(t[0]=[n("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16M11 7h2v2h-2zm0 4h2v6h-2z"},null,-1)])])}const ze=le({name:"ri-information-line",render:Be}),Ne={class:"select-none"},Fe=["src"],qe={class:"flex-c absolute right-5 top-3"},Ae={class:"login-container"},Pe={class:"img"},He={class:"login-box"},Oe={class:"login-form"},Ye={class:"outline-none"},je={class:"w-full h-[20px] flex justify-between items-center"},Ge={class:"flex"},We={class:"w-full h-[20px] flex justify-between items-center"},$e={class:"w-full flex-c absolute bottom-3 text-sm text-[rgba(0,0,0,0.6)] dark:text-[rgba(220,220,242,0.8)]"},Je={class:"hover:text-primary",href:"/",target:"_blank"},Ke={class:"hover:text-primary",href:"https://beian.miit.gov.cn/",target:"_blank"},Qe=ie({name:"Login",__name:"index",setup(r){const t=b(7),o=re(),x=ue(),d=b(!1),w=b(!1),V=b(!1),m=b(),{initStorage:p}=Te();p();const{dataTheme:f,overallStyle:W,dataThemeChange:E}=Me();E(W.value);const{title:L}=Re(),_=ce({account:"",password:""}),$=()=>F(null,null,function*(){const l=x.query.auto_token;if(l){d.value=!0;try{const e=new Date(Date.now()+72e5),v={access_token:l,refresh_token:"",expires_in:e,username:"",balance:"0.00",roles:[],permissions:[]};H(v);const u=yield Ee();if((u==null?void 0:u.code)===1&&u.data){const T=N(R({},v),{username:u.data.username||"",balance:u.data.balance||"0.00",roles:u.data.roles||[],permissions:u.data.permissions||[]});H(T)}O().handleWholeMenus([]),Y();const g=R({},x.query);delete g.auto_token,yield o.replace({path:x.path,query:g}),o.push(j(!0).path),k("管理员代理登录成功",{type:"success"})}catch(e){k("自动登录失败，请手动登录",{type:"error"})}finally{d.value=!1}}}),U=l=>{l&&l.validate().then(e=>{e&&(d.value=!0,I().loginByAccount({account:_.account,password:_.password}).then(v=>{v.code===1?(O().handleWholeMenus([]),Y(),o.push(j(!0).path),k("登录成功",{type:"success"})):k(v.msg,{type:"error"})}).catch(()=>{k("登录失败",{type:"error"})}).finally(()=>{d.value=!1}))})},J=()=>{o.push("/register")},K=()=>{o.push("/reset-password")},Q=we(l=>U(l),1e3,!0);return de(document,"keypress",({code:l})=>{["Enter","NumpadEnter"].includes(l)&&!V.value&&!d.value&&Q(m.value)}),q(w,l=>{I().SET_ISREMEMBERED(l)}),q(t,l=>{I().SET_LOGINDAY(l)}),pe(()=>{$()}),(l,e)=>{const v=h("el-switch"),u=h("el-input"),g=h("el-form-item"),T=h("IconifyIconOffline"),Z=h("el-checkbox"),M=h("el-button"),X=h("el-form"),ee=me("tippy");return S(),G("div",Ne,[n("img",{src:a(ke),class:"wave"},null,8,Fe),n("div",qe,[s(v,{modelValue:a(f),"onUpdate:modelValue":e[0]||(e[0]=c=>fe(f)?f.value=c:null),"inline-prompt":"","active-icon":a(Se),"inactive-icon":a(Ie),onChange:a(E)},null,8,["modelValue","active-icon","inactive-icon","onChange"])]),n("div",Ae,[n("div",Pe,[(S(),_e(ve(ge(a(Ce)))))]),n("div",He,[n("div",Oe,[s(a(C),{delay:300},{default:i(()=>[n("h2",Ye,D(a(L)),1)]),_:1}),s(X,{ref_key:"ruleFormRef",ref:m,model:_,rules:a(De),size:"large"},{default:i(()=>[s(a(C),{delay:100},{default:i(()=>[s(g,{rules:[{required:!0,message:"请输入用户名/邮箱/手机号",trigger:"blur"}],prop:"account"},{default:i(()=>[s(u,{modelValue:_.account,"onUpdate:modelValue":e[1]||(e[1]=c=>_.account=c),clearable:"",placeholder:"用户名/邮箱/手机号","prefix-icon":a(A)(a(Le))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),s(a(C),{delay:150},{default:i(()=>[s(g,{prop:"password"},{default:i(()=>[s(u,{modelValue:_.password,"onUpdate:modelValue":e[2]||(e[2]=c=>_.password=c),clearable:"","show-password":"",placeholder:"密码","prefix-icon":a(A)(a(Ve))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),s(a(C),{delay:250},{default:i(()=>[s(g,null,{default:i(()=>[n("div",je,[s(Z,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=c=>w.value=c)},{default:i(()=>[n("span",Ge,[e[7]||(e[7]=y(" 记住我 ",-1)),P(n("select",{"onUpdate:modelValue":e[3]||(e[3]=c=>t.value=c),style:he({width:t.value<10?"10px":"16px",outline:"none",background:"none",appearance:"none",marginLeft:"5px"})},[...e[6]||(e[6]=[n("option",{value:"1"},"1",-1),n("option",{value:"7"},"7",-1),n("option",{value:"30"},"30",-1)])],4),[[ye,t.value]]),e[8]||(e[8]=y(" 天 ",-1)),P(s(T,{icon:a(ze),class:"ml-1"},null,8,["icon"]),[[ee,{content:"登录信息保存天数",placement:"top"}]])])]),_:1},8,["modelValue"]),s(M,{link:"",type:"primary",onClick:K},{default:i(()=>[...e[9]||(e[9]=[y(" 忘记密码？ ",-1)])]),_:1})]),s(M,{class:"w-full mt-4!",size:"default",type:"primary",loading:d.value,disabled:V.value,onClick:e[5]||(e[5]=c=>U(m.value))},{default:i(()=>[...e[10]||(e[10]=[y(" 登录 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),s(a(C),{delay:300},{default:i(()=>[s(g,null,{default:i(()=>[n("div",We,[s(M,{class:"w-full mt-4",size:"default",onClick:J},{default:i(()=>[...e[11]||(e[11]=[y(" 注册 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1},8,["model","rules"])])])]),n("div",$e,[y(" Copyright © 2017-"+D(new Date().getFullYear())+" ",1),n("a",Je,"  "+D(a(L)),1),n("a",Ke,"  "+D(a(xe)("Beian")),1)])])}}}),it=be(Qe,[["__scopeId","data-v-3396e95b"]]);export{it as default};
