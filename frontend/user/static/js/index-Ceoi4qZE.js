var ge=Object.defineProperty,ve=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var O=(t,a,o)=>a in t?ge(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,N=(t,a)=>{for(var o in a||(a={}))be.call(a,o)&&O(t,o,a[o]);if(q)for(var o of q(a))Ce.call(a,o)&&O(t,o,a[o]);return t},E=(t,a)=>ve(t,he(a));import{e as P,r as h,f as _e,m as k,t as xe,n as ye,g as Se,i as H,j as we,k as l,l as C,o as G,E as ke,p as L,w as U,q as $,u as ze,v as M,x as i,y as T,z as S,A as B,B as j,_ as X,C as Te,D as Re,F as W,G as e,H as Y,I as Pe,J as Ve,K as De,P as Ne}from"./index-D5efkW8k.js";import{P as Ee}from"./plus-search-Cl3d-rfH.js";import{O as J}from"./psl-D8AmD7_c.js";import{u as $e,P as Me}from"./drawer-52AWmrrm.js";import{C as Be}from"./close-bold-De5phodQ.js";import"./index-CsaBZZ8X.js";function Fe(t){return P.get("/delegation",{params:t})}const Ae={zone:"",prefix:""};function Ie(t){return P.post("/delegation",{data:t})}function qe(t){return P.post(`/delegation/check/${t}`)}function Oe(t){return P.delete(`/delegation/${t}`)}function Ge(t){return P.delete("/delegation/batch",{data:{ids:t}})}function Ue(t){const a=h({}),o=h([]),_=h(!0),u=_e({total:0,pageSize:20,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function y(c){u.pageSize=c,v()}function s(c){u.currentPage=c,v()}const m=h(!1),g=h(0),b=c=>{m.value=!0,c?g.value=c:g.value=0},r=c=>{Oe(c).then(()=>{k("删除成功",{type:"success"}),v()})},n=c=>{Ge(c).then(()=>{k("删除成功",{type:"success"}),v()})},f=c=>{qe(c).then(p=>{k(p.msg||"检查完成",{type:"success"}),v()}).catch(p=>{k(p.message||"检查失败",{type:"error"})})};function v(){_.value=!0;const c=E(N({},xe(a.value)),{pageSize:u.pageSize,currentPage:u.currentPage});Fe(c).then(({data:p})=>{o.value=p.items,u.total=p.total,u.pageSize=p.pageSize,u.currentPage=p.currentPage,ye(()=>{t.value&&t.value.getTableRef().clearSelection()})}).finally(()=>{_.value=!1})}return{loading:_,search:a,dataList:o,pagination:u,handleSizeChange:y,handleCurrentChange:s,onSearch:v,onReset:()=>{v()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:m,updateId:g,handleStore:b,handleDestroy:r,handleBatchDestroy:n,handleCheck:f}}const je=t=>{const a=Se(()=>{t()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"域名/标签"},onChange:()=>{a()}},{label:"委托域",prop:"zone",valueType:"input",fieldProps:{placeholder:"请输入域名"},onChange:()=>{a()}},{label:"委托前缀",prop:"prefix",valueType:"select",options:[{label:"_acme-challenge",value:"_acme-challenge"},{label:"_dnsauth",value:"_dnsauth"},{label:"_pki-validation",value:"_pki-validation"},{label:"_certum",value:"_certum"}],fieldProps:{placeholder:"请选择前缀"}},{label:"状态",prop:"valid",valueType:"select",options:[{label:"有效",value:!0},{label:"无效",value:!1}],fieldProps:{placeholder:"请选择状态"}}]}},We=(t,a)=>{const o=h(!1),_=h(),u=h(0),y=h({}),s=[{label:"委托域",prop:"zone",valueType:"input",fieldProps:{placeholder:"例如: example.com"},renderExtra:()=>H("div",{style:{fontSize:"12px",color:"#909399",marginTop:"5px"}})},{label:"委托前缀",prop:"prefix",valueType:"select",options:[{label:"_certum",value:"_certum"},{label:"_pki-validation",value:"_pki-validation"},{label:"_dnsauth",value:"_dnsauth"},{label:"_acme-challenge",value:"_acme-challenge"}],fieldProps:{placeholder:"请选择委托前缀"}}],m={zone:[{required:!0,message:"请输入委托域",trigger:"blur"},{pattern:/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i,message:"请输入正确的域名格式",trigger:"blur"}],prefix:[{required:!0,message:"请选择委托前缀",trigger:"change"}]};function g(f=0){var v,w;if(o.value=!0,f>0){k("委托记录不支持编辑，请删除后重新创建",{type:"warning"}),o.value=!1;return}else(w=(v=_.value)==null?void 0:v.formInstance)==null||w.resetFields(),y.value=Object.fromEntries(Object.entries(Ae).filter(([R,c])=>c!==""));u.value=f}function b(){n()}function r(){o.value=!1}const n=()=>{Ie(y.value).then(f=>{t(),o.value=!1,f.data&&f.data.cname_to&&a(f.data)})};return{storeRef:_,showStore:o,storeId:u,storeValues:y,storeColumns:s,rules:m,openStoreForm:g,confirmStoreForm:b,closeStoreForm:r}},Ye=()=>{const t=h(),a=h([]);return{tableRef:t,selectedIds:a,handleSelectionChange:s=>{a.value=s.map(m=>m.id),t.value.setAdaptive()},handleSelectionCancel:()=>{var s;(s=t.value)==null||s.getTableRef().clearSelection()},tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"委托域",prop:"zone",minWidth:150},{label:"委托前缀",prop:"prefix",width:150,cellRenderer:({row:s})=>{var g;const m=((g=J(s.cname_to.host))==null?void 0:g.subdomain)||"";return l("div",{className:"flex items-center gap-1"},[l("span",null,[m||"-"]),l(C("el-button"),{link:!0,size:"small",onClick:b=>{b.stopPropagation(),navigator.clipboard.writeText(m).then(()=>{k("委托前缀已复制到剪贴板",{type:"success"})})},className:"!p-0 !m-0 !mt-1 !bg-transparent !border-none !shadow-none align-middle text-gray-500 hover:text-blue-500"},{default:()=>[l(C("el-icon"),{size:"14"},{default:()=>[l(G,null,null)]})]})])}},{label:"CNAME目标",prop:"target_fqdn",minWidth:200,cellRenderer:({row:s})=>{const m=s.target_fqdn;return l("div",{className:"flex items-center gap-1"},[l("span",null,[m||"-"]),l(C("el-button"),{link:!0,size:"small",onClick:g=>{g.stopPropagation(),navigator.clipboard.writeText(m).then(()=>{k("CNAME目标已复制到剪贴板",{type:"success"})})},className:"!p-0 !m-0 !mt-1 !bg-transparent !border-none !shadow-none align-middle text-gray-500 hover:text-blue-500"},{default:()=>[l(C("el-icon"),{size:"14"},{default:()=>[l(G,null,null)]})]})])}},{label:"状态",prop:"valid",width:100,cellRenderer:({row:s})=>H(ke,{type:s.valid?"success":"danger"},{default:()=>s.valid?"有效":"无效"})},{label:"失败次数",prop:"fail_count",width:100},{label:"上次检查",prop:"last_checked_at",width:180,formatter:({last_checked_at:s})=>s?we(s).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",slot:"operation",width:220}],handleRowClick:(s,m,g)=>{var r;const b=g.target;b.tagName==="BUTTON"||b.closest("button")||b.closest(".el-button")||(r=t.value)==null||r.getTableRef().toggleRowSelection(s)}}},He={class:"cname-guide-content"},Le={class:"break-all whitespace-normal"},Xe=L({__name:"CnameGuide",props:{modelValue:{type:Boolean,default:!1},options:{default:null}},emits:["update:modelValue"],setup(t,{emit:a}){const o=t,_=a,u=h(o.modelValue);U(()=>o.modelValue,r=>{u.value=r}),U(u,r=>{_("update:modelValue",r)});const y=$(()=>{const r=window.innerWidth;return r<768?"95vw":r<1024?"80vw":(r<1440,"720px")}),s=$(()=>{var r,n,f;return!((r=o.options)!=null&&r.cname_to)||!((n=o.options)!=null&&n.zone)?"":((f=J(o.options.cname_to.host))==null?void 0:f.subdomain)||""}),m=$(()=>{var r,n;return((n=(r=o.options)==null?void 0:r.cname_to)==null?void 0:n.value)||""}),g=r=>{navigator.clipboard.writeText(r).then(()=>{j.success("复制成功")}).catch(()=>{j.error("复制失败")})},b=()=>{};return(r,n)=>{const f=C("el-alert"),v=C("el-button"),w=C("el-descriptions-item"),R=C("el-descriptions"),c=C("el-dialog");return M(),ze(c,{modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=p=>u.value=p),title:"CNAME 配置指引",width:y.value,draggable:"",onClosed:b},{footer:i(()=>[l(v,{type:"primary",onClick:n[2]||(n[2]=p=>u.value=!1)},{default:i(()=>[...n[9]||(n[9]=[S(" 知道了 ",-1)])]),_:1})]),default:i(()=>[T("div",He,[l(f,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{default:i(()=>[...n[4]||(n[4]=[S(" 请在 DNS 服务商处添加以下 CNAME 记录： ",-1)])]),_:1}),l(R,{column:1,border:"","label-width":"6em"},{default:i(()=>[l(w,{label:"主机记录"},{default:i(()=>[T("span",null,B(s.value),1),l(v,{link:"",type:"primary",onClick:n[0]||(n[0]=p=>g(s.value))},{default:i(()=>[...n[5]||(n[5]=[S(" 复制 ",-1)])]),_:1})]),_:1}),l(w,{label:"记录类型"},{default:i(()=>[...n[6]||(n[6]=[S(" CNAME ",-1)])]),_:1}),l(w,{label:"记录值"},{default:i(()=>[T("span",Le,B(m.value),1),l(v,{link:"",type:"primary",onClick:n[1]||(n[1]=p=>g(m.value))},{default:i(()=>[...n[7]||(n[7]=[S(" 复制 ",-1)])]),_:1})]),_:1})]),_:1}),l(f,{type:"warning",closable:!1,style:{"margin-top":"20px"}},{default:i(()=>[...n[8]||(n[8]=[S(" 配置后，请等待 DNS 解析生效（通常 5-10 分钟），之后使用 TXT 解析验证的订单会自动进行验证 ",-1)])]),_:1})])]),_:1},8,["modelValue","width"])}}}),Je=X(Xe,[["__scopeId","data-v-e6759cf5"]]),Ke={class:"main"},Qe={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ze={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},et={class:"flex-auto"},tt={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},lt=L({name:"Delegation",__name:"index",setup(t){const{drawerSize:a}=$e(),o=h(!1),_=h(null),u=F=>{_.value=F,o.value=!0},{tableRef:y,selectedIds:s,handleSelectionChange:m,handleSelectionCancel:g,tableColumns:b,handleRowClick:r}=Ye(),{loading:n,search:f,dataList:v,pagination:w,handleSizeChange:R,handleCurrentChange:c,onSearch:p,onReset:K,onCollapse:Q,handleDestroy:Z,handleBatchDestroy:ee,handleCheck:te}=Ue(y),{searchColumns:le}=je(()=>p()),{storeRef:oe,showStore:ne,storeId:ae,storeColumns:se,rules:re,storeValues:D,openStoreForm:ie,confirmStoreForm:ue,closeStoreForm:ce}=We(()=>p(),u);return Te(()=>{p()}),(F,d)=>{const z=C("el-button"),de=C("el-tooltip"),A=C("el-popconfirm"),pe=C("pure-table"),me=Re("motion-fade");return M(),W("div",Ke,[T("div",Qe,[l(e(Ee),{modelValue:e(f),"onUpdate:modelValue":d[0]||(d[0]=x=>Y(f)?f.value=x:null),columns:e(le),"show-number":1,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:e(p),onReset:e(K),onCollapse:e(Q)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),l(e(Ne),{title:"CNAME 委托管理",columns:e(b),onRefresh:e(p)},{buttons:i(()=>[l(z,{type:"primary",onClick:d[1]||(d[1]=x=>e(ie)())},{default:i(()=>[...d[5]||(d[5]=[S(" 新建委托 ",-1)])]),_:1})]),default:i(({size:x,dynamicColumns:fe})=>[e(s).length>0?Pe((M(),W("div",Ze,[T("div",et,[l(de,{placement:"top",content:"取消选择"},{default:i(()=>[l(z,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:e(De)(e(Be)),onClick:e(g)},null,8,["icon","onClick"])]),_:1}),T("span",tt," 已选 "+B(e(s).length)+" 项 ",1)]),l(A,{title:"确定要删除吗？删除后将不再自动写入 TXT 记录",width:"220px",onConfirm:d[2]||(d[2]=V=>e(ee)(e(s)))},{reference:i(()=>[l(z,{type:"danger",size:"small"},{default:i(()=>[...d[6]||(d[6]=[S(" 批量删除 ",-1)])]),_:1})]),_:1})])),[[me]]):Ve("",!0),l(pe,{ref_key:"tableRef",ref:y,"row-key":"id","align-whole":"left","table-layout":"auto",loading:e(n),size:x,adaptive:"",adaptiveConfig:{offsetBottom:108},data:e(v),columns:fe,pagination:E(N({},e(w)),{size:x}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:e(r),onSelectionChange:e(m),onPageSizeChange:e(R),onPageCurrentChange:e(c)},{operation:i(({row:V})=>[l(z,{class:"reset-margin !outline-none",type:"primary",link:"",size:x,onClick:I=>u(V)},{default:i(()=>[...d[7]||(d[7]=[S(" 配置指引 ",-1)])]),_:1},8,["size","onClick"]),l(z,{class:"reset-margin !outline-none",type:"primary",link:"",size:x,onClick:I=>e(te)(V.id)},{default:i(()=>[...d[8]||(d[8]=[S(" 检查 ",-1)])]),_:1},8,["size","onClick"]),l(A,{title:"确定要删除吗？删除后将不再自动写入 TXT 记录",width:"220px",onConfirm:I=>e(Z)(V.id)},{reference:i(()=>[l(z,{class:"reset-margin !outline-none",link:"",type:"danger",size:x},{default:i(()=>[...d[9]||(d[9]=[S(" 删除 ",-1)])]),_:1},8,["size"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),l(e(Me),{ref_key:"storeRef",ref:oe,modelValue:e(D),"onUpdate:modelValue":d[3]||(d[3]=x=>Y(D)?D.value=x:null),visible:e(ne),form:{columns:e(se),rules:e(re),labelPosition:"right",labelSuffix:""},size:e(a),closeOnClickModal:!0,title:e(ae)>0?"编辑委托":"新建委托",confirmText:"提交",cancelText:"取消",onConfirm:e(ue),onCancel:e(ce)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"]),l(Je,{modelValue:o.value,"onUpdate:modelValue":d[4]||(d[4]=x=>o.value=x),options:_.value},null,8,["modelValue","options"])])}}}),ct=X(lt,[["__scopeId","data-v-6e500416"]]);export{ct as default};
