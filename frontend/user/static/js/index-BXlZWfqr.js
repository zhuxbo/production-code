var te=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var z=(r,t,o)=>t in r?te(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,M=(r,t)=>{for(var o in t||(t={}))se.call(t,o)&&z(r,o,t[o]);if(U)for(var o of U(t))ne.call(t,o)&&z(r,o,t[o]);return r},N=(r,t)=>oe(r,ae(t));var F=(r,t,o)=>new Promise((w,d)=>{var x=p=>{try{m(o.next(p))}catch(f){d(f)}},C=p=>{try{m(o.throw(p))}catch(f){d(f)}},m=p=>p.done?w(p.value):Promise.resolve(p.value).then(x,C);m((o=o.apply(r,t)).next())});import{G as le,c as $,o as I,f as n,d as ie,l as b,u as re,s as ue,m as ce,dY as de,V as q,v as pe,r as g,b as me,g as a,e as s,x as fe,i as _e,a8 as ve,t as he,j as i,B as T,h as y,w as A,$ as ge,dZ as ye,F as we,aC as P,aA as xe,T as j,d_ as O,R as W,y as k,aa as S,ar as be,_ as ke}from"./index-BbKmpnH2.js";import{b as Ve,i as Ce,M as V,L as Te}from"./lock-fill-DhBZpoLD.js";import{l as De}from"./rule-Bz1qTgLo.js";import{f as Re,a as Me,u as Se,b as Ie,d as Be}from"./dark-BoH-6Gf2.js";import{u as Y}from"./hooks-DO_min2U.js";import{U as Ee}from"./user-3-fill-SpX5a9uq.js";import"./epTheme-C14ZT3_d.js";const Le={viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ue(r,t){return I(),$("svg",Le,t[0]||(t[0]=[n("path",{fill:"currentColor",d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16M11 7h2v2h-2zm0 4h2v6h-2z"},null,-1)]))}const ze=le({name:"ri-information-line",render:Ue}),Ne={class:"select-none"},Fe=["src"],qe={class:"flex-c absolute right-5 top-3"},Ae={class:"login-container"},Pe={class:"img"},je={class:"login-box"},Oe={class:"login-form"},We={class:"outline-none"},Ye={class:"w-full h-[20px] flex justify-between items-center"},$e={class:"flex"},Ge={class:"w-full h-[20px] flex justify-between items-center"},He={class:"w-full flex-c absolute bottom-3 text-sm text-[rgba(0,0,0,0.6)] dark:text-[rgba(220,220,242,0.8)]"},Qe={class:"hover:text-primary",href:"/",target:"_blank"},Ze={class:"hover:text-primary",href:"https://beian.miit.gov.cn/",target:"_blank"},Je=ie({name:"Login",__name:"index",setup(r){const t=b(7),o=re(),w=ue(),d=b(!1),x=b(!1),C=b(!1),m=b(),{initStorage:p}=Re();p();const{dataTheme:f,overallStyle:G,dataThemeChange:B}=Me();B(G.value);const{title:E}=Se(),_=ce({account:"",password:""}),H=()=>F(null,null,function*(){const l=w.query.auto_token;if(l){d.value=!0;try{const e=new Date(Date.now()+72e5),v={access_token:l,refresh_token:"",expires_in:e,username:"",balance:"0.00",roles:[],permissions:[]};P(v);const u=yield xe();if((u==null?void 0:u.code)===1&&u.data){const D=N(M({},v),{username:u.data.username||"",balance:u.data.balance||"0.00",roles:u.data.roles||[],permissions:u.data.permissions||[]});P(D)}j().handleWholeMenus([]),O();const h=M({},w.query);delete h.auto_token,yield o.replace({path:w.path,query:h}),o.push(W(!0).path),k("管理员代理登录成功",{type:"success"})}catch(e){k("自动登录失败，请手动登录",{type:"error"})}finally{d.value=!1}}}),L=l=>{l&&l.validate().then(e=>{e&&(d.value=!0,S().loginByAccount({account:_.account,password:_.password}).then(v=>{v.code===1?(j().handleWholeMenus([]),O(),o.push(W(!0).path),k("登录成功",{type:"success"})):k(v.msg,{type:"error"})}).catch(()=>{k("登录失败",{type:"error"})}).finally(()=>{d.value=!1}))})},Q=()=>{o.push("/register")},Z=()=>{o.push("/reset-password")},J=be(l=>L(l),1e3,!0);return de(document,"keypress",({code:l})=>{["Enter","NumpadEnter"].includes(l)&&!C.value&&!d.value&&J(m.value)}),q(x,l=>{S().SET_ISREMEMBERED(l)}),q(t,l=>{S().SET_LOGINDAY(l)}),pe(()=>{H()}),(l,e)=>{const v=g("el-switch"),u=g("el-input"),h=g("el-form-item"),D=g("IconifyIconOffline"),K=g("el-checkbox"),R=g("el-button"),X=g("el-form"),ee=me("tippy");return I(),$("div",Ne,[n("img",{src:a(Ve),class:"wave"},null,8,Fe),n("div",qe,[s(v,{modelValue:a(f),"onUpdate:modelValue":e[0]||(e[0]=c=>fe(f)?f.value=c:null),"inline-prompt":"","active-icon":a(Be),"inactive-icon":a(Ie),onChange:a(B)},null,8,["modelValue","active-icon","inactive-icon","onChange"])]),n("div",Ae,[n("div",Pe,[(I(),_e(ve(he(a(Ce)))))]),n("div",je,[n("div",Oe,[s(a(V),{delay:300},{default:i(()=>[n("h2",We,T(a(E)),1)]),_:1}),s(X,{ref_key:"ruleFormRef",ref:m,model:_,rules:a(De),size:"large"},{default:i(()=>[s(a(V),{delay:100},{default:i(()=>[s(h,{rules:[{required:!0,message:"请输入用户名/邮箱/手机号",trigger:"blur"}],prop:"account"},{default:i(()=>[s(u,{modelValue:_.account,"onUpdate:modelValue":e[1]||(e[1]=c=>_.account=c),clearable:"",placeholder:"用户名/邮箱/手机号","prefix-icon":a(Y)(a(Ee))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),s(a(V),{delay:150},{default:i(()=>[s(h,{prop:"password"},{default:i(()=>[s(u,{modelValue:_.password,"onUpdate:modelValue":e[2]||(e[2]=c=>_.password=c),clearable:"","show-password":"",placeholder:"密码","prefix-icon":a(Y)(a(Te))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),s(a(V),{delay:250},{default:i(()=>[s(h,null,{default:i(()=>[n("div",Ye,[s(K,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=c=>x.value=c)},{default:i(()=>[n("span",$e,[e[7]||(e[7]=y(" 记住我 ")),A(n("select",{"onUpdate:modelValue":e[3]||(e[3]=c=>t.value=c),style:ge({width:t.value<10?"10px":"16px",outline:"none",background:"none",appearance:"none",marginLeft:"5px"})},e[6]||(e[6]=[n("option",{value:"1"},"1",-1),n("option",{value:"7"},"7",-1),n("option",{value:"30"},"30",-1)]),4),[[ye,t.value]]),e[8]||(e[8]=y(" 天 ")),A(s(D,{icon:a(ze),class:"ml-1"},null,8,["icon"]),[[ee,{content:"登录信息保存天数",placement:"top"}]])])]),_:1},8,["modelValue"]),s(R,{link:"",type:"primary",onClick:Z},{default:i(()=>e[9]||(e[9]=[y(" 忘记密码？ ")])),_:1})]),s(R,{class:"w-full mt-4!",size:"default",type:"primary",loading:d.value,disabled:C.value,onClick:e[5]||(e[5]=c=>L(m.value))},{default:i(()=>e[10]||(e[10]=[y(" 登录 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1}),s(a(V),{delay:300},{default:i(()=>[s(h,null,{default:i(()=>[n("div",Ge,[s(R,{class:"w-full mt-4",size:"default",onClick:Q},{default:i(()=>e[11]||(e[11]=[y(" 注册 ")])),_:1})])]),_:1})]),_:1})]),_:1},8,["model","rules"])])])]),n("div",He,[y(" Copyright © 2017-"+T(new Date().getFullYear())+" ",1),n("a",Qe,"  "+T(a(E)),1),n("a",Ze,"  "+T(a(we)("Beian")),1)])])}}}),lt=ke(Je,[["__scopeId","data-v-cb1e9a67"]]);export{lt as default};
