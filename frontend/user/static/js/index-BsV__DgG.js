var T=Object.defineProperty,v=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(t,a,n)=>a in t?T(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,b=(t,a)=>{for(var n in a||(a={}))k.call(a,n)&&x(t,n,a[n]);if(S)for(var n of S(a))D.call(a,n)&&x(t,n,a[n]);return t},C=(t,a)=>v(t,w(a));import{e as Y,r as h,f as M,t as V,n as B,g as F,k as u,l as m,z as N,M as U,j as E,p as H,C as j,F as I,v as L,y as O,G as r,H as W,x as q,P as A,_ as G}from"./index-D5efkW8k.js";import{c as $,g as J}from"./utils-BPqdEplT.js";import{P as K}from"./plus-search-Cl3d-rfH.js";import"./index-CsaBZZ8X.js";function Q(t){return Y.get("/transaction",{params:t})}function X(t){const a=h({}),n=h([]),e=h(!0),o=M({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function i(c){o.pageSize=c,d()}function p(c){o.currentPage=c,d()}function d(){e.value=!0;const c=C(b({},V(a.value)),{pageSize:o.pageSize,currentPage:o.currentPage});c.created_at&&(c.created_at=$(c.created_at)),Q(c).then(({data:f})=>{n.value=f.items,o.total=f.total,o.pageSize=f.pageSize,o.currentPage=f.currentPage,B(()=>{t.value&&t.value.getTableRef().clearSelection()})}).finally(()=>{e.value=!1})}return{loading:e,search:a,dataList:n,pagination:o,handleSizeChange:i,handleCurrentChange:p,onSearch:d,onReset:()=>{d()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const y=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"},{label:"订单",value:"order"},{label:"取消",value:"cancel"}],Z={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger",order:"primary",cancel:"danger"};function ee(t){const a=F(()=>{t()},500);return{searchColumns:[{label:"交易类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择交易类型"},options:y,onChange:()=>{a()}},{label:"交易单号",prop:"transaction_id",valueType:"input",fieldProps:{placeholder:"请输入交易单号"}},{label:"金额",prop:"amount",renderField:(e,o)=>{var p,d;const i=(s,l)=>{s!==void 0&&l!==void 0&&s>l||o([s,l])};return u("div",{class:"flex items-center gap-2 w-full"},[u(m("el-input"),{class:"flex-1",modelValue:(p=e==null?void 0:e[0])==null?void 0:p.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);i(l,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),u("span",{class:"flex-none"},[N("至")]),u(m("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[1])==null?void 0:d.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);i(e==null?void 0:e[0],l)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:J()}}]}}function ae(){const t=U();return{tableRef:h(),tableColumns:[{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:o})=>u(m("el-tag"),{size:o.size,type:Z[e.type],effect:"plain"},{default:()=>{var i;return[(i=y.find(p=>p.value===e.type))==null?void 0:i.label]}})},{label:"单号",prop:"transaction_id",minWidth:150,cellRenderer:({row:e})=>u("span",{class:"cursor-pointer",onClick:()=>{t.push({path:["order","cancel"].includes(e.type)?"/order":"/funds",query:{id:e.transaction_id}})}},[e.transaction_id])},{label:"交易金额",prop:"amount",width:100},{label:"交易前余额",prop:"balance_before",width:100},{label:"交易后余额",prop:"balance_after",width:100},{label:"备注",prop:"remark",minWidth:150},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?E(e).format("YYYY-MM-DD HH:mm:ss"):"-"}]}}const te={class:"main"},ne={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=H({name:"Transaction",__name:"index",setup(t){const{tableRef:a,tableColumns:n}=ae(),{loading:e,search:o,dataList:i,pagination:p,handleSizeChange:d,handleCurrentChange:s,onSearch:l,onReset:c,onCollapse:f}=X(a),{searchColumns:P}=ee(()=>l());return j(()=>{l()}),(re,_)=>{const R=m("pure-table");return L(),I("div",te,[O("div",ne,[u(r(K),{modelValue:r(o),"onUpdate:modelValue":_[0]||(_[0]=g=>W(o)?o.value=g:null),columns:r(P),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:r(l),onReset:r(c),onCollapse:r(f)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),u(r(A),{title:"交易记录",columns:r(n),onRefresh:r(l)},{default:q(({size:g,dynamicColumns:z})=>[u(R,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:r(e),size:g,adaptive:"",adaptiveConfig:{offsetBottom:108},data:r(i),columns:z,pagination:C(b({},r(p)),{size:g}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:r(d),onPageCurrentChange:r(s)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),ue=G(oe,[["__scopeId","data-v-715dcf1f"]]);export{ue as default};
