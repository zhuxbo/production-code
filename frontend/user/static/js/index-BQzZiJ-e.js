var ae=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var O=(e,o,i)=>o in e?ae(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,F=(e,o)=>{for(var i in o||(o={}))ie.call(o,i)&&O(e,i,o[i]);if(A)for(var i of A(o))ue.call(o,i)&&O(e,i,o[i]);return e},I=(e,o)=>re(e,se(o));import{P as ce,a as pe}from"./plus-search-c0Rc60Ks.js";import{k as x,l as g,m as de,y as U,t as me,n as fe,p as ge,e as d,r as _,h as P,z as he,q as be,d as ve,s as Ce,v as ye,b as Se,c as $,o as T,f as B,g as t,x as q,j as b,w as _e,A as V,B as xe,i as E,_ as ke}from"./index-BYBE9pGo.js";import{c as we,g as Pe,p as ze}from"./datePicker-C0_iRNu5.js";import{u as Re}from"./hooks-Drv9A1do.js";import{u as Te,P as De}from"./drawer-a97W_P1s.js";import{C as Fe}from"./close-bold-D4F-SjRX.js";import"./epTheme-D65YeBaY.js";import"./index-BrX6sF8q.js";function Ie(e){return x.get("/invoice",{params:e})}const j={amount:0,organization:"",taxation:"",remark:"",email:""},Be=Object.keys(j);function Ve(e){return x.post("/invoice",{data:e})}function Me(e,o){return x.put(`/invoice/${e}`,{data:o})}function Ne(e){return x.get(`/invoice/${e}`)}function Ye(e){return x.delete(`/invoice/${e}`)}function Ae(e){return x.delete("/invoice/batch",{data:{ids:e}})}function Oe(e){const o=g({}),i=g([]),n=g(!0),a=de({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function m(l){a.pageSize=l,h()}function v(l){a.currentPage=l,h()}const r=g(!1),s=g(0),u=l=>{r.value=!0,l?s.value=l:s.value=0},p=l=>{Ye(l).then(()=>{U("删除成功",{type:"success"}),h()})},S=l=>{Ae(l).then(()=>{U("删除成功",{type:"success"}),h()})};function h(){n.value=!0;const l=I(F({},me(o.value)),{pageSize:a.pageSize,currentPage:a.currentPage});l.created_at&&(l.created_at=we(l.created_at)),Ie(l).then(({data:f})=>{i.value=f.items,a.total=f.total,a.pageSize=f.pageSize,a.currentPage=f.currentPage,fe(()=>{e.value&&e.value.getTableRef().clearSelection()})}).finally(()=>{n.value=!1})}return{loading:n,search:o,dataList:i,pagination:a,handleSizeChange:m,handleCurrentChange:v,onSearch:h,onReset:()=>{h()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},showStore:r,updateId:s,handleStore:u,handleDestroy:p,handleBatchDestroy:S}}function Ue(e){const o=ge(()=>{e()},500);return{searchColumns:[{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"组织/邮箱/备注"},onChange:()=>{o()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},options:[{label:"处理中",value:0},{label:"已开票",value:1},{label:"已作废",value:2}],onChange:()=>{o()}},{label:"组织",prop:"organization",valueType:"input",fieldProps:{placeholder:"请输入组织名称"}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱"}},{label:"金额",prop:"amount",renderField:(n,a)=>{var v,r;const m=(s,u)=>{s!==void 0&&u!==void 0&&s>u||a([s,u])};return d("div",{class:"flex items-center gap-2 w-full"},[d(_("el-input"),{class:"flex-1",modelValue:(v=n==null?void 0:n[0])==null?void 0:v.toString(),"onUpdate:modelValue":s=>{const u=s===""?void 0:Number(s);m(u,n==null?void 0:n[1])},placeholder:"最小金额",clearable:!0},null),d("span",{class:"flex-none"},[P("至")]),d(_("el-input"),{class:"flex-1",modelValue:(r=n==null?void 0:n[1])==null?void 0:r.toString(),"onUpdate:modelValue":s=>{const u=s===""?void 0:Number(s);m(n==null?void 0:n[0],u)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:Pe()}}]}}function $e(e){const o=g(!1),i=g(),n=g(0),a=g({}),m=he(()=>n.value>0),v=[{label:"组织",prop:"organization",valueType:"input",fieldProps:{placeholder:"请输入组织名称",get disabled(){return m.value}}},{label:"金额",prop:"amount",valueType:"input-number",fieldProps:{placeholder:"请输入金额",min:0,precision:2,controlsPosition:"right",get disabled(){return m.value}}},{label:"税号",prop:"taxation",valueType:"input",fieldProps:{placeholder:"请输入税号",get disabled(){return m.value}}},{label:"邮箱",prop:"email",valueType:"input",fieldProps:{placeholder:"请输入邮箱",get disabled(){return m.value}}},{label:"备注",prop:"remark",valueType:"textarea",fieldProps:{placeholder:"请输入备注",rows:3}}],r={amount:[{required:!0,message:"请输入金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur"}],organization:[{required:!0,message:"请输入组织名称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]};function s(C=0){var l,f;o.value=!0,C>0?n.value!==C&&S(C):((f=(l=i.value)==null?void 0:l.formInstance)==null||f.resetFields(),a.value=Object.fromEntries(Object.entries(j).filter(([M,R])=>R!==0&&R!==""))),n.value=C}function u(){n.value>0?z():h()}function p(){o.value=!1}const S=C=>{Ne(C).then(({data:l})=>{var f;a.value=ze(l,Be),a.value.amount=Number((f=a.value.amount)!=null?f:0)})},h=()=>{Ve(a.value).then(()=>{e(),o.value=!1})},z=()=>{Me(n.value,a.value).then(()=>{e(),o.value=!1})};return{showStore:o,storeRef:i,storeId:n,storeValues:a,storeColumns:v,rules:r,openStoreForm:s,confirmStoreForm:u,closeStoreForm:p}}function qe(){const e=g(),o=g([]),i=r=>{o.value=r.map(s=>s.id),e.value.setAdaptive()},n=()=>{var r;(r=e.value)==null||r.getTableRef().clearSelection()},a={0:{label:"处理中",type:"primary"},1:{label:"已开票",type:"success"},2:{label:"已作废",type:"danger"}};return{tableRef:e,selectedIds:o,tableColumns:[{label:"勾选列",type:"selection",reserveSelection:!0},{label:"ID",prop:"id",width:130},{label:"组织",prop:"organization",minWidth:150},{label:"金额",prop:"amount",width:100},{label:"邮箱",prop:"email",minWidth:150},{label:"备注",prop:"remark",minWidth:150},{label:"状态",prop:"status",width:100,cellRenderer:({row:r,props:s})=>{var u;return d(_("el-tag"),{size:s.size,type:(u=a[r.status])==null?void 0:u.type,effect:"plain"},{default:()=>{var p;return[(p=a[r.status])==null?void 0:p.label]}})}},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:r})=>r?be(r).format("YYYY-MM-DD HH:mm:ss"):"-"},{label:"操作",fixed:"right",width:110,slot:"operation"}],handleSelectionChange:i,handleSelectionCancel:n,handleRowClick:(r,s,u)=>{var S;const p=u.target;p.tagName==="BUTTON"||p.closest("button")||p.closest(".el-button")||(S=e.value)==null||S.getTableRef().toggleRowSelection(r)}}}const Ee={class:"main"},je={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Le={key:0,class:"bg-[var(--el-fill-color-light)] w-full h-[46px] mb-2 pl-3 pr-2 flex items-center"},We={class:"flex-auto"},He={style:{"font-size":"var(--el-font-size-base)"},class:"text-[rgba(42,46,54,0.5)] dark:text-[rgba(220,220,242,0.5)] ml-2"},Ke=ve({name:"Invoice",__name:"index",setup(e){const o=Ce(),{drawerSize:i}=Te(),{tableRef:n,selectedIds:a,handleSelectionChange:m,handleSelectionCancel:v,tableColumns:r,handleRowClick:s}=qe(),{loading:u,search:p,dataList:S,pagination:h,handleSizeChange:z,handleCurrentChange:C,onSearch:l,onReset:f,onCollapse:M,handleDestroy:R,handleBatchDestroy:L}=Oe(n),{searchColumns:W}=Ue(()=>l()),{storeRef:H,showStore:K,storeId:G,storeColumns:J,rules:Q,storeValues:D,openStoreForm:N,confirmStoreForm:X,closeStoreForm:Z}=$e(()=>l());return ye(()=>{o.query.id&&(p.value.id=Number(o.query.id)),l()}),(Ge,c)=>{const k=_("el-button"),ee=_("el-tooltip"),Y=_("el-popconfirm"),te=_("pure-table"),oe=Se("motion-fade");return T(),$("div",Ee,[B("div",je,[d(t(ce),{modelValue:t(p),"onUpdate:modelValue":c[0]||(c[0]=y=>q(p)?p.value=y:null),columns:t(W),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:t(l),onReset:t(f),onCollapse:t(M)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),d(t(pe),{title:"发票管理",columns:t(r),onRefresh:t(l)},{buttons:b(()=>[d(k,{type:"primary",onClick:c[1]||(c[1]=y=>t(N)())},{default:b(()=>c[4]||(c[4]=[P("新增发票")])),_:1})]),default:b(({size:y,dynamicColumns:ne})=>[t(a).length>0?_e((T(),$("div",Le,[B("div",We,[d(ee,{placement:"top",content:"取消选择"},{default:b(()=>[d(k,{type:"primary",size:"small",class:"!w-[15px] !p-0 !h-[15px] !rounded-[3px]",icon:t(Re)(t(Fe)),onClick:t(v)},null,8,["icon","onClick"])]),_:1}),B("span",He," 已选 "+xe(t(a).length)+" 项 ",1)]),d(Y,{title:"确定要删除吗？",width:"160px",onConfirm:c[2]||(c[2]=w=>t(L)(t(a)))},{reference:b(()=>[d(k,{type:"danger",size:"small"},{default:b(()=>c[5]||(c[5]=[P(" 批量删除 ")])),_:1})]),_:1})])),[[oe]]):V("",!0),d(te,{ref_key:"tableRef",ref:n,"row-key":"id","align-whole":"left","table-layout":"auto",loading:t(u),size:y,adaptive:"",adaptiveConfig:{offsetBottom:108},data:t(S),columns:ne,pagination:I(F({},t(h)),{size:y}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onRowClick:t(s),onSelectionChange:t(m),onPageSizeChange:t(z),onPageCurrentChange:t(C)},{operation:b(({row:w})=>[w.status!==2?(T(),E(k,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:le=>t(N)(w.id)},{default:b(()=>c[6]||(c[6]=[P(" 编辑 ")])),_:2},1032,["size","onClick"])):V("",!0),w.status===0?(T(),E(Y,{key:1,title:"确定要删除吗？",width:"160px",onConfirm:le=>t(R)(w.id)},{reference:b(()=>[d(k,{class:"reset-margin !outline-none",link:"",type:"danger",size:y},{default:b(()=>c[7]||(c[7]=[P(" 删除 ")])),_:2},1032,["size"])]),_:2},1032,["onConfirm"])):V("",!0)]),_:2},1032,["loading","size","data","columns","pagination","onRowClick","onSelectionChange","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),d(t(De),{ref_key:"storeRef",ref:H,modelValue:t(D),"onUpdate:modelValue":c[3]||(c[3]=y=>q(D)?D.value=y:null),visible:t(K),form:{columns:t(J),rules:t(Q),labelPosition:"right",labelSuffix:""},size:t(i),closeOnClickModal:!0,title:t(G)>0?"编辑发票":"新增发票",confirmText:"提交",cancelText:"取消",onConfirm:t(X),onCancel:t(Z)},null,8,["modelValue","visible","form","size","title","onConfirm","onCancel"])])}}}),at=ke(Ke,[["__scopeId","data-v-f288d336"]]);export{at as default};
