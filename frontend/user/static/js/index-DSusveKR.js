var Q=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var D=(n,a,e)=>a in n?Q(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,V=(n,a)=>{for(var e in a||(a={}))ee.call(a,e)&&D(n,e,a[e]);if(U)for(var e of U(a))ae.call(a,e)&&D(n,e,a[e]);return n},B=(n,a)=>Y(n,Z(a));var L=(n,a,e)=>new Promise((t,l)=>{var r=d=>{try{c(e.next(d))}catch(_){l(_)}},s=d=>{try{c(e.throw(d))}catch(_){l(_)}},c=d=>d.done?t(d.value):Promise.resolve(d.value).then(r,s);c((e=e.apply(n,a)).next())});import{P as le,a as te}from"./plus-search-DoXnYYhQ.js";import{i as ne,b as O,e as N,c as q,n as M,a as F,d as oe}from"./product-DDJsCcgs.js";import{l as b,m as re,z as A,ab as W,t as ie,n as se,p as pe,e as o,r as v,aF as ue,aX as de,d as j,V as ce,i as I,o as x,j as m,c as G,a0 as me,a1 as ve,g as u,f as X,h as k,B as fe,a_ as E,v as _e,x as ge,A as be,a$ as he,_ as ye}from"./index-CSl49lHz.js";import"./epTheme-CPPtk6jk.js";import"./index---6W8y0y.js";function Ce(n){const a=b({}),e=b([]),t=b(!0),l=re({total:0,pageSize:100,currentPage:1,background:!0,pageSizes:[10,20,50,100],hideOnSinglePage:!0}),r=A(()=>l.total<=l.pageSize);function s(i){l.pageSize=i,d()}function c(i){l.currentPage=i,d()}function d(){t.value=!0;const i=B(V({},ie(a.value)),{pageSize:l.pageSize,currentPage:l.currentPage});ne(i).then(({data:h})=>{e.value=h.items,l.total=h.total,l.pageSize=h.pageSize,l.currentPage=h.currentPage,se(()=>{n.value&&n.value.getTableRef().clearSelection()})}).finally(()=>{t.value=!1})}function _(i){W.push({name:"Order",query:{product_id:i.id,type:"apply"}})}function p(i){W.push({name:"Order",query:{product_id:i.id,type:"batchApply"}})}return{loading:t,search:a,dataList:e,pagination:l,isSinglePage:r,handleSizeChange:s,handleCurrentChange:c,onSearch:d,handleApply:_,handleBatchApply:p}}const w=(n,a)=>(e,t)=>{const l=b(e),r=s=>{l.value===s?(l.value=void 0,t(void 0)):(l.value=s,t(s))};return o("div",{class:"flex flex-wrap gap-1 items-center"},[o("div",{class:"flex flex-wrap gap-1"},[n.map(s=>o(v("el-button"),{key:s.value,type:l.value===s.value?"primary":"default",onClick:()=>r(s.value),class:"ml-3 w-28"},{default:()=>[s.label]}))]),(a==null?void 0:a.showToggleButton)&&o(v("el-button"),{type:"primary",link:!0,onClick:a.onToggle,class:"ml-3 flex items-center whitespace-nowrap text-base"},{default:()=>[o(v("el-icon"),{class:"mr-1"},{default:()=>[a.collapsed?o(ue,null,null):o(de,null,null)]}),a.collapsed?"展开":"收起"]})])},xe=n=>{const a=pe(()=>{n()},500),e=b(!0),t=()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},l=()=>{e.value=!e.value,t()};return{searchColumns:A(()=>[{label:"证书品牌",prop:"brand",valueType:"radio",options:O,renderField:w(O,{showToggleButton:!0,onToggle:l,collapsed:e.value})},{label:"加密标准",prop:"encryption_standard",valueType:"radio",options:N,renderField:w(N),hideInSearch:e.value},{label:"验证类型",prop:"validation_type",valueType:"radio",options:q,renderField:w(q),hideInSearch:e.value},{label:"域名类型",prop:"name_type",valueType:"radio",options:M,renderField:w(M),hideInSearch:e.value},{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"编码/名称/备注",clearable:!0,style:{width:"240px"},class:"ml-3"},hideInSearch:e.value}]),debouncedSearch:a}},Se=()=>({tableRef:b(),tableColumns:[{label:"名称",prop:"name",minWidth:150},{label:"说明",prop:"remark",minWidth:150},{label:"价格",prop:"price.price",width:100,formatter(e){var t;return(t=e.price)!=null&&t.price&&e.price.price!=="0.00"?parseFloat(e.price.price)+"/"+F[e.price.period]:"-"}},{label:"附加标准域名价格",prop:"price.alternative_standard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_standard_price&&e.price.alternative_standard_price!=="0.00"?parseFloat(e.price.alternative_standard_price)+"/"+F[e.price.period]:"-"}},{label:"附加通配符价格",prop:"price.alternative_wildcard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_wildcard_price&&e.price.alternative_wildcard_price!=="0.00"?parseFloat(e.price.alternative_wildcard_price)+"/"+F[e.price.period]:"-"}},{label:"操作",slot:"operation",width:110,fixed:"right"}]}),we={class:"dialog-footer"},ke=j({__name:"export",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(n,{emit:a}){const e=n,t=a,l=A({get:()=>e.visible,set:p=>t("update:visible",p)}),r=b({brands:[],priceRate:1}),s=()=>{r.value={brands:[],priceRate:1}},c=b(!1),d=()=>L(null,null,function*(){if(!c.value){if(r.value.priceRate<=0){E.error("价格倍率必须大于0");return}c.value=!0;try{const p={};r.value.brands.length>0&&(p.brands=r.value.brands),r.value.priceRate!==1&&(p.priceRate=r.value.priceRate),yield oe(p),E.success("导出成功"),l.value=!1}catch(p){console.error("导出失败:",p),E.error(p.message||"导出失败")}finally{c.value=!1}}}),_=()=>{l.value=!1,s()};return ce(()=>e.visible,p=>{p&&s()}),(p,i)=>{const h=v("el-option"),P=v("el-select"),S=v("el-form-item"),C=v("el-input-number"),z=v("el-form"),R=v("el-button"),g=v("el-dialog");return x(),I(g,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=f=>l.value=f),title:"导出产品价格",width:"500px","destroy-on-close":"",onClose:_},{footer:m(()=>[X("div",we,[o(R,{onClick:_},{default:m(()=>i[3]||(i[3]=[k("取消")])),_:1}),o(R,{type:"primary",loading:c.value,onClick:d},{default:m(()=>[k(fe(c.value?"导出中...":"导出"),1)]),_:1},8,["loading"])])]),default:m(()=>[o(z,{model:r.value,"label-width":"120px","label-position":"right"},{default:m(()=>[o(S,{label:"品牌筛选"},{default:m(()=>[o(P,{modelValue:r.value.brands,"onUpdate:modelValue":i[0]||(i[0]=f=>r.value.brands=f),multiple:"",placeholder:"选择品牌（不选择则导出所有品牌）",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":""},{default:m(()=>[(x(!0),G(me,null,ve(u(O),f=>(x(),I(h,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(S,{label:"价格倍率"},{default:m(()=>[o(C,{modelValue:r.value.priceRate,"onUpdate:modelValue":i[1]||(i[1]=f=>r.value.priceRate=f),min:.01,max:1e3,step:.1,precision:2,style:{width:"100%"},placeholder:"输入价格倍率"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),Pe={class:"main"},ze={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Re=j({name:"Product",__name:"index",setup(n){const{tableRef:a,tableColumns:e}=Se(),{loading:t,search:l,dataList:r,pagination:s,isSinglePage:c,handleSizeChange:d,handleCurrentChange:_,onSearch:p,handleApply:i,handleBatchApply:h}=Ce(a),{searchColumns:P,debouncedSearch:S}=xe(()=>p()),C=b(!1),z=()=>{C.value=!0};return _e(()=>{p()}),(R,g)=>{const f=v("ElDivider"),$=v("el-button"),H=v("pure-table");return x(),G("div",Pe,[X("div",ze,[o(u(le),{modelValue:u(l),"onUpdate:modelValue":g[0]||(g[0]=y=>ge(l)?l.value=y:null),columns:u(P),"show-number":6,"col-props":{xs:24,sm:24,md:24,lg:24,xl:24},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:u(S)},null,8,["modelValue","columns","onChange"])]),o(u(te),{title:"产品列表",columns:u(e),onRefresh:u(p)},{buttons:m(()=>[o(u(he),{icon:"ri/download-2-line",style:{cursor:"pointer"},onClick:z}),o(f,{direction:"vertical",style:{"margin-right":"-8px"}})]),default:m(({size:y,dynamicColumns:J})=>[o(H,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:u(t),size:y,adaptive:"",adaptiveConfig:{offsetBottom:u(c)?44:108},data:u(r),columns:J,pagination:B(V({},u(s)),{size:y}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:u(d),onPageCurrentChange:u(_)},{operation:m(({row:T})=>[o($,{class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:K=>u(i)(T)},{default:m(()=>g[2]||(g[2]=[k(" 申请 ")])),_:2},1032,["size","onClick"]),T.alternative_name_types.length?be("",!0):(x(),I($,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:K=>u(h)(T)},{default:m(()=>g[3]||(g[3]=[k(" 批量 ")])),_:2},1032,["size","onClick"]))]),_:2},1032,["loading","size","adaptiveConfig","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),o(ke,{visible:C.value,"onUpdate:visible":g[1]||(g[1]=y=>C.value=y)},null,8,["visible"])])}}}),Ie=ye(Re,[["__scopeId","data-v-d6528e1a"]]);export{Ie as default};
