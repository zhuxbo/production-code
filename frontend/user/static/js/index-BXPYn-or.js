var R=Object.defineProperty,z=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var x=(n,t,a)=>t in n?R(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,b=(n,t)=>{for(var a in t||(t={}))D.call(t,a)&&x(n,a,t[a]);if(S)for(var a of S(t))T.call(t,a)&&x(n,a,t[a]);return n},C=(n,t)=>z(n,k(t));import{P as I,a as L}from"./plus-search-CaYI7AXO.js";import{k as Y,l as h,m as M,t as V,n as B,p as N,e as d,r as g,h as F,u as U,q as E,d as j,v as q,c as H,o as O,f as A,g as l,x as W,j as $,_ as G}from"./index-pXbp6I31.js";import{c as J,g as K}from"./datePicker-BhIGl5S_.js";import"./epTheme-CzJPEQWF.js";import"./index-LuNR5-cT.js";function Q(n){return Y.get("/invoice-limit",{params:n})}function X(n){const t=h({}),a=h([]),e=h(!0),o=M({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function c(i){o.pageSize=i,u()}function p(i){o.currentPage=i,u()}function u(){e.value=!0;const i=C(b({},V(t.value)),{pageSize:o.pageSize,currentPage:o.currentPage});i.created_at&&(i.created_at=J(i.created_at)),Q(i).then(({data:m})=>{a.value=m.items,o.total=m.total,o.pageSize=m.pageSize,o.currentPage=m.currentPage,B(()=>{n.value&&n.value.getTableRef().clearSelection()})}).finally(()=>{e.value=!1})}return{loading:e,search:t,dataList:a,pagination:o,handleSizeChange:c,handleCurrentChange:p,onSearch:u,onReset:()=>{u()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const v=[{label:"开票",value:"issue"},{label:"作废",value:"void"},{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"}],Z={issue:"success",void:"danger",addfunds:"primary",refunds:"warning"};function ee(n){const t=N(()=>{n()},500);return{searchColumns:[{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型"},options:v,onChange:()=>{t()}},{label:"限额ID",prop:"limit_id",valueType:"input",fieldProps:{placeholder:"请输入限额ID"}},{label:"金额",prop:"amount",renderField:(e,o)=>{var p,u;const c=(s,r)=>{s!==void 0&&r!==void 0&&s>r||o([s,r])};return d("div",{class:"flex items-center gap-2 w-full"},[d(g("el-input"),{class:"flex-1",modelValue:(p=e==null?void 0:e[0])==null?void 0:p.toString(),"onUpdate:modelValue":s=>{const r=s===""?void 0:Number(s);c(r,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),d("span",{class:"flex-none"},[F("至")]),d(g("el-input"),{class:"flex-1",modelValue:(u=e==null?void 0:e[1])==null?void 0:u.toString(),"onUpdate:modelValue":s=>{const r=s===""?void 0:Number(s);c(e==null?void 0:e[0],r)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:K()}}]}}function te(){const n=h(),t=U();return{tableRef:n,tableColumns:[{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:o})=>d(g("el-tag"),{size:o.size,type:Z[e.type],effect:"plain"},{default:()=>{var c;return[(c=v.find(p=>p.value===e.type))==null?void 0:c.label]}})},{label:"限额ID",prop:"limit_id",minWidth:100,cellRenderer:({row:e})=>d("span",{class:"cursor-pointer",onClick:()=>{t.push({path:["addfunds","refunds"].includes(e.type)?"/funds":"/invoice",query:{id:e.limit_id}})}},[e.limit_id])},{label:"金额",prop:"amount",width:100},{label:"操作前",prop:"limit_before",width:100},{label:"操作后",prop:"limit_after",width:100},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?E(e).format("YYYY-MM-DD HH:mm:ss"):"-"}]}}const ne={class:"main"},ae={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=j({name:"InvoiceLimit",__name:"index",setup(n){const{tableRef:t,tableColumns:a}=te(),{loading:e,search:o,dataList:c,pagination:p,handleSizeChange:u,handleCurrentChange:s,onSearch:r,onReset:i,onCollapse:m}=X(t),{searchColumns:y}=ee(()=>r());return q(()=>{r()}),(le,_)=>{const P=g("pure-table");return O(),H("div",ne,[A("div",ae,[d(l(I),{modelValue:l(o),"onUpdate:modelValue":_[0]||(_[0]=f=>W(o)?o.value=f:null),columns:l(y),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:l(r),onReset:l(i),onCollapse:l(m)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),d(l(L),{title:"发票额度",columns:l(a),onRefresh:l(r)},{default:$(({size:f,dynamicColumns:w})=>[d(P,{ref_key:"tableRef",ref:t,"row-key":"id","align-whole":"left","table-layout":"auto",loading:l(e),size:f,adaptive:"",adaptiveConfig:{offsetBottom:108},data:l(c),columns:w,pagination:C(b({},l(p)),{size:f}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:l(u),onPageCurrentChange:l(s)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),pe=G(oe,[["__scopeId","data-v-4ac5ddb2"]]);export{pe as default};
