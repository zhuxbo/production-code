var j=Object.defineProperty,q=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var P=(o,t,e)=>t in o?j(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,_=(o,t)=>{for(var e in t||(t={}))E.call(t,e)&&P(o,e,t[e]);if(S)for(var e of S(t))I.call(t,e)&&P(o,e,t[e]);return o},C=(o,t)=>q(o,O(t));var x=(o,t,e)=>new Promise((a,n)=>{var r=l=>{try{d(e.next(l))}catch(u){n(u)}},i=l=>{try{d(e.throw(l))}catch(u){n(u)}},d=l=>l.done?a(l.value):Promise.resolve(l.value).then(r,i);d((e=e.apply(o,t)).next())});import{P as H,a as L}from"./plus-search-uMH8qge_.js";import{k as R,l as b,m as W,t as A,n as $,p as G,e as p,r as g,h as z,q as J,d as K,s as Q,u as X,v as Z,c as ee,o as ae,f as te,g as s,x as ne,j as v,y as oe,_ as le}from"./index-DUzZWKmS.js";import{c as se,g as re}from"./datePicker-C--aLa8K.js";import{t as w}from"./topUp-lKV1el85.js";import"./epTheme-7SG9GuFz.js";import"./index-BZV1gJK6.js";function ue(o){return R.get("/fund",{params:o})}function de(o){return R.post("/fund/platform-recharge",{data:{tid:o}})}function ie(o){const t=b({}),e=b([]),a=b(!0),n=W({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function r(c){n.pageSize=c,d()}function i(c){n.currentPage=c,d()}function d(){a.value=!0;const c=C(_({},A(t.value)),{pageSize:n.pageSize,currentPage:n.currentPage});c.created_at&&(c.created_at=se(c.created_at)),ue(c).then(({data:f})=>{e.value=f.items,n.total=f.total,n.pageSize=f.pageSize,n.currentPage=f.currentPage,$(()=>{o.value&&o.value.getTableRef().clearSelection()})}).finally(()=>{a.value=!1})}return{loading:a,search:t,dataList:e,pagination:n,handleSizeChange:r,handleCurrentChange:i,onSearch:d,onReset:()=>{d()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const T=[{label:"支付宝",value:"alipay"},{label:"微信",value:"wechat"},{label:"银行卡",value:"credit"},{label:"淘宝",value:"taobao"},{label:"拼多多",value:"pinduoduo"},{label:"京东",value:"jingdong"},{label:"抖音",value:"douyin"},{label:"赠送",value:"gift"},{label:"其他",value:"other"}],k=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"}],D=[{label:"成功",value:1},{label:"已退",value:2}],pe={alipay:"success",wechat:"success",credit:"success",taobao:"primary",pinduoduo:"primary",jingdong:"primary",douyin:"primary",gift:"info",other:"warning"},ce={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger"},fe={1:"success",2:"danger"};function ge(o){const t=G(()=>{o()},500);return{searchColumns:[{label:"类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择类型"},options:k,onChange:()=>{t()}},{label:"状态",prop:"status",valueType:"select",fieldProps:{placeholder:"请选择状态"},options:D,onChange:()=>{t()}},{label:"金额",prop:"amount",renderField:(a,n)=>{var i,d;const r=(l,u)=>{l!==void 0&&u!==void 0&&l>u||n([l,u])};return p("div",{class:"flex items-center gap-2 w-full"},[p(g("el-input"),{class:"flex-1",modelValue:(i=a==null?void 0:a[0])==null?void 0:i.toString(),"onUpdate:modelValue":l=>{const u=l===""?void 0:Number(l);r(u,a==null?void 0:a[1])},placeholder:"最小金额",clearable:!0},null),p("span",{class:"flex-none"},[z("至")]),p(g("el-input"),{class:"flex-1",modelValue:(d=a==null?void 0:a[1])==null?void 0:d.toString(),"onUpdate:modelValue":l=>{const u=l===""?void 0:Number(l);r(a==null?void 0:a[0],u)},placeholder:"最大金额",clearable:!0},null)])}},{label:"支付方式",prop:"pay_method",valueType:"select",fieldProps:{placeholder:"请选择支付方式"},options:T},{label:"支付编号",prop:"pay_sn",valueType:"input",fieldProps:{placeholder:"请输入支付编号"}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:re()}}]}}function he(){return{tableRef:b(),tableColumns:[{label:"ID",prop:"id",width:130},{label:"金额",prop:"amount",width:100},{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:a})=>p(g("el-tag"),{size:a.size,type:ce[e.type],effect:"plain"},{default:()=>{var n;return[(n=k.find(r=>r.value===e.type))==null?void 0:n.label]}})},{label:"支付方式",prop:"pay_method",width:100,cellRenderer:({row:e,props:a})=>p(g("el-tag"),{size:a.size,type:pe[e.pay_method],effect:"plain"},{default:()=>{var n;return[(n=T.find(r=>r.value===e.pay_method))==null?void 0:n.label]}})},{label:"支付编号",prop:"pay_sn",minWidth:150},{label:"备注",prop:"remark",minWidth:150},{label:"状态",prop:"status",width:80,cellRenderer:({row:e,props:a})=>p(g("el-tag"),{size:a.size,type:fe[e.status],effect:"plain"},{default:()=>{var n;return[(n=D.find(r=>r.value===e.status))==null?void 0:n.label]}})},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?J(e).format("YYYY-MM-DD HH:mm:ss"):"-"}]}}const me={class:"main"},be={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},ye=K({name:"Funds",__name:"index",setup(o){const t=Q(),e=X(),{tableRef:a,tableColumns:n}=he(),{loading:r,search:i,dataList:d,pagination:l,handleSizeChange:u,handleCurrentChange:c,onSearch:f,onReset:M,onCollapse:F}=ie(a),{searchColumns:Y}=ge(()=>f());function B(){return x(this,null,function*(){const y=t.query.tid;return y?yield de(y).then(()=>{w().updateBalance(),oe("充值成功",{type:"success"}),e.push("/funds")}):Promise.resolve()})}return Z(()=>{B(),t.query.id&&(i.value.id=Number(t.query.id)),f()}),(y,h)=>{const N=g("el-button"),V=g("pure-table");return ae(),ee("div",me,[te("div",be,[p(s(H),{modelValue:s(i),"onUpdate:modelValue":h[0]||(h[0]=m=>ne(i)?i.value=m:null),columns:s(Y),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:s(f),onReset:s(M),onCollapse:s(F)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),p(s(L),{columns:s(n),onRefresh:s(f)},{title:v(()=>[p(N,{type:"success",onClick:s(w)().showDialog},{default:v(()=>h[1]||(h[1]=[z(" 充值 ")])),_:1},8,["onClick"])]),default:v(({size:m,dynamicColumns:U})=>[p(V,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:s(r),size:m,adaptive:"",adaptiveConfig:{offsetBottom:108},data:s(d),columns:U,pagination:C(_({},s(l)),{size:m}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:s(u),onPageCurrentChange:s(c)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),Re=le(ye,[["__scopeId","data-v-93a26994"]]);export{Re as default};
