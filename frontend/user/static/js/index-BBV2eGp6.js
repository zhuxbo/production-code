var K=Object.defineProperty;var q=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var z=(u,l,s)=>l in u?K(u,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[l]=s,D=(u,l)=>{for(var s in l||(l={}))Y.call(l,s)&&z(u,s,l[s]);if(q)for(var s of q(l))$.call(l,s)&&z(u,s,l[s]);return u};var S=(u,l,s)=>new Promise((y,_)=>{var k=m=>{try{v(s.next(m))}catch(p){_(p)}},C=m=>{try{v(s.throw(m))}catch(p){_(p)}},v=m=>m.done?y(m.value):Promise.resolve(m.value).then(k,C);v((s=s.apply(u,l)).next())});import{d as H,u as Q,s as W,l as N,m as X,v as ee,r as x,c as oe,o as P,f as d,g as o,e as a,x as ae,i as re,a8 as te,t as se,j as r,B as I,h as R,y as b,e0 as le,_ as ne}from"./index-pXbp6I31.js";import{u as h}from"./hooks-CQKIDBLZ.js";import{s as ie}from"./verifyCode-si92osFF.js";import{E as ue,u as de}from"./message-_R_Vyttg.js";import{b as me,i as ce,M as f,L as B}from"./lock-fill-D84CZQd7.js";import{f as fe,a as pe,u as ge,b as _e,d as ye}from"./dark-BHLW26Tf.js";import{U as ve}from"./user-3-fill-CBE7oi1t.js";import"./epTheme-CzJPEQWF.js";const we={class:"select-none"},xe=["src"],be={class:"flex-c absolute right-5 top-3"},he={class:"login-container"},Ve={class:"img"},Ce={class:"login-box"},Se={class:"login-form"},Re={class:"outline-none"},ke={class:"w-full flex justify-between"},Ee={class:"w-full flex-c absolute bottom-3 text-sm text-[rgba(0,0,0,0.6)] dark:text-[rgba(220,220,242,0.8)]"},Ie={class:"hover:text-primary",href:"/",target:"_blank"},V="registration_source",Ue=H({name:"Register",__name:"index",setup(u){const l=Q(),s=W(),y=N(null),_=N(!1),{isDisabled:k,text:C,start:v}=de(),{initStorage:m}=fe();m();const{dataTheme:p,overallStyle:A,dataThemeChange:U}=pe();U(A.value);const{title:T}=ge(),t=X({username:"",password:"",confirmPassword:"",email:"",verifyCode:""}),L=n=>{const e=Date.now()+2592e5,c={value:n,expiry:e};localStorage.setItem(V,JSON.stringify(c))},O=()=>{const n=localStorage.getItem(V);if(!n)return null;try{const e=JSON.parse(n);return Date.now()>e.expiry?(localStorage.removeItem(V),null):e.value}catch(e){return localStorage.removeItem(V),null}},F=()=>{localStorage.removeItem(V)};ee(()=>{const n=s.query.source;n&&L(n)});const M={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(n,e,c)=>{e===""?c(new Error("请再次输入密码")):t.password!==e?c(new Error("两次输入密码不一致")):c()},trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"请输入正确的邮箱格式",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},Z=()=>S(null,null,function*(){if(!t.email){b("请先输入邮箱",{type:"warning"});return}try{yield ie({email:t.email,type:"register"}),b("验证码已发送，请查收邮件",{type:"success"}),v()}catch(n){b("验证码发送失败，请稍后重试",{type:"error"})}});function j(){l.push("/login")}function J(){return S(this,null,function*(){y.value&&y.value.validate(n=>S(null,null,function*(){if(n){_.value=!0;try{const e=O(),c=D({username:t.username,password:t.password,email:t.email,code:t.verifyCode},e&&{source:e});yield le(c),b("注册成功，请登录",{type:"success"}),F(),l.push("/login")}catch(e){b("注册失败，请重试",{type:"error"})}finally{_.value=!1}}}))})}return(n,e)=>{const c=x("el-switch"),w=x("el-input"),g=x("el-form-item"),E=x("el-button"),G=x("el-form");return P(),oe("div",we,[d("img",{src:o(me),class:"wave"},null,8,xe),d("div",be,[a(c,{modelValue:o(p),"onUpdate:modelValue":e[0]||(e[0]=i=>ae(p)?p.value=i:null),"inline-prompt":"","active-icon":o(ye),"inactive-icon":o(_e),onChange:o(U)},null,8,["modelValue","active-icon","inactive-icon","onChange"])]),d("div",he,[d("div",Ve,[(P(),re(te(se(o(ce)))))]),d("div",Ce,[d("div",Se,[a(o(f),{delay:300},{default:r(()=>[d("h2",Re,I(o(T)),1)]),_:1}),a(G,{ref_key:"formRef",ref:y,model:t,rules:M,size:"large"},{default:r(()=>[a(o(f),{delay:100},{default:r(()=>[a(g,{prop:"username"},{default:r(()=>[a(w,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=i=>t.username=i),clearable:"",placeholder:"用户名","prefix-icon":o(h)(o(ve))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),a(o(f),{delay:150},{default:r(()=>[a(g,{prop:"password"},{default:r(()=>[a(w,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=i=>t.password=i),clearable:"","show-password":"",placeholder:"密码","prefix-icon":o(h)(o(B))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),a(o(f),{delay:200},{default:r(()=>[a(g,{prop:"confirmPassword"},{default:r(()=>[a(w,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=i=>t.confirmPassword=i),clearable:"","show-password":"",placeholder:"确认密码","prefix-icon":o(h)(o(B))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),a(o(f),{delay:250},{default:r(()=>[a(g,{prop:"email"},{default:r(()=>[a(w,{modelValue:t.email,"onUpdate:modelValue":e[4]||(e[4]=i=>t.email=i),clearable:"",placeholder:"邮箱","prefix-icon":o(h)(o(ue))},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),a(o(f),{delay:300},{default:r(()=>[a(g,{prop:"verifyCode"},{default:r(()=>[d("div",ke,[a(w,{modelValue:t.verifyCode,"onUpdate:modelValue":e[5]||(e[5]=i=>t.verifyCode=i),clearable:"",placeholder:"邮箱验证码","prefix-icon":o(h)("ri:shield-keyhole-line")},null,8,["modelValue","prefix-icon"]),a(E,{disabled:o(k),class:"ml-2!",onClick:Z},{default:r(()=>[R(I(o(C).length>0?o(C)+"秒后重新获取":"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),a(o(f),{delay:350},{default:r(()=>[a(g,null,{default:r(()=>[a(E,{class:"w-full",size:"default",type:"primary",loading:_.value,onClick:J},{default:r(()=>e[6]||(e[6]=[R(" 注册 ")])),_:1},8,["loading"])]),_:1})]),_:1}),a(o(f),{delay:400},{default:r(()=>[a(g,null,{default:r(()=>[a(E,{class:"w-full",size:"default",onClick:j},{default:r(()=>e[7]||(e[7]=[R(" 返回登录 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])]),d("div",Ee,[e[8]||(e[8]=R(" Copyright © 2020-present ")),d("a",Ie,"  "+I(o(T)),1)])])}}}),Oe=ne(Ue,[["__scopeId","data-v-23d4e6ce"]]);export{Oe as default};
