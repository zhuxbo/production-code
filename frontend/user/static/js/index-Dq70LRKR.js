var v=Object.defineProperty,w=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var x=(t,a,n)=>a in t?v(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,b=(t,a)=>{for(var n in a||(a={}))k.call(a,n)&&x(t,n,a[n]);if(S)for(var n of S(a))D.call(a,n)&&x(t,n,a[n]);return t},C=(t,a)=>w(t,z(a));import{P as Y,a as M}from"./plus-search-Ddw1G523.js";import{k as V,l as g,m as B,t as N,n as F,p as U,e as u,r as m,h as E,u as j,q,d as H,v as I,c as L,o as O,f as W,g as r,x as A,j as $,_ as G}from"./index-B0ybLaAg.js";import{c as J,g as K}from"./datePicker-BB6kNVow.js";import"./epTheme-3SYpKPUj.js";import"./index-J36KFx34.js";function Q(t){return V.get("/transaction",{params:t})}function X(t){const a=g({}),n=g([]),e=g(!0),o=B({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,50,100]});function i(c){o.pageSize=c,d()}function p(c){o.currentPage=c,d()}function d(){e.value=!0;const c=C(b({},N(a.value)),{pageSize:o.pageSize,currentPage:o.currentPage});c.created_at&&(c.created_at=J(c.created_at)),Q(c).then(({data:f})=>{n.value=f.items,o.total=f.total,o.pageSize=f.pageSize,o.currentPage=f.currentPage,F(()=>{t.value&&t.value.getTableRef().clearSelection()})}).finally(()=>{e.value=!1})}return{loading:e,search:a,dataList:n,pagination:o,handleSizeChange:i,handleCurrentChange:p,onSearch:d,onReset:()=>{d()},onCollapse:()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)}}}const y=[{label:"充值",value:"addfunds"},{label:"退款",value:"refunds"},{label:"扣款",value:"deduct"},{label:"退回",value:"reverse"},{label:"订单",value:"order"},{label:"取消",value:"cancel"}],Z={addfunds:"success",refunds:"danger",deduct:"primary",reverse:"danger",order:"primary",cancel:"danger"};function ee(t){const a=U(()=>{t()},500);return{searchColumns:[{label:"交易类型",prop:"type",valueType:"select",fieldProps:{placeholder:"请选择交易类型"},options:y,onChange:()=>{a()}},{label:"交易单号",prop:"transaction_id",valueType:"input",fieldProps:{placeholder:"请输入交易单号"}},{label:"金额",prop:"amount",renderField:(e,o)=>{var p,d;const i=(s,l)=>{s!==void 0&&l!==void 0&&s>l||o([s,l])};return u("div",{class:"flex items-center gap-2 w-full"},[u(m("el-input"),{class:"flex-1",modelValue:(p=e==null?void 0:e[0])==null?void 0:p.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);i(l,e==null?void 0:e[1])},placeholder:"最小金额",clearable:!0},null),u("span",{class:"flex-none"},[E("至")]),u(m("el-input"),{class:"flex-1",modelValue:(d=e==null?void 0:e[1])==null?void 0:d.toString(),"onUpdate:modelValue":s=>{const l=s===""?void 0:Number(s);i(e==null?void 0:e[0],l)},placeholder:"最大金额",clearable:!0},null)])}},{label:"创建时间",prop:"created_at",valueType:"date-picker",fieldProps:{type:"daterange",rangeSeparator:"至",startPlaceholder:"开始日期",endPlaceholder:"结束日期",valueFormat:"YYYY-MM-DD",shortcuts:K()}}]}}function ae(){const t=j();return{tableRef:g(),tableColumns:[{label:"类型",prop:"type",width:80,cellRenderer:({row:e,props:o})=>u(m("el-tag"),{size:o.size,type:Z[e.type],effect:"plain"},{default:()=>{var i;return[(i=y.find(p=>p.value===e.type))==null?void 0:i.label]}})},{label:"单号",prop:"transaction_id",minWidth:150,cellRenderer:({row:e})=>u("span",{class:"cursor-pointer",onClick:()=>{t.push({path:["order","cancel"].includes(e.type)?"/order":"/funds",query:{id:e.transaction_id}})}},[e.transaction_id])},{label:"交易金额",prop:"amount",width:100},{label:"交易前余额",prop:"balance_before",width:100},{label:"交易后余额",prop:"balance_after",width:100},{label:"备注",prop:"remark",minWidth:150},{label:"创建时间",prop:"created_at",width:170,formatter:({created_at:e})=>e?q(e).format("YYYY-MM-DD HH:mm:ss"):"-"}]}}const te={class:"main"},ne={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},oe=H({name:"Transaction",__name:"index",setup(t){const{tableRef:a,tableColumns:n}=ae(),{loading:e,search:o,dataList:i,pagination:p,handleSizeChange:d,handleCurrentChange:s,onSearch:l,onReset:c,onCollapse:f}=X(a),{searchColumns:P}=ee(()=>l());return I(()=>{l()}),(re,_)=>{const R=m("pure-table");return O(),L("div",te,[W("div",ne,[u(r(Y),{modelValue:r(o),"onUpdate:modelValue":_[0]||(_[0]=h=>A(o)?o.value=h:null),columns:r(P),"show-number":2,"row-props":{gutter:12},"col-props":{xs:24,sm:12,md:8,lg:6,xl:4},"label-width":"80","label-position":"right","label-suffix":"","search-text":"搜索","reset-text":"重置","expand-text":"展开","retract-text":"收起",onSearch:r(l),onReset:r(c),onCollapse:r(f)},null,8,["modelValue","columns","onSearch","onReset","onCollapse"])]),u(r(M),{title:"交易记录",columns:r(n),onRefresh:r(l)},{default:$(({size:h,dynamicColumns:T})=>[u(R,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:r(e),size:h,adaptive:"",adaptiveConfig:{offsetBottom:108},data:r(i),columns:T,pagination:C(b({},r(p)),{size:h}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:r(d),onPageCurrentChange:r(s)},null,8,["loading","size","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"])])}}}),pe=G(oe,[["__scopeId","data-v-f871e308"]]);export{pe as default};
