var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var $=(n,a,e)=>a in n?Y(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,V=(n,a)=>{for(var e in a||(a={}))ae.call(a,e)&&$(n,e,a[e]);if(U)for(var e of U(a))le.call(a,e)&&$(n,e,a[e]);return n},B=(n,a)=>Z(n,ee(a));var q=(n,a,e)=>new Promise((t,l)=>{var r=d=>{try{c(e.next(d))}catch(_){l(_)}},s=d=>{try{c(e.throw(d))}catch(_){l(_)}},c=d=>d.done?t(d.value):Promise.resolve(d.value).then(r,s);c((e=e.apply(n,a)).next())});import{r as b,f as te,q as L,an as D,t as ne,n as oe,g as re,k as o,l as v,aL as ie,b0 as se,p as H,w as pe,u as O,v as S,x as m,F as J,ad as ue,ae as de,G as u,y as j,z as k,A as ce,B as F,C as me,H as ve,J as fe,b4 as _e,P as ge,_ as be}from"./index-D5efkW8k.js";import{i as he,b as I,c as N,e as G,d as M,n as W,f as ye,a as E,g as Ce}from"./product-CqZQfo2c.js";import{P as xe}from"./plus-search-Cl3d-rfH.js";import"./index-CsaBZZ8X.js";function Se(n){const a=b({}),e=b([]),t=b(!0),l=te({total:0,pageSize:100,currentPage:1,background:!0,pageSizes:[10,20,50,100],hideOnSinglePage:!0}),r=L(()=>l.total<=l.pageSize);function s(i){l.pageSize=i,d()}function c(i){l.currentPage=i,d()}function d(){t.value=!0;const i=B(V({},ne(a.value)),{pageSize:l.pageSize,currentPage:l.currentPage});he(i).then(({data:h})=>{e.value=h.items,l.total=h.total,l.pageSize=h.pageSize,l.currentPage=h.currentPage,oe(()=>{n.value&&n.value.getTableRef().clearSelection()})}).finally(()=>{t.value=!1})}function _(i){D.push({name:"Order",query:{product_id:i.id,type:"apply"}})}function p(i){D.push({name:"Order",query:{product_id:i.id,type:"batchApply"}})}return{loading:t,search:a,dataList:e,pagination:l,isSinglePage:r,handleSizeChange:s,handleCurrentChange:c,onSearch:d,handleApply:_,handleBatchApply:p}}const x=(n,a)=>(e,t)=>{const l=b(e),r=s=>{l.value===s?(l.value=void 0,t(void 0)):(l.value=s,t(s))};return o("div",{class:"flex flex-wrap gap-1 items-center"},[o("div",{class:"flex flex-wrap gap-1"},[n.map(s=>o(v("el-button"),{key:s.value,type:l.value===s.value?"primary":"default",onClick:()=>r(s.value),class:"ml-3 w-28"},{default:()=>[s.label]}))]),(a==null?void 0:a.showToggleButton)&&o(v("el-button"),{type:"primary",link:!0,onClick:a.onToggle,class:"ml-3 flex items-center whitespace-nowrap text-base"},{default:()=>[o(v("el-icon"),{class:"mr-1"},{default:()=>[a.collapsed?o(ie,null,null):o(se,null,null)]}),a.collapsed?"展开":"收起"]})])},we=n=>{const a=re(()=>{n()},500),e=b(!0),t=()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},500)},l=()=>{e.value=!e.value,t()};return{searchColumns:L(()=>[{label:"证书品牌",prop:"brand",valueType:"radio",options:I,renderField:x(I,{showToggleButton:!0,onToggle:l,collapsed:e.value})},{label:"产品类型",prop:"product_type",valueType:"radio",options:N,renderField:x(N),hideInSearch:e.value},{label:"加密标准",prop:"encryption_standard",valueType:"radio",options:G,renderField:x(G),hideInSearch:e.value},{label:"验证类型",prop:"validation_type",valueType:"radio",options:M,renderField:x(M),hideInSearch:e.value},{label:"域名类型",prop:"name_type",valueType:"radio",options:W,renderField:x(W),hideInSearch:e.value},{label:"快速搜索",prop:"quickSearch",valueType:"input",fieldProps:{placeholder:"编码/名称/备注",clearable:!0,style:{width:"240px"}},hideInSearch:e.value}]),debouncedSearch:a}},ke=()=>({tableRef:b(),tableColumns:[{label:"名称",prop:"name",minWidth:150},{label:"产品类型",prop:"product_type",width:100,formatter(e){return ye[e.product_type]||e.product_type||"SSL证书"}},{label:"说明",prop:"remark",minWidth:150},{label:"价格",prop:"price.price",width:100,formatter(e){var t;return(t=e.price)!=null&&t.price&&e.price.price!=="0.00"?parseFloat(e.price.price)+"/"+E[e.price.period]:"-"}},{label:"附加标准域名价格",prop:"price.alternative_standard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_standard_price&&e.price.alternative_standard_price!=="0.00"?parseFloat(e.price.alternative_standard_price)+"/"+E[e.price.period]:"-"}},{label:"附加通配符价格",prop:"price.alternative_wildcard_price",width:150,formatter(e){var t;return(t=e.price)!=null&&t.alternative_wildcard_price&&e.price.alternative_wildcard_price!=="0.00"?parseFloat(e.price.alternative_wildcard_price)+"/"+E[e.price.period]:"-"}},{label:"操作",slot:"operation",width:110,fixed:"right"}]}),Pe={class:"dialog-footer"},Te=H({__name:"export",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(n,{emit:a}){const e=n,t=a,l=L({get:()=>e.visible,set:p=>t("update:visible",p)}),r=b({brands:[],priceRate:1}),s=()=>{r.value={brands:[],priceRate:1}},c=b(!1),d=()=>q(null,null,function*(){if(!c.value){if(r.value.priceRate<=0){F.error("价格倍率必须大于0");return}c.value=!0;try{const p={};r.value.brands.length>0&&(p.brands=r.value.brands),r.value.priceRate!==1&&(p.priceRate=r.value.priceRate),yield Ce(p),F.success("导出成功"),l.value=!1}catch(p){console.error("导出失败:",p),F.error(p.message||"导出失败")}finally{c.value=!1}}}),_=()=>{l.value=!1,s()};return pe(()=>e.visible,p=>{p&&s()}),(p,i)=>{const h=v("el-option"),P=v("el-select"),w=v("el-form-item"),C=v("el-input-number"),T=v("el-form"),z=v("el-button"),g=v("el-dialog");return S(),O(g,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=f=>l.value=f),title:"导出产品价格",width:"500px","destroy-on-close":"",onClose:_},{footer:m(()=>[j("div",Pe,[o(z,{onClick:_},{default:m(()=>[...i[3]||(i[3]=[k("取消",-1)])]),_:1}),o(z,{type:"primary",loading:c.value,onClick:d},{default:m(()=>[k(ce(c.value?"导出中...":"导出"),1)]),_:1},8,["loading"])])]),default:m(()=>[o(T,{model:r.value,"label-width":"120px","label-position":"right"},{default:m(()=>[o(w,{label:"品牌筛选"},{default:m(()=>[o(P,{modelValue:r.value.brands,"onUpdate:modelValue":i[0]||(i[0]=f=>r.value.brands=f),multiple:"",placeholder:"选择品牌（不选择则导出所有品牌）",style:{width:"100%"},"collapse-tags":"","collapse-tags-tooltip":""},{default:m(()=>[(S(!0),J(ue,null,de(u(I),f=>(S(),O(h,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"价格倍率"},{default:m(()=>[o(C,{modelValue:r.value.priceRate,"onUpdate:modelValue":i[1]||(i[1]=f=>r.value.priceRate=f),min:.01,max:1e3,step:.1,precision:2,style:{width:"100%"},placeholder:"输入价格倍率"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ze={class:"main"},Re={class:"search bg-bg_color w-[99/100] pl-4 pr-4 pt-[24px] pb-[12px] overflow-auto"},Ve=H({name:"Product",__name:"index",setup(n){const{tableRef:a,tableColumns:e}=ke(),{loading:t,search:l,dataList:r,pagination:s,isSinglePage:c,handleSizeChange:d,handleCurrentChange:_,onSearch:p,handleApply:i,handleBatchApply:h}=Se(a),{searchColumns:P,debouncedSearch:w}=we(()=>p()),C=b(!1),T=()=>{C.value=!0};return me(()=>{p()}),(z,g)=>{const f=v("ElDivider"),A=v("el-button"),K=v("pure-table");return S(),J("div",ze,[j("div",Re,[o(u(xe),{modelValue:u(l),"onUpdate:modelValue":g[0]||(g[0]=y=>ve(l)?l.value=y:null),columns:u(P),"show-number":6,"col-props":{xs:24,sm:24,md:24,lg:24,xl:24},"label-width":"80","label-position":"right","label-suffix":"","has-footer":!1,onChange:u(w)},null,8,["modelValue","columns","onChange"])]),o(u(ge),{title:"产品列表",columns:u(e),onRefresh:u(p)},{buttons:m(()=>[o(u(_e),{icon:"ri/download-2-line",style:{cursor:"pointer"},onClick:T}),o(f,{direction:"vertical",style:{"margin-right":"-8px"}})]),default:m(({size:y,dynamicColumns:Q})=>[o(K,{ref_key:"tableRef",ref:a,"row-key":"id","align-whole":"left","table-layout":"auto",loading:u(t),size:y,adaptive:"",adaptiveConfig:{offsetBottom:u(c)?44:108},data:u(r),columns:Q,pagination:B(V({},u(s)),{size:y}),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:u(d),onPageCurrentChange:u(_)},{operation:m(({row:R})=>[o(A,{class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:X=>u(i)(R)},{default:m(()=>[...g[2]||(g[2]=[k(" 申请 ",-1)])]),_:1},8,["size","onClick"]),R.alternative_name_types.length?fe("",!0):(S(),O(A,{key:0,class:"reset-margin !outline-none",type:"primary",link:"",size:y,onClick:X=>u(h)(R)},{default:m(()=>[...g[3]||(g[3]=[k(" 批量 ",-1)])]),_:1},8,["size","onClick"]))]),_:2},1032,["loading","size","adaptiveConfig","data","columns","pagination","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["columns","onRefresh"]),o(Te,{visible:C.value,"onUpdate:visible":g[1]||(g[1]=y=>C.value=y)},null,8,["visible"])])}}}),Le=be(Ve,[["__scopeId","data-v-987427c2"]]);export{Le as default};
